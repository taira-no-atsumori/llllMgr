import{g as jl,I as Dl,u as Kl,a as ql,b as Jl,c as zl,r as m,w as Gl,o as Fe,d as se,e as Xl,f as Wl,h as Yl,V as Sl,i as xl,j as e,k as y,F as ee,l as Zl,m as je,n as wl,v as Ql,p as Ml,q as dl,s as ea,t as al,x as la,y as Z,z as aa,A as ta,B as ua,C as oa,D as ia,E as na,G as sa,H as ra,J as xe,K as yl,L as S,M as B,N as Oe,O as l,P as q,Q as z,R as E,S as c,T as da,U as J,W as j,X as Ol,Y as ue,Z as Xe,_ as ca,$ as Ke,a0 as ma,a1 as ae,a2 as re,a3 as ve,a4 as fe,a5 as qe,a6 as Ve,a7 as Le,a8 as He,a9 as Pe,aa as ce,ab as _e,ac as Ze,ad as Ie,ae as Be,af as be,ag as Te,ah as Q,ai as K,aj as Tl,ak as ye,al as ml,am as vl,an as pl,ao as fl,ap as sl,aq as We,ar as rl,as as hl,at as va,au as gl,av as ze,aw as Cl,ax as Ul,ay as cl,az as il,aA as Ae,aB as kl,aC as Ue,aD as Pl,aE as Qe,aF as pa,aG as _l,aH as fa,aI as Il,aJ as Ge,aK as ya,aL as Al,aM as Nl,aN as ga,aO as tl,aP as ka,aQ as we,aR as ul,aS as ol,aT as $l,aU as El,aV as Ll,aW as Ee,aX as Bl,aY as Re,aZ as bl,a_ as Rl,a$ as ba,b0 as Va,b1 as Da,b2 as Sa,b3 as xa,b4 as wa,b5 as ha}from"./index.js";const Ca=oa({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:p=>!isNaN(parseFloat(p))},maxHeight:{type:[Number,String],validator:p=>!isNaN(parseFloat(p))},maxRows:{type:[Number,String],validator:p=>!isNaN(parseFloat(p))},suffix:String,modelModifiers:Object,...ra(),...na(sa(),["direction"]),...ia()},"VTextarea"),Me=jl()({name:"VTextarea",directives:{vIntersect:Dl},inheritAttrs:!1,props:Ca(),emits:{"click:control":p=>!0,"mousedown:control":p=>!0,"update:focused":p=>!0,"update:modelValue":p=>!0,"update:rows":p=>!0},setup(p,T){let{attrs:C,emit:R,slots:w}=T;const O=Kl(p,"modelValue"),{isFocused:u,focus:L,blur:x}=ql(p),{onIntersect:M}=ua(p),$=Z(()=>typeof p.counterValue=="function"?p.counterValue(O.value):(O.value||"").toString().length),_=Z(()=>{if(C.maxlength)return C.maxlength;if(!(!p.counter||typeof p.counter!="number"&&typeof p.counter!="string"))return p.counter}),b=m(),N=m(),V=ta(""),D=m(),h=m(0),{platform:k}=Jl(),r=zl(p),s=Z(()=>p.persistentPlaceholder||u.value||p.active);function o(){r.isSuppressing.value&&r.update(),D.value!==document.activeElement&&D.value?.focus(),u.value||L()}function a(Y){o(),R("click:control",Y)}function U(Y){R("mousedown:control",Y)}function v(Y){Y.stopPropagation(),o(),al(()=>{O.value="",aa(p["onClick:clear"],Y)})}function f(Y){const oe=Y.target;if(!p.modelModifiers?.trim){O.value=oe.value;return}const de=oe.value,he=oe.selectionStart,De=oe.selectionEnd;O.value=de,al(()=>{let Se=0;de.trimStart().length===oe.value.length&&(Se=de.length-oe.value.length),he!=null&&(oe.selectionStart=he-Se),De!=null&&(oe.selectionEnd=De-Se)})}const I=m(),P=m(Number(p.rows)),G=Z(()=>["plain","underlined"].includes(p.variant));Gl(()=>{p.autoGrow||(P.value=Number(p.rows))});function le(){al(()=>{if(!D.value)return;if(k.value.firefox){h.value=12;return}const{offsetWidth:Y,clientWidth:oe}=D.value;h.value=Math.max(0,Y-oe)}),p.autoGrow&&al(()=>{if(!I.value||!N.value)return;const Y=getComputedStyle(I.value),oe=getComputedStyle(N.value.$el),de=parseFloat(Y.getPropertyValue("--v-field-padding-top"))+parseFloat(Y.getPropertyValue("--v-input-padding-top"))+parseFloat(Y.getPropertyValue("--v-field-padding-bottom")),he=I.value.scrollHeight,De=parseFloat(Y.lineHeight),Se=Math.max(parseFloat(p.rows)*De+de,parseFloat(oe.getPropertyValue("--v-input-control-height"))),A=p.maxHeight?parseFloat(p.maxHeight):parseFloat(p.maxRows)*De+de||1/0,d=la(he??0,Se,A);P.value=Math.floor((d-de)/De),V.value=dl(d)})}Fe(le),se(O,le),se(()=>p.rows,le),se(()=>p.maxHeight,le),se(()=>p.maxRows,le),se(()=>p.density,le),se(P,Y=>{R("update:rows",Y)});let ge;return se(I,Y=>{Y?(ge=new ResizeObserver(le),ge.observe(I.value)):ge?.disconnect()}),Xl(()=>{ge?.disconnect()}),Wl(()=>{const Y=!!(w.counter||p.counter||p.counterValue),oe=!!(Y||w.details),[de,he]=Yl(C),{modelValue:De,...Se}=Sl.filterProps(p),A={...xl.filterProps(p),"onClick:clear":v};return e(Sl,je({ref:b,modelValue:O.value,"onUpdate:modelValue":d=>O.value=d,class:["v-textarea v-text-field",{"v-textarea--prefixed":p.prefix,"v-textarea--suffixed":p.suffix,"v-text-field--prefixed":p.prefix,"v-text-field--suffixed":p.suffix,"v-textarea--auto-grow":p.autoGrow,"v-textarea--no-resize":p.noResize||p.autoGrow,"v-input--plain-underlined":G.value},p.class],style:[{"--v-textarea-max-height":p.maxHeight?dl(p.maxHeight):void 0,"--v-textarea-scroll-bar-width":dl(h.value)},p.style]},de,Se,{centerAffix:P.value===1&&!G.value,focused:u.value}),{...w,default:d=>{let{id:g,isDisabled:X,isDirty:i,isReadonly:pe,isValid:ke,hasDetails:Ce}=d;return e(xl,je({ref:N,style:{"--v-textarea-control-height":V.value},onClick:a,onMousedown:U,"onClick:prependInner":p["onClick:prependInner"],"onClick:appendInner":p["onClick:appendInner"]},A,{id:g.value,active:s.value||i.value,labelId:`${g.value}-label`,centerAffix:P.value===1&&!G.value,dirty:i.value||p.dirty,disabled:X.value,focused:u.value,details:Ce.value,error:ke.value===!1}),{...w,default:Je=>{let{props:{class:el,...ll},controlRef:F}=Je;return y(ee,null,[p.prefix&&y("span",{class:"v-text-field__prefix"},[p.prefix]),wl(y("textarea",je({ref:n=>D.value=F.value=n,class:el,value:O.value,onInput:f,autofocus:p.autofocus,readonly:pe.value,disabled:X.value,placeholder:p.placeholder,rows:p.rows,name:r.fieldName.value,autocomplete:r.fieldAutocomplete.value,onFocus:o,onBlur:x,"aria-labelledby":`${g.value}-label`},ll,he),null),[[Dl,{handler:M},null,{once:!0}]]),p.autoGrow&&wl(y("textarea",{class:Ml([el,"v-textarea__sizer"]),id:`${ll.id}-sizer`,"onUpdate:modelValue":n=>O.value=n,ref:I,readonly:!0,"aria-hidden":"true"},null),[[Ql,O.value]]),p.suffix&&y("span",{class:"v-text-field__suffix"},[p.suffix])])}})},details:oe?d=>y(ee,null,[w.details?.(d),Y&&y(ee,null,[y("span",null,null),e(Zl,{active:p.persistentCounter||u.value,value:$.value,max:_.value,disabled:p.disabled},w.counter)])]):void 0})}),ea({},b,N,D)}}),Ua={key:0,class:"mb-4 text-grey"},_a={key:1},Ia={class:"text-caption mr-2"},Aa={class:"text-caption"},Na=xe({__name:"PendingData",emits:["edit"],setup(p,{emit:T}){const C=yl(),R=m(!1),w=m(""),O=m(""),u=m([]),L=m(!1),x=m(!1),M=m(""),$=T,_=V=>{C.setEditTarget(V.type,V.key),$("edit",V.type)},b=V=>{if(O.value=JSON.stringify(V.data,null,2),V.status==="update"){let D=null;V.type==="music"?D=C.prodData.music[V.key]:V.type==="card"&&(D=C.flattenCards(C.prodData.card)[V.key]?.data),w.value=JSON.stringify(D,null,2)}else w.value="New Data"},N=async()=>{if(u.value.length===0)return;R.value=!0;const V=Pe(ce.app);try{const D={};for(const h of u.value){const k=C.diffList.find(o=>o.key===h);if(!k)continue;const r=JSON.parse(JSON.stringify(k.data));let s=null;if(k.type==="music"?s=C.prodData.music[k.key]:k.type==="card"&&(s=C.flattenCards(C.prodData.card)[k.key]?.data),r.imageURL&&r.imageURL.startsWith("http")&&(!s||!s.imageURL))try{const a=await(await fetch(r.imageURL)).blob();let U="webp";try{const le=new URL(r.imageURL),Y=decodeURIComponent(le.pathname).match(/\.([a-zA-Z0-9]+)$/);Y&&(U=Y[1])}catch{}const v=`${h}.${U}`,f=k.type==="card"?"cardIllust":k.type==="music"?"cdJacket":"eventInformation",I=_e(V,`${f}/${v}`),P=await Ze(I,a),G=await Ie(P.ref);r.imageURL=G}catch(o){console.error(`Failed to copy image for ${h}:`,o)}D[k.path]=r}await Be(be(ce),D),L.value=!0,u.value=[],w.value="",O.value=""}catch(D){console.error("Upload failed:",D),M.value=String(D),x.value=!0}finally{R.value=!1}};return(V,D)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[q(C).diffList.length===0?(S(),z("div",Ua," Dev環境と本番環境のデータに差分はありません。 ")):(S(),z("div",_a,[e(E,{text:"Deploy to Prod",color:"primary","prepend-icon":"mdi-cloud-upload",loading:R.value,disabled:u.value.length===0,onClick:N},null,8,["loading","disabled"]),e(ae,{class:"mt-0"},{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(da,null,{default:l(()=>[J(" Diff: "+j(q(C).diffList.length),1)]),_:1}),e(Ol,{variant:"flat",class:"mb-4"},{default:l(()=>[(S(!0),z(ee,null,ue(q(C).diffList,h=>(S(),B(Xe,{key:h.key,class:Ml(h.status==="new"?"bg-blue-lighten-4":"bg-yellow-lighten-4"),onClick:k=>b(h)},{prepend:l(()=>[e(ma,{modelValue:u.value,"onUpdate:modelValue":D[0]||(D[0]=k=>u.value=k),value:h.key,color:"pink",onClick:D[1]||(D[1]=Ke(()=>{},["stop"]))},null,8,["modelValue","value"])]),append:l(()=>[e(E,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:Ke(k=>_(h),["stop"])},null,8,["onClick"])]),default:l(()=>[e(ca,null,{default:l(()=>[y("span",Ia,"["+j(h.type)+"]",1),J(" "+j(h.data.title||h.data.cardName||h.key)+" ",1),y("span",Aa,"("+j(h.status)+")",1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Me,{modelValue:w.value,"onUpdate:modelValue":D[2]||(D[2]=h=>w.value=h),label:"Prod (Before)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Me,{modelValue:O.value,"onUpdate:modelValue":D[3]||(D[3]=h=>O.value=h),label:"Dev (After)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1})]),_:1})])),e(Le,{modelValue:x.value,"onUpdate:modelValue":D[5]||(D[5]=h=>x.value=h),"max-width":"600"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,{class:"text-h5 bg-error"},{default:l(()=>[...D[8]||(D[8]=[J("Upload Failed",-1)])]),_:1}),e(fe,{class:"pt-4"},{default:l(()=>[D[9]||(D[9]=y("p",null," アップロードに失敗しました。コンソールで詳細を確認してください。 ",-1)),D[10]||(D[10]=y("p",{class:"mt-4 font-weight-bold"},"エラーメッセージ:",-1)),e(Me,{"model-value":M.value,readonly:"",variant:"outlined",rows:"5","auto-grow":"",class:"mt-2"},null,8,["model-value"])]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(E,{color:"primary",text:"Close",onClick:D[4]||(D[4]=h=>x.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:L.value,"onUpdate:modelValue":D[7]||(D[7]=h=>L.value=h),timeout:3e3,color:"success"},{actions:l(()=>[e(E,{variant:"text",text:"Close",onClick:D[6]||(D[6]=h=>L.value=!1)})]),default:l(()=>[D[11]||(D[11]=J(" Upload Completed! ",-1))]),_:1},8,["modelValue"])]),_:1}))}}),Fl=[{title:"あ行",value:"あ"},{title:"か行",value:"か"},{title:"さ行",value:"さ"},{title:"た行",value:"た"},{title:"な行",value:"な"},{title:"は行",value:"は"},{title:"ま行",value:"ま"},{title:"や行",value:"や"},{title:"ら行",value:"ら"},{title:"わ行",value:"わ"},{title:"数字",value:"other"}],Hl=p=>p?/[あ-おア-オ]/.test(p)?"あ":/[か-こカ-コが-ごガ-ゴ]/.test(p)?"か":/[さ-そサ-ソざ-ぞザ-ゾ]/.test(p)?"さ":/[た-とタ-トだ-どダ-ド]/.test(p)?"た":/[な-のナ-ノ]/.test(p)?"な":/[は-ほハ-ホば-ぼバ-ボぱ-ぽパ-ポ]/.test(p)?"は":/[ま-もマ-モ]/.test(p)?"ま":/[や-よヤ-ヨ]/.test(p)?"や":/[ら-ろラ-ロ]/.test(p)?"ら":/[わ-んワ-ン]/.test(p)?"わ":"other":"other",$a={class:"d-flex mb-3"},Ea={class:"pr-3",style:{width:"90%"}},Ra={style:{width:"10%"}},Ma={key:0,class:"mb-3"},Oa={class:"text-subtitle-1"},Ye=xe({__name:"SkillFormComponent",props:{modelValue:{},type:{},index:{}},emits:["update:modelValue","open-detail"],setup(p,{emit:T}){const C=m(!1),R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=p,O=T,u=Z({get:()=>w.modelValue,set:v=>O("update:modelValue",v)}),L=Te(),x=m({}),M=()=>{const v=be(ce,"skills/skill");sl(v,f=>{const I=f.val();if(I){for(const P in I)I[P]={ID:P,...I[P]};x.value=I}})};Fe(M),se(()=>L.isDev,M),se(x,v=>{if(Object.keys(v).length>0&&!w.modelValue.name&&!w.modelValue.ID){const f=b.value[0];f&&h(f.value)}});const $=m("all"),_=[{title:"All",value:"all"},...Fl],b=Z(()=>{const v=[],f=new Set;for(const I in x.value){const P=x.value[I],G=P.name,le=P.kana;$.value!=="all"&&Hl(le.charAt(0))!==$.value||f.has(G)||(f.add(G),v.push({title:G,value:I}))}return v.sort((I,P)=>I.title.localeCompare(P.title,"ja"))}),N=Z(()=>{switch(w.type){case"SA":return"Special Appeal";case"skill":return"Skill";case"addSA":return"Add Special Appeal";default:return"Skill"}}),V=Z(()=>{const v=u.value.name,f=[];if(!v)return f;for(const I in x.value)x.value[I].name===v&&f.push(x.value[I].ID);return f}),D=Z(()=>{const v=u.value.name,f=u.value.ID;return v&&f&&Object.keys(x.value).includes(f)?x.value[f].detail.type:[]}),h=v=>{if(!v)return;const f=[];for(const I in x.value)x.value[I].ID===v&&f.push(x.value[I]);f.length>0&&(u.value.ID=f[0].ID,u.value.name=f[0].name,k(f[0].ID))},k=v=>{if(!v)return;if(u.value.name){const I=x.value[v];if(I&&I.text){const P=Math.max(0,I.text.length-1);u.value.detail=new Array(P).fill(null).map(()=>[...R])}}},r={ID:"",name:"",AP:0,detail:[...R]},s={...r,characteristic:{name:"",detail:"",type:[""]}},o=v=>{u.value[`add${v}`]||(u.value[`add${v}`]=[]),u.value[`add${v}`].push(JSON.parse(JSON.stringify(v==="SA"?r:s)))},a=(v,f)=>{u.value[`add${v}`].splice(f,1)},U=()=>{let v="",f="",I=[];if(b.value.length>0){const P=b.value[0],G=x.value[P.value];if(G&&(v=G.ID,f=G.name,G.text)){const le=Math.max(0,G.text.length-1);I=new Array(le).fill(null).map(()=>[...R])}}u.value={...u.value,ID:v,name:f,AP:0,detail:I,addSA:[],addSkill:[]},C.value=!1};return(v,f)=>(S(),z(ee,null,[y("div",$a,[y("div",Ea,[e(Q,{modelValue:$.value,"onUpdate:modelValue":f[0]||(f[0]=I=>$.value=I),items:_,label:"Filter by Kana",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Q,{modelValue:u.value.name,"onUpdate:modelValue":[f[1]||(f[1]=I=>u.value.name=I),h],items:b.value,label:`${N.value} Name`,required:"",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue","items","label"]),e(Q,{modelValue:u.value.ID,"onUpdate:modelValue":[f[2]||(f[2]=I=>u.value.ID=I),k],items:V.value,label:`${N.value} ID`,required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","label"])]),y("div",Ra,[e(K,{modelValue:u.value.AP,"onUpdate:modelValue":f[3]||(f[3]=I=>u.value.AP=I),modelModifiers:{number:!0},label:"AP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":"","bg-color":u.value.AP===0?"error":void 0,class:"mb-3"},null,8,["modelValue","bg-color"]),e(E,{text:"Reset",color:"primary",block:"",onClick:U})])]),p.type==="SA"&&u.value.ID?(S(),z("div",Ma,[C.value?(S(),B(K,{key:1,modelValue:u.value.EXAP,"onUpdate:modelValue":f[6]||(f[6]=I=>u.value.EXAP=I),modelModifiers:{number:!0},label:"SA EXAP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":""},{append:l(()=>[e(Tl,{color:"error",icon:"mdi-delete",onClick:f[5]||(f[5]=I=>C.value=!1)})]),_:1},8,["modelValue"])):(S(),B(E,{key:0,text:"Add EXAP","prepend-icon":"mdi-plus",block:"",onClick:f[4]||(f[4]=I=>C.value=!0)}))])):ye("",!0),e(ae,null,{default:l(()=>[u.value.detail&&u.value.detail.length>0?(S(),B(c,{key:0,cols:"12",class:"d-flex align-center"},{default:l(()=>[y("p",Oa,j(N.value)+" Detail",1)]),_:1})):ye("",!0),(S(!0),z(ee,null,ue(u.value.detail,(I,P)=>(S(),z(ee,{key:P},[e(c,{cols:"12",class:"py-0"},{default:l(()=>[J("Detail "+j(P+1),1)]),_:2},1024),e(c,{cols:"12",class:"d-flex"},{default:l(()=>[(S(!0),z(ee,null,ue(u.value.detail[P],(G,le)=>(S(),B(K,{key:le,modelValue:u.value.detail[P][le],"onUpdate:modelValue":ge=>u.value.detail[P][le]=ge,label:`Level ${le+1}`,variant:"underlined",density:"compact","hide-details":"",readonly:"",class:"pr-3",style:{width:"calc(100% / 15)"}},null,8,["modelValue","onUpdate:modelValue","label"]))),128)),e(E,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:G=>v.$emit("open-detail",u.value.detail,P)},null,8,["onClick"])]),_:2},1024)],64))),128)),u.value.addSA?(S(!0),z(ee,{key:1},ue(u.value.addSA,(I,P)=>(S(),B(c,{key:P,cols:"12"},{default:l(()=>[e(ml,{color:"yellow"},{default:l(()=>[e(vl,null,{default:l(()=>[e(pl,null,{default:l(()=>[J(j(`Add Special Appeal ${P+1}`)+" ",1),e(Ve),e(E,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(G=>a("SA",P),["stop"])},null,8,["onClick"])]),_:2},1024),e(fl,null,{default:l(()=>[e(Ye,{modelValue:u.value.addSA[P],"onUpdate:modelValue":G=>u.value.addSA[P]=G,type:"addSA",index:P,onOpenDetail:f[7]||(f[7]=(G,le)=>v.$emit("open-detail",G,le))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ye("",!0),u.value.addSA&&D.value.includes("addSA")?(S(),B(c,{key:2,cols:"12"},{default:l(()=>[e(E,{color:"yellow","prepend-icon":"mdi-plus",text:"Add SA",block:"",onClick:f[8]||(f[8]=I=>o("SA"))})]),_:1})):ye("",!0),u.value.addSkill?(S(!0),z(ee,{key:3},ue(u.value.addSkill,(I,P)=>(S(),B(c,{key:P,cols:"12"},{default:l(()=>[e(ml,{color:"yellow"},{default:l(()=>[e(vl,null,{default:l(()=>[e(pl,null,{default:l(()=>[J(j(`Add Skill ${P+1}`)+" ",1),e(Ve),e(E,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(G=>a("Skill",P),["stop"])},null,8,["onClick"])]),_:2},1024),e(fl,null,{default:l(()=>[e(Ye,{modelValue:u.value.addSkill[P],"onUpdate:modelValue":G=>u.value.addSkill[P]=G,type:"addSkill",index:P,onOpenDetail:f[9]||(f[9]=(G,le)=>v.$emit("open-detail",G,le))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ye("",!0),u.value.addSkill&&D.value.includes("addCard")?(S(),B(c,{key:4,cols:"12"},{default:l(()=>[e(E,{color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",onClick:f[10]||(f[10]=I=>o("Skill"))})]),_:1})):ye("",!0)]),_:1})],64))}}),Ta={class:"d-flex align-center"},Pa={class:"text-center"},La={class:"text-center"},Ba=xe({__name:"EditDetailDataDialog",props:{modelValue:{type:Boolean},initialValues:{}},emits:["update:modelValue","save"],setup(p,{emit:T}){const C=p,R=T,w=[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,2,2.1,2.2,2.3,2.5],O={trunc:"整数",floor:"切り捨て",round:"四捨五入",ceil:"切り上げ"},u=m(0),L=m(!1),x=m(2),M=m("ceil"),$=m(!1),_=m([]),b=m([]),N=Z(()=>L.value?u.value/2.5:u.value);se(()=>C.modelValue,s=>{if(s){const o=JSON.parse(JSON.stringify(C.initialValues||[]));b.value=o.map(a=>a===null?"null":a),_.value=b.value.map(a=>String(a).endsWith("?")),$.value=_.value.every(Boolean)}});const V=s=>parseFloat(s.toFixed(10)),D=s=>{const o=String(b.value[s]||"");_.value[s]?o.endsWith("?")||(b.value[s]=o+"?"):o.endsWith("?")&&(b.value[s]=o.slice(0,-1))},h=()=>{_.value=_.value.map(()=>$.value),_.value.forEach((s,o)=>D(o))},k=s=>{const o=Math.pow(10,x.value);b.value=w.map((a,U)=>{const v=N.value*a;let f=0;switch(s){case"trunc":f=Math.trunc(V(v));break;case"floor":f=Math.floor(V(v*o))/o;break;case"round":f=Math.round(V(v*o))/o;break;case"ceil":f=Math.ceil(V(v*o))/o;break;default:f=0}return _.value[U]?String(f)+"?":f})},r=()=>{const s=b.value.map(o=>{const a=String(o);return a==="null"?null:a});R("save",s),R("update:modelValue",!1)};return(s,o)=>(S(),B(Le,{"model-value":p.modelValue,"max-width":"1200px","onUpdate:modelValue":o[7]||(o[7]=a=>s.$emit("update:modelValue",a))},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[...o[8]||(o[8]=[J("Edit Detail Data",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=a=>u.value=a),label:"Init Number",type:"number",min:"0",step:"0.1",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(We,{modelValue:L.value,"onUpdate:modelValue":o[1]||(o[1]=a=>L.value=a),label:"14",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=a=>x.value=a),label:"Decimal Point",type:"number",max:"9",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[y("div",Ta,[e(Q,{modelValue:M.value,"onUpdate:modelValue":o[3]||(o[3]=a=>M.value=a),items:Object.entries(O).map(([a,U])=>({title:U,value:a})),"item-title":"title","item-value":"value",label:"Data Format Type",variant:"outlined",density:"compact","hide-details":"",class:"mr-3"},null,8,["modelValue","items"]),e(E,{text:"Set",color:"primary","prepend-icon":"mdi-plus",onClick:o[4]||(o[4]=a=>k(M.value))})])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(rl,{density:"compact"},{default:l(()=>[y("thead",null,[y("tr",null,[o[9]||(o[9]=y("th",{class:"text-center"},"Level",-1)),o[10]||(o[10]=y("th",{class:"text-center"},"倍率",-1)),(S(),z(ee,null,ue(O,(a,U)=>y("th",{key:U,class:"text-center"},j(a),1)),64)),o[11]||(o[11]=y("th",{class:"text-center",style:{width:"125px"}},"Result",-1)),y("th",Pa,[e(hl,{modelValue:$.value,"onUpdate:modelValue":[o[5]||(o[5]=a=>$.value=a),h],color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])])])]),y("tbody",La,[(S(),z(ee,null,ue(w,(a,U)=>y("tr",{key:U},[y("td",null,j(U+1),1),y("td",null,j(a),1),y("td",null,j(Math.trunc(V(N.value*a))),1),y("td",null,j(Math.floor(V(N.value*a*Math.pow(10,x.value)))/Math.pow(10,x.value)),1),y("td",null,j(Math.round(V(N.value*a*Math.pow(10,x.value)))/Math.pow(10,x.value)),1),y("td",null,j(Math.ceil(V(N.value*a*Math.pow(10,x.value)))/Math.pow(10,x.value)),1),y("td",null,[e(K,{modelValue:b.value[U],"onUpdate:modelValue":v=>b.value[U]=v,variant:"underlined",density:"compact","hide-details":"",onKeyup:va(r,["enter"])},{"append-inner":l(()=>[e(E,{size:"x-small",variant:"text",color:"grey",class:"pa-0",style:{"min-width":"24px"},text:"null",onClick:v=>b.value[U]="null"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),y("td",null,[e(hl,{modelValue:_.value[U],"onUpdate:modelValue":[v=>_.value[U]=v,v=>D(U)],color:"pink",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(E,{text:"Cancel",color:"error",onClick:o[6]||(o[6]=a=>s.$emit("update:modelValue",!1))}),e(E,{text:"Save",color:"primary",onClick:r})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Fa={style:{width:"calc(100% / 6)"}},Ha={class:"mb-3"},ja={class:"d-flex justify-space-between mb-3"},Ka=["onClick"],qa={class:"text-subtitle-1 text-center mb-1"},Ja=["onChange"],za=xe({__name:"AddCard",setup(p){const T=Te(),C=gl(),R=["smile","pure","cool","mental","BP"],w=Z(()=>Object.entries(C.skillDetails).map(([F,n])=>({title:n.skillDetailName,value:F}))),O=()=>{k.value=!1},u=()=>{r.value=!1},L=yl(),x=m({}),M=m(""),$=m(!1),_=m(""),b=m("success"),N=m(""),V=m(!1),D=m([]),h=m(null),k=m(!0),r=m(!0),s=m(null),o=m(null),a=m(null),U=m(null),v=m(null),f=m(null),I=m([]),P=Z(()=>{if(!i.value.memberName)return[];const F=i.value.memberName,n=_l[F];return n?I.value.filter(t=>t.name.startsWith(`${n}_`)):[]}),G=F=>{F==="before"?s.value?.click():o.value?.click()},le=(F,n)=>{const t=F.target;if(t.files&&t.files.length>0){const H=t.files[0],W=new Image,ie=URL.createObjectURL(H);W.onload=()=>{const Ne=600/W.width,$e=Math.round(W.height*Ne);$e!==389&&(_.value=`画像のアスペクト比が不正です。
期待値: 600x389相当
検出: ${W.width}x${W.height} (リサイズ後: 600x${$e})`,b.value="warning",$.value=!0),URL.revokeObjectURL(ie)},W.src=ie;const te=new FileReader;n==="before"?(a.value=H,te.onload=ne=>v.value=ne.target?.result):(U.value=H,te.onload=ne=>f.value=ne.target?.result),te.readAsDataURL(H)}},ge=F=>{F==="before"?(a.value=null,v.value=null,i.value.imageUrl.before="",s.value&&(s.value.value="")):(U.value=null,f.value=null,i.value.imageUrl.after="",o.value&&(o.value.value=""))},Y=["standard","max"],oe=m(Y[1]),de=m({smile:0,pure:0,cool:0,mental:0,BP:100});se([de,oe],()=>{const F=oe.value==="max"?1.2:1;R.forEach(n=>{const t=Number(de.value[n]),H=/mental|BP/.test(n)?1:F;i.value.uniqueStatus[n]=isNaN(t)?0:Math.ceil(t/H)})},{deep:!0});const he=Z(()=>D.value&&h.value!==null?D.value[h.value]||[]:[]),De=(F,n)=>{D.value=F,h.value=n,V.value=!0},Se=F=>{h.value!==null&&(D.value[h.value]=F)},A=()=>{i.value.characteristic.addSkill.push(JSON.parse(JSON.stringify(X)))},d=F=>{i.value.characteristic.addSkill.splice(F,1)},X={...{ID:"",name:"",AP:0,detail:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},characteristic:{name:"",detail:"",type:[""]}},i=m({cardName:"",memberName:il.KAHO,rare:cl[3],styleType:Ul.PERFORMER.en,mood:Cl.HAPPY.en,gacha:{addSeason:"",period:ze.normal.en},year:2025,split:1,series:"",kana:"",imageUrl:{before:"",after:""},uniqueStatus:{smile:0,pure:0,cool:0,mental:0,BP:100},specialAppeal:{ID:"",name:"",AP:0,EXAP:[0,0,0,0,0,0,0,0,0,0,0,0,0,0],detail:[],addSA:[],addSkill:[]},skill:{ID:"",name:"",AP:0,detail:[],addSkill:[]},characteristic:{name:"",detail:"",type:[],addSkill:[]}}),pe=async()=>{if(!N.value)return;let F;try{F=JSON.parse(N.value)}catch{try{F=new Function("return "+N.value)(),N.value=JSON.stringify(F,null,2)}catch{_.value="JSONのフォーマットが不正です",b.value="error",$.value=!0;return}}try{const n=T.isDev?Ae:ce,t=Pe(ce.app),H={};for(const[W,ie]of Object.entries(F)){const te=i.value.rare;let ne="",me="";try{ne=await Ie(_e(t,`cardIllust/${W}_before.webp`))}catch{console.warn(`Before image not found for ${W}`)}try{me=await Ie(_e(t,`cardIllust/${W}_after.webp`))}catch{console.warn(`After image not found for ${W}`)}const Ne={...ie,imageUrl:{before:ne,after:me}};H[`cards/${pa(W.split("_")[0])}/${te}/${W}`]=Ne}await Be(be(n),H),_.value=`Uploaded to ${T.isDev?"Dev":"Prod"}`,b.value="success",$.value=!0}catch(n){console.error(n),_.value="Error uploading card data",b.value="error",$.value=!0}};Fe(async()=>{const F=be(Ae,"card");sl(F,n=>{const t=n.val();t&&(x.value=t)});try{const n=Pe(ce.app),t=_e(n,"cardIllust"),H=await kl(t),W=await Promise.all(H.items.map(async ie=>{const te=await Ie(ie);return{name:ie.name,url:te}}));I.value=W}catch(n){console.error("Error fetching card illustrations:",n),_.value="カード画像の読み込みに失敗しました",b.value="error",$.value=!0}}),se([()=>L.editTarget,x],([F,n])=>{if(F&&F.type==="card"&&F.id&&n&&Object.keys(n).length>0){let t=null,H,W;for(const te in n){for(const ne in n[te])if(n[te][ne][F.id]){t=n[te][ne][F.id],H=te,W=ne;break}if(t)break}if(!t)return;M.value=F.id,i.value.memberName=H,i.value.rare=W,i.value.cardName=t.cardName,i.value.kana=t.kana,i.value.series=t.series||"",i.value.styleType=t.styleType,i.value.mood=t.mood;const ie=Object.entries(ze).find(([te,ne])=>te===t.gacha.period);i.value.gacha.period=ie?ie[1].en:ze.normal.en,i.value.gacha.addSeason=t.gacha.addSeason,i.value.uniqueStatus={...t.uniqueStatus},t.specialAppeal&&(i.value.specialAppeal.ID=t.specialAppeal.ID,i.value.specialAppeal.name=t.specialAppeal.name,i.value.specialAppeal.AP=t.specialAppeal.AP,i.value.specialAppeal.detail=t.specialAppeal.detail||[]),t.skill&&(i.value.skill.ID=t.skill.ID,i.value.skill.name=t.skill.name,i.value.skill.AP=t.skill.AP,i.value.skill.detail=t.skill.detail||[]),t.characteristic&&(i.value.characteristic.name=t.characteristic.name,i.value.characteristic.detail=t.characteristic.detail,i.value.characteristic.type=t.characteristic.type||[]),t.imageUrl?(i.value.imageUrl.before=t.imageUrl.before||"",i.value.imageUrl.after=t.imageUrl.after||""):(i.value.imageUrl.before="",i.value.imageUrl.after=""),L.setEditTarget("","")}},{immediate:!0});function ke(){if(M.value)return M.value;const F=i.value.memberName,n=_l[F];let t=0;const H=x.value[F];if(H){for(const W in H)for(const ie in H[W])if(ie.startsWith(n+"_")){const te=parseInt(ie.split("_")[1],10);!isNaN(te)&&te>t&&(t=te)}}return`${n}_${String(t+1).padStart(3,"0")}`}function Ce(F){const n=Object.entries(ze).find(([,t])=>t.en===F);return n?n[0]:"normal"}const Je=Z(()=>{const F=ke(),n=Ce(i.value.gacha.period),t={cardName:i.value.cardName,styleType:i.value.styleType,mood:i.value.mood,series:i.value.series,kana:i.value.kana,gacha:{addSeason:i.value.gacha.addSeason,period:n},uniqueStatus:{smile:i.value.uniqueStatus.smile,pure:i.value.uniqueStatus.pure,cool:i.value.uniqueStatus.cool,mental:i.value.uniqueStatus.mental,BP:i.value.uniqueStatus.BP},imageUrl:{...i.value.imageUrl.before&&{before:""},after:""},...k.value&&{specialAppeal:{ID:i.value.specialAppeal.ID,name:i.value.specialAppeal.name,AP:i.value.specialAppeal.AP,detail:i.value.specialAppeal.detail}},skill:{ID:i.value.skill.ID,name:i.value.skill.name,AP:i.value.skill.AP,detail:i.value.skill.detail},...r.value&&{characteristic:{name:i.value.characteristic.name,detail:i.value.characteristic.detail,type:i.value.characteristic.type}}},H={[F]:t};return JSON.stringify(H,null,2)}),el=(F,n,t)=>new Promise((H,W)=>{const ie=new Image,te=new FileReader;te.onload=ne=>{ie.src=ne.target?.result},te.onerror=ne=>W(ne),ie.onload=()=>{const ne=n/ie.width,me=document.createElement("canvas");if(me.width=n,me.height=Math.round(ie.height*ne),me.height!==t){W(new Error(`画像サイズが不正です。
期待値: ${n}x${t}
実際: ${me.width}x${me.height}`));return}const Ne=me.getContext("2d");Ne?(Ne.drawImage(ie,0,0,me.width,me.height),me.toBlob($e=>{$e?H($e):W(new Error("Canvas to Blob failed"))},"image/webp")):W(new Error("Canvas context not available"))}}),ll=async()=>{try{const F=JSON.parse(Je.value),n=i.value.rare,t=Object.keys(F[n])[0],H=F[n][t],W=i.value.memberName,ie=Pe(ce.app),te=async me=>{const Ne=me==="before"?a.value:U.value;if(!Ne)return;const $e=await el(Ne,600,389),Vl=_e(ie,`cardIllust/${t}_${me}.webp`);await Ze(Vl,$e),H.imageUrl[me]=await Ie(Vl)};if(U.value)await te("after");else throw new Error("覚醒後画像(After)を設定してください");a.value&&await te("before");const ne={};ne[`card/${W}/${n}/${t}`]=H,await Be(be(Ae),ne),_.value="Dev環境にデータをアップロードしました",b.value="success",$.value=!0,M.value="",ge("before"),ge("after")}catch(F){console.error(F),_.value=F.message||"アップロードに失敗しました",b.value="error",$.value=!0}};return(F,n)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(ae,{class:"mb-3"},{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:i.value.memberName,"onUpdate:modelValue":n[0]||(n[0]=t=>i.value.memberName=t),label:"Member Name",items:Object.values(q(il)),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:i.value.rare,"onUpdate:modelValue":n[1]||(n[1]=t=>i.value.rare=t),label:"Rarity",items:q(cl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:i.value.styleType,"onUpdate:modelValue":n[2]||(n[2]=t=>i.value.styleType=t),label:"Style Type",items:Object.values(q(Ul)).map(t=>t.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:i.value.mood,"onUpdate:modelValue":n[3]||(n[3]=t=>i.value.mood=t),label:"Mood",items:Object.values(q(Cl)).map(t=>t.en),"item-title":"text","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:i.value.cardName,"onUpdate:modelValue":n[4]||(n[4]=t=>i.value.cardName=t),label:"Card Name",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:i.value.kana,"onUpdate:modelValue":n[5]||(n[5]=t=>i.value.kana=t),label:"Kana",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:i.value.series,"onUpdate:modelValue":n[6]||(n[6]=t=>i.value.series=t),label:"Series",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(ve,{class:"mb-2"},{default:l(()=>[...n[25]||(n[25]=[J("Unique Status",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(rl,{density:"compact"},{default:l(()=>[n[27]||(n[27]=y("thead",null,[y("tr",null,[y("th",null,"Training Level"),y("th",null,"Smile"),y("th",null,"Pure"),y("th",null,"Cool"),y("th",null,"Mental"),y("th",null,"BP")])],-1)),y("tbody",null,[y("tr",null,[y("td",Fa,[e(Q,{modelValue:oe.value,"onUpdate:modelValue":n[7]||(n[7]=t=>oe.value=t),items:Y,variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue"])]),(S(),z(ee,null,ue(R,t=>y("td",{key:t,style:{width:"calc(100% / 6)"}},[e(K,{modelValue:de.value[t],"onUpdate:modelValue":H=>de.value[t]=H,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))]),y("tr",null,[n[26]||(n[26]=y("td",{style:{width:"calc(100% / 6)"}},null,-1)),(S(),z(ee,null,ue(R,t=>y("td",{key:t,style:{width:"calc(100% / 6)"}},[e(K,{modelValue:i.value.uniqueStatus[t],"onUpdate:modelValue":H=>i.value.uniqueStatus[t]=H,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(ve,{class:"mb-2"},{default:l(()=>[...n[28]||(n[28]=[J("Gacha",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:i.value.gacha.period,"onUpdate:modelValue":n[8]||(n[8]=t=>i.value.gacha.period=t),label:"Period",items:Object.values(q(ze)).map(t=>t.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:i.value.year,"onUpdate:modelValue":n[9]||(n[9]=t=>i.value.year=t),label:"Year",type:"number",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"1"},{default:l(()=>[e(K,{modelValue:i.value.split,"onUpdate:modelValue":n[10]||(n[10]=t=>i.value.split=t),label:"Sprit",type:"number",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:i.value.gacha.addSeason,"onUpdate:modelValue":n[11]||(n[11]=t=>i.value.gacha.addSeason=t),label:"Add Season",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),y("div",Ha,[k.value?(S(),B(re,{key:1},{default:l(()=>[e(ve,{class:"d-flex text-no-wrap mb-2"},{default:l(()=>[n[29]||(n[29]=J(" Special Appeal ",-1)),e(Ve),e(E,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:O})]),_:1}),e(fe,null,{default:l(()=>[e(Ye,{modelValue:i.value.specialAppeal,"onUpdate:modelValue":n[13]||(n[13]=t=>i.value.specialAppeal=t),type:"SA",onOpenDetail:De},null,8,["modelValue"])]),_:1})]),_:1})):(S(),B(E,{key:0,text:"Add Special Appeal","prepend-icon":"mdi-plus",block:"",onClick:n[12]||(n[12]=t=>k.value=!0)}))]),e(re,{class:"mb-3"},{default:l(()=>[e(ve,{class:"text-no-wrap mb-2"},{default:l(()=>[...n[30]||(n[30]=[J("Skill",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(Ye,{modelValue:i.value.skill,"onUpdate:modelValue":n[14]||(n[14]=t=>i.value.skill=t),type:"skill",onOpenDetail:De},null,8,["modelValue"])]),_:1})]),_:1}),y("div",null,[r.value?(S(),B(re,{key:1},{default:l(()=>[e(ve,{class:"d-flex text-no-wrap"},{default:l(()=>[n[31]||(n[31]=J(" Characteristic ",-1)),e(Ve),e(E,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:u})]),_:1}),e(fe,null,{default:l(()=>[e(K,{modelValue:i.value.characteristic.name,"onUpdate:modelValue":n[16]||(n[16]=t=>i.value.characteristic.name=t),label:"Characteristic Name",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Me,{modelValue:i.value.characteristic.detail,"onUpdate:modelValue":n[17]||(n[17]=t=>i.value.characteristic.detail=t),label:"Characteristic Detail",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),n[32]||(n[32]=y("p",{class:"text-subtitle-1 mb-3"},"Type",-1)),e(ae,null,{default:l(()=>[(S(!0),z(ee,null,ue(i.value.characteristic.type,(t,H)=>(S(),B(c,{key:H,cols:"4",class:"d-flex align-center"},{default:l(()=>[e(Q,{modelValue:i.value.characteristic.type[H],"onUpdate:modelValue":W=>i.value.characteristic.type[H]=W,items:w.value,"item-title":"title","item-value":"value",label:`Type ${H+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items","label"]),e(E,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",onClick:W=>i.value.characteristic.type.splice(H,1)},null,8,["onClick"])]),_:2},1024))),128)),e(c,{cols:"4"},{default:l(()=>[e(E,{text:"Add Type","prepend-icon":"mdi-plus",block:"",onClick:n[18]||(n[18]=t=>i.value.characteristic.type.push(""))})]),_:1})]),_:1}),(S(!0),z(ee,null,ue(i.value.characteristic.addSkill,(t,H)=>(S(),B(c,{key:H,cols:"12",class:"mt-3"},{default:l(()=>[e(ml,{color:"yellow"},{default:l(()=>[e(vl,null,{default:l(()=>[e(pl,null,{default:l(()=>[J(j(`Add Skill ${H+1}`)+" ",1),e(Ve),e(E,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(W=>d(H),["stop"])},null,8,["onClick"])]),_:2},1024),e(fl,null,{default:l(()=>[e(Ye,{modelValue:i.value.characteristic.addSkill[H],"onUpdate:modelValue":W=>i.value.characteristic.addSkill[H]=W,type:"addSkill",index:H,onOpenDetail:De},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),i.value.characteristic.type.includes("addCard")?(S(),B(E,{key:0,color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",class:"mt-3",onClick:A})):ye("",!0)]),_:1})]),_:1})):(S(),B(E,{key:0,text:"Add Characteristic","prepend-icon":"mdi-plus",block:"",onClick:n[15]||(n[15]=t=>r.value=!0)}))])]),_:1}),e(c,{cols:"4"},{default:l(()=>[y("div",ja,[(S(),z(ee,null,ue(["before","after"],t=>y("div",{key:t,class:"position-relative cursor-pointer",style:{width:"49%"},onClick:H=>G(t)},[y("p",qa,j(t==="before"?"Before":"After"),1),e(Ue,{src:(t==="before"?v.value:f.value)||i.value.imageUrl[t]||q(Pl),width:"100%"},null,8,["src"]),(t==="before"?v.value:f.value)||i.value.imageUrl[t]?(S(),B(E,{key:0,icon:"mdi-close",size:"x-small",color:"error",style:{position:"absolute",top:"5px",right:"5px","z-index":"1"},onClick:Ke(H=>ge(t),["stop"])},null,8,["onClick"])):ye("",!0),y("input",{ref_for:!0,ref:H=>t==="before"?s.value=H:o.value=H,type:"file",accept:"image/webp",class:"d-none",onChange:H=>le(H,t)},null,40,Ja)],8,Ka)),64))]),e(Me,{label:"Result","auto-grow":"",readonly:"","model-value":Je.value},null,8,["model-value"]),e(E,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mr-2",onClick:n[19]||(n[19]=t=>F.navigator.clipboard.writeText(Je.value))}),e(E,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",onClick:ll})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Qe)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:i.value.rare,"onUpdate:modelValue":n[20]||(n[20]=t=>i.value.rare=t),label:"Rarity",items:q(cl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(Me,{modelValue:N.value,"onUpdate:modelValue":n[21]||(n[21]=t=>N.value=t)},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(E,{color:"green","prepend-icon":"mdi-cloud-upload",text:`${q(T).isDev?"Dev":"Prod"} Upload`,onClick:n[22]||(n[22]=t=>pe())},null,8,["text"])]),_:1})]),_:1}),e(Ba,{modelValue:V.value,"onUpdate:modelValue":n[23]||(n[23]=t=>V.value=t),"initial-values":he.value,onSave:Se},null,8,["modelValue","initial-values"]),e(He,{modelValue:$.value,"onUpdate:modelValue":n[24]||(n[24]=t=>$.value=t),timeout:3e3,color:b.value},{default:l(()=>[J(j(_.value),1)]),_:1},8,["modelValue","color"]),e(ae,null,{default:l(()=>[(S(!0),z(ee,null,ue(P.value,t=>(S(),B(c,{key:t.name,cols:"2"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,{class:"pa-0"},{default:l(()=>[e(Ue,{src:t.url,"aspect-ratio":"16/9",cover:""},null,8,["src"])]),_:2},1024),e(fe,{class:"py-2"},{default:l(()=>[J(j(t.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))}}),Ga={style:{"max-width":"300px"}},Xa={class:"d-flex justify-space-evenly mt-3"},Wa=xe({__name:"AddMusic",setup(p){const T=m(!1),C=m("group"),R=m(!1),w=m(null),O=m([]),u=m(null),L=m(null),x=m(!1),M=m(!1),$=m("データを一時保存しました"),_=m("success"),b=m(!1),N=m(null),V=m(null),D=Fl,h=yl(),k=Te(),r=m({});Fe(()=>{const A=be(Ae,"music");sl(A,d=>{const g=d.val();if(g&&(r.value=g,a.value.musicName==="")){const X=Object.keys(g).length,i=h.pendingList.filter(ke=>ke.type==="music"&&!g[Object.keys(ke.data)[0]]).length,pe=`m_${X+i+1}`;a.value.ID=pe,a.value.ID_original=pe,a.value.ID_preset=pe}})}),se([()=>h.editTarget,r],([A,d])=>{A&&A.type==="music"&&A.id&&d&&Object.keys(d).length>0&&d[A.id]&&(N.value=A.id,G(),h.setEditTarget("",""))},{immediate:!0});const s=Z(()=>{let A=Object.entries(r.value);return V.value&&(A=A.filter(([d,g])=>{const X=g.musicData.kana;return X?Hl(X.charAt(0))===V.value:!1})),A.map(([d,g])=>({title:g.title,value:d}))}),o=()=>{const A=Object.keys(r.value).length,d=h.pendingList.filter(X=>X.type==="music"&&!r.value[Object.keys(X.data)[0]]).length,g=`m_${A+d+1}`;return{ID:g,ID_original:g,ID_preset:g,musicName:"",musicData:{kana:"",singer:tl.HASUNOSORA,singer_group:"HASUNOSORA_105",singer_solo:[il.KAHO],releaseDate:{year:2026,month:1,date:1},numbering:"",BPM:{original:150,inGame:150},time:{minuts:1,seconds:0,miliSeconds:0},cover:!1},imageURL:"",attribute:Al.SMILE.en,BHcount:0,level:0,term:105,center:il.KAHO,bonusSkill:Nl.BEAT_HEART_UP,singingMembers:[],scoreData:{difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}}},a=m(o()),U=/^[\u3040-\u309F\u30FC0-9]*$/,v=[A=>U.test(A)||"ひらがなと数字のみ入力可能です"],f=Z({get:()=>{const A=a.value.musicData.releaseDate;return`${A.year}-${String(A.month).padStart(2,"0")}-${String(A.date).padStart(2,"0")}`},set:A=>{if(!A)return;const[d,g,X]=A.split("-").map(Number);a.value.musicData.releaseDate.year=d,a.value.musicData.releaseDate.month=g,a.value.musicData.releaseDate.date=X}});se(b,A=>{A&&(a.value.musicData.releaseDate={year:2099,month:12,date:31})});const I=Z(()=>a.value.musicName!==""&&a.value.musicData.kana!==""&&U.test(a.value.musicData.kana)),P=Z(()=>{if(C.value==="group"){const A=a.value.musicData.singer_group;return Ge[A].MEMBERS}else return a.value.musicData.singer_solo}),G=()=>{if(!N.value)return;const A=r.value[N.value];if(!A)return;if(T.value=!0,a.value.ID_preset=N.value,a.value.ID=T.value?N.value:a.value.ID_original,a.value.musicName=A.title,a.value.musicData.kana=A.musicData.kana,a.value.musicData.singer=A.musicData.singer,Object.values(tl).includes(A.musicData.singer)){C.value="group";const X=Object.entries(tl).find(([ke,Ce])=>Ce===A.musicData.singer),i=X?X[0]:null,pe=Object.entries(Ge).find(([ke,Ce])=>Ce.KEY===i&&JSON.stringify(Ce.MEMBERS)===JSON.stringify(A.singingMembers));pe&&(a.value.musicData.singer_group=pe[0])}else C.value="solo",a.value.musicData.singer_group=o().musicData.singer_group;a.value.musicData.singer_solo=A.singingMembers,a.value.musicData.releaseDate={...A.musicData.releaseDate},b.value=a.value.musicData.releaseDate.year===2099&&a.value.musicData.releaseDate.month===12&&a.value.musicData.releaseDate.date===31,a.value.musicData.numbering=A.musicData.numbering,a.value.musicData.BPM={...A.musicData.BPM},a.value.musicData.cover=A.musicData.cover;const d=A.musicData.time;a.value.musicData.time.minuts=Math.floor(d/60);const g=Math.floor(d%60);a.value.musicData.time.seconds=g,a.value.musicData.time.miliSeconds=parseFloat(((d-a.value.musicData.time.minuts*60-g)*10).toFixed(1)),a.value.imageURL=A.imageURL||"",a.value.attribute=A.attribute,a.value.BHcount=A.BHcount,a.value.level=A.level,a.value.term=A.term,a.value.center=A.center,a.value.bonusSkill=A.bonusSkill,a.value.singingMembers=[...A.singingMembers],A.scoreData?(x.value=!0,a.value.scoreData=JSON.parse(JSON.stringify(A.scoreData))):(x.value=!1,a.value.scoreData={difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}),N.value=null,w.value=null},le=()=>{T.value=!1,N.value=null,x.value=!1,w.value=null,C.value="group",a.value=o(),b.value=!1},ge=async()=>{try{const A=JSON.parse(Se.value),d=Object.keys(A)[0];if(R.value=!0,u.value){const X=Pe(ce.app),i=_e(X,`cdJacket/${u.value.name}`);try{if(await Ie(i),!confirm(`同名のファイル (${u.value.name}) が既に存在します。
上書きしますか？`)){R.value=!1;return}}catch{}const pe=await Ze(i,u.value),ke=await Ie(pe.ref);A[d].imageURL=ke,k.imageCache.llllMgr_musicImageUrls||(k.imageCache.llllMgr_musicImageUrls={}),k.imageCache.llllMgr_musicImageUrls[d]=ke}const g={};g[`music/${d}`]=A[d],await Be(be(Ae),g),$.value="Dev環境にデータをアップロードしました",_.value="success",M.value=!0,de()}catch(A){console.error("Failed to parse JSON",A),$.value="アップロードに失敗しました",_.value="error",M.value=!0}finally{R.value=!1}},Y=async()=>{if(!a.value.musicName)return;const A=Pe(ce.app),d=_e(A,"cdJacket");try{const X=(await kl(d)).items.find(i=>{const pe=i.name,ke=pe.lastIndexOf(".");return(ke!==-1?pe.substring(0,ke):pe)===a.value.musicName});if(X){const i=await Ie(X);a.value.imageURL=i,k.imageCache.llllMgr_musicImageUrls||(k.imageCache.llllMgr_musicImageUrls={}),k.imageCache.llllMgr_musicImageUrls[a.value.ID]=i,$.value="画像URLを取得しました",_.value="success",M.value=!0}else $.value="画像が見つかりませんでした",_.value="warning",M.value=!0}catch(g){console.error("Failed to fetch image",g),$.value="画像の取得に失敗しました",_.value="error",M.value=!0}},oe=A=>{const d=Array.isArray(A)?A[0]:A;if(!d){de();return}u.value=d;const g=new FileReader;g.onload=X=>{L.value=X.target?.result},g.readAsDataURL(d)},de=()=>{u.value=null,L.value=null,O.value=[],w.value&&(w.value.value="")},he=()=>{w.value?.click()},De=A=>{const d=A.target;d.files&&d.files.length>0&&oe(d.files[0])},Se=Z(()=>{const A=(a.value.musicData.time.minuts||0)*60+(a.value.musicData.time.seconds||0)+(a.value.musicData.time.miliSeconds||0)/10,d={[T.value?a.value.ID_preset:a.value.ID_original]:{title:a.value.musicName,musicData:{kana:a.value.musicData.kana,singer:C.value==="group"?tl[Ge[a.value.musicData.singer_group].KEY]:a.value.musicData.singer_solo.map(g=>ka(g)).join("、"),releaseDate:{year:a.value.musicData.releaseDate.year,month:a.value.musicData.releaseDate.month,date:a.value.musicData.releaseDate.date},numbering:a.value.musicData.numbering,BPM:{original:a.value.musicData.BPM.original,inGame:a.value.musicData.BPM.inGame},time:A,cover:a.value.musicData.cover},imageURL:a.value.imageURL,attribute:a.value.attribute,BHcount:a.value.BHcount,level:a.value.level,term:a.value.term,center:a.value.center,bonusSkill:a.value.bonusSkill,singingMembers:C.value==="group"?Ge[a.value.musicData.singer_group].MEMBERS:a.value.musicData.singer_solo}};return x.value&&(d[T.value?a.value.ID_preset:a.value.ID_original].scoreData={difficultyLevel:{NORMAL:a.value.scoreData.difficultyLevel.NORMAL,HARD:a.value.scoreData.difficultyLevel.HARD,EXPERT:a.value.scoreData.difficultyLevel.EXPERT,MASTER:a.value.scoreData.difficultyLevel.MASTER},maxCombo:{NORMAL:a.value.scoreData.maxCombo.NORMAL,HARD:a.value.scoreData.maxCombo.HARD,EXPERT:a.value.scoreData.maxCombo.EXPERT,MASTER:a.value.scoreData.maxCombo.MASTER}}),JSON.stringify(d,null,2)});return(A,d)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:V.value,"onUpdate:modelValue":d[0]||(d[0]=g=>V.value=g),label:"五十音",items:q(D),"item-title":"title","item-value":"value",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"7"},{default:l(()=>[e(Q,{modelValue:N.value,"onUpdate:modelValue":d[1]||(d[1]=g=>N.value=g),label:"Preset",items:s.value,"item-title":"title","item-value":"value",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(E,{color:"primary",text:"Set",disabled:!N.value,onClick:G},null,8,["disabled"]),e(E,{color:"warning",text:"Reset",class:"mx-2",onClick:le}),e(E,{color:"yellow","prepend-icon":"mdi-image-sync",text:"get",disabled:!a.value.musicName,onClick:Y},null,8,["disabled"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Qe)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{"model-value":T.value?a.value.ID_preset:a.value.ID_original,label:"Music ID",readonly:"","prepend-inner-icon":"mdi-information",density:"compact",variant:"outlined","hide-details":""},null,8,["model-value"])]),_:1}),e(c,{cols:"10"},{default:l(()=>[e(We,{modelValue:T.value,"onUpdate:modelValue":d[2]||(d[2]=g=>T.value=g),label:"ID Override",color:"pink",disabled:a.value.ID_preset===a.value.ID_original,class:"pl-2",density:"compact","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:a.value.musicName,"onUpdate:modelValue":d[3]||(d[3]=g=>a.value.musicName=g),label:"Song Title",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:a.value.musicData.kana,"onUpdate:modelValue":d[4]||(d[4]=g=>a.value.musicData.kana=g),label:"Kana",required:"",rules:v,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(fa,{modelValue:C.value,"onUpdate:modelValue":d[5]||(d[5]=g=>C.value=g),label:"Singer",inline:"",density:"compact","hide-details":""},{default:l(()=>[e(Il,{label:"Group",value:"group",color:"pink",class:"mr-3"}),e(Il,{label:"Solo",value:"solo",color:"pink"})]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:a.value.musicData.singer_group,"onUpdate:modelValue":d[6]||(d[6]=g=>a.value.musicData.singer_group=g),items:Object.entries(q(Ge)).map(([g,X])=>({title:X.NAME,value:g})),"item-title":"title","item-value":"value",label:"Group",disabled:C.value!=="group",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:a.value.musicData.singer_solo,"onUpdate:modelValue":d[7]||(d[7]=g=>a.value.musicData.singer_solo=g),items:q(ya)(),label:"Solo",multiple:"",disabled:C.value!=="solo",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(K,{modelValue:f.value,"onUpdate:modelValue":d[8]||(d[8]=g=>f.value=g),label:"Release Date",type:"date",disabled:b.value,required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(We,{modelValue:b.value,"onUpdate:modelValue":d[9]||(d[9]=g=>b.value=g),label:"Unknown Date",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:a.value.musicData.numbering,"onUpdate:modelValue":d[10]||(d[10]=g=>a.value.musicData.numbering=g),label:"Numbering",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.musicData.BPM.original,"onUpdate:modelValue":d[11]||(d[11]=g=>a.value.musicData.BPM.original=g),modelModifiers:{number:!0},label:"BPM (Original)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.musicData.BPM.inGame,"onUpdate:modelValue":d[12]||(d[12]=g=>a.value.musicData.BPM.inGame=g),modelModifiers:{number:!0},label:"BPM (In Game)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.musicData.time.minuts,"onUpdate:modelValue":d[13]||(d[13]=g=>a.value.musicData.time.minuts=g),modelModifiers:{number:!0},label:"Time (minuts)",type:"number",max:"9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.musicData.time.seconds,"onUpdate:modelValue":d[14]||(d[14]=g=>a.value.musicData.time.seconds=g),modelModifiers:{number:!0},label:"Time (seconds)",type:"number",max:"59",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.musicData.time.miliSeconds,"onUpdate:modelValue":d[15]||(d[15]=g=>a.value.musicData.time.miliSeconds=g),modelModifiers:{number:!0},label:"Time (miliSeconds)",type:"number",step:"0.1",max:"99.9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(We,{modelValue:a.value.musicData.cover,"onUpdate:modelValue":d[16]||(d[16]=g=>a.value.musicData.cover=g),label:"Cover",color:"pink",class:"pl-1",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:a.value.attribute,"onUpdate:modelValue":d[17]||(d[17]=g=>a.value.attribute=g),label:"Attribute",items:Object.values(q(Al)).map(g=>g.en),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.BHcount,"onUpdate:modelValue":d[18]||(d[18]=g=>a.value.BHcount=g),modelModifiers:{number:!0},label:"BH Count",type:"number",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.level,"onUpdate:modelValue":d[19]||(d[19]=g=>a.value.level=g),modelModifiers:{number:!0},label:"Level",type:"number",max:"1",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(K,{modelValue:a.value.term,"onUpdate:modelValue":d[20]||(d[20]=g=>a.value.term=g),modelModifiers:{number:!0},label:"Term",type:"number",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(ae,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:a.value.center,"onUpdate:modelValue":d[21]||(d[21]=g=>a.value.center=g),label:"Center",items:P.value,"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:a.value.bonusSkill,"onUpdate:modelValue":d[22]||(d[22]=g=>a.value.bonusSkill=g),label:"Bonus Skill",items:Object.entries(q(Nl)).map(([g,X])=>X),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[x.value?(S(),B(re,{key:1},{default:l(()=>[e(ve,{class:"mb-2"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[...d[28]||(d[28]=[J("Difficulty Level",-1)])]),_:1}),e(c,{cols:"6",class:"d-flex"},{default:l(()=>[d[29]||(d[29]=J(" Max Combo ",-1)),e(Ve),e(E,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:d[24]||(d[24]=g=>x.value=!1)})]),_:1})]),_:1})]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[(S(),z(ee,null,ue(["difficultyLevel","maxCombo"],g=>e(c,{key:g,cols:"6"},{default:l(()=>[e(ae,null,{default:l(()=>[(S(),z(ee,null,ue(["NORMAL","HARD","EXPERT","MASTER"],X=>e(c,{key:X,cols:"3"},{default:l(()=>[e(K,{modelValue:a.value.scoreData[g][X],"onUpdate:modelValue":i=>a.value.scoreData[g][X]=i,modelModifiers:{number:!0},label:X,type:"number",max:"99",min:"1",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})):(S(),B(E,{key:0,text:"Include Score Data (Difficulty Level & Max Combo)","prepend-icon":"mdi-plus",block:"",onClick:d[23]||(d[23]=g=>x.value=!0)}))]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(E,{color:"primary","prepend-icon":"mdi-content-copy",text:"Copy",class:"mr-5",onClick:d[25]||(d[25]=g=>A.navigator.clipboard.writeText(Se.value.value))}),e(E,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",disabled:!I.value,onClick:ge},null,8,["disabled"])]),_:1}),e(c,{cols:"12",align:"center"},{default:l(()=>[y("div",Ga,[e(Ue,{src:L.value||a.value.imageURL||q(ga)},null,8,["src"]),y("div",Xa,[e(E,{color:"primary","prepend-icon":"mdi-file-import",text:"Import Image",onClick:he}),e(E,{color:"error","prepend-icon":"mdi-close",text:"Delete",disabled:!u.value,onClick:de},null,8,["disabled"])])]),y("input",{ref_key:"fileInputRef",ref:w,type:"file",accept:"image/webp",class:"d-none",onChange:De},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:a.value.imageURL,"onUpdate:modelValue":d[26]||(d[26]=g=>a.value.imageURL=g),label:"Image URL","prepend-icon":"mdi-link-variant",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a.value.imageURL?(S(),B(c,{key:0,cols:"12",class:"text-center"})):ye("",!0),e(c,{cols:"12"},{default:l(()=>[e(Me,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":Se.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(He,{modelValue:M.value,"onUpdate:modelValue":d[27]||(d[27]=g=>M.value=g),timeout:3e3,color:_.value},{default:l(()=>[J(j($.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Ya={style:{width:"15%"}},Za={style:{width:"5%"}},Qa={style:{width:"5%"}},et={style:{width:"20%"}},lt={key:1},at={style:{width:"30%"}},tt={key:1},ut={style:{width:"25%"}},ot={key:1},it=xe({__name:"AddItem",setup(p){const T=Te(),C=m(105),R=m("Spring"),w=m(1),O=m(Array.from({length:15},()=>({skillBook:"ITEMS.NONE",piece:"ITEMS.NONE",charm:"ITEMS.NONE"}))),u=Z(()=>{const _=[{title:we.NONE,value:"ITEMS.NONE"}];return Object.entries(we.SKILL_BOOK).forEach(([b,N])=>{_.push({title:N,value:`ITEMS.SKILL_BOOK.${b}`})}),_}),L=Z(()=>{const _=[{title:we.NONE,value:"ITEMS.NONE"}];return Object.entries(we.CHARM).forEach(([b,N])=>{typeof N=="object"?Object.entries(N).forEach(([V,D])=>{_.push({title:D,value:`ITEMS.CHARM.${b}.${V}`})}):_.push({title:N,value:`ITEMS.CHARM.${b}`})}),_}),x=Z(()=>{const _=O.value.map(b=>`        {
          獲得可能アイテム: [${b.skillBook}, ${b.piece}, ${b.charm}],
          //'低確率獲得可能アイテム': ITEMS.SKILL_BOOK.LOW,
        }`).join(`,
`);return`    ${R.value}: [
      [
${_}
      ],
    ],`}),M=Z(()=>{const _=[{title:we.NONE,value:"ITEMS.NONE"}],b=N=>{Object.entries(we.PIECE[N]).forEach(([V,D])=>{_.push({title:D,value:`ITEMS.PIECE.${N}.${V}`})})};switch(b("GARNET"),b("CARNELIAN"),R.value){case"Spring":b("EMERALD"),b("DIA");break;case"Summer":b("PERIDOT"),b("RUBY");break;case"Autumn":b("TOPAZ"),b("SAPPHIRE");break;case"Winter":b("TURQUOISE"),b("AMETHYST");break}return _}),$=_=>{_=/技能書/.test(_)?_:_.split("(")[0];for(const b in $l)if(_===b)return $l[b]};return(_,b)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:C.value,"onUpdate:modelValue":b[0]||(b[0]=N=>C.value=N),items:[103,104,105],label:"Period",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:R.value,"onUpdate:modelValue":b[1]||(b[1]=N=>R.value=N),items:["Spring","Summer","Autumn","Winter"],label:"Season",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:w.value,"onUpdate:modelValue":b[2]||(b[2]=N=>w.value=N),items:[1,2,3,4,5],label:"Area",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Qe,{class:"my-5"}),e(rl,{density:"compact"},{default:l(()=>[b[4]||(b[4]=y("thead",null,[y("tr",null,[y("th",{style:{width:"15%"}},"期/季節"),y("th",{style:{width:"5%"}},"Area"),y("th",{style:{width:"5%"}},"Stage"),y("th",{style:{width:"20%"}},"Item (Skill Book)"),y("th",{style:{width:"30%"}},"Item (Piece)"),y("th",{style:{width:"25%"}},"Item (Charm)")])],-1)),y("tbody",null,[(S(),z(ee,null,ue(15,N=>y("tr",{key:N},[y("td",Ya,j(`${C.value}期${R.value}`),1),y("td",Za,j(w.value),1),y("td",Qa,j(N),1),y("td",et,[e(Q,{modelValue:O.value[N-1].skillBook,"onUpdate:modelValue":V=>O.value[N-1].skillBook=V,items:u.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:V,item:D})=>[e(Xe,je({ref_for:!0},V,{title:D.title}),{prepend:l(()=>[D.title!==q(we).NONE?(S(),B(Ue,{key:0,src:q(T).getImagePath("icons/trainingItem",D.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ye("",!0)]),_:2},1040,["title"])]),selection:l(({item:V})=>[V.title!==q(we).NONE?(S(),B(ul,{key:0,pill:"",class:"pl-0",color:$(V.title)},{default:l(()=>[e(ol,{left:"",class:"mr-1"},{default:l(()=>[e(Ue,{src:q(T).getImagePath("icons/trainingItem",V.title)},null,8,["src"])]),_:2},1024),J(" "+j(V.title),1)]),_:2},1032,["color"])):(S(),z("span",lt,j(V.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),y("td",at,[e(Q,{modelValue:O.value[N-1].piece,"onUpdate:modelValue":V=>O.value[N-1].piece=V,items:M.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:V,item:D})=>[e(Xe,je({ref_for:!0},V,{title:D.title}),{prepend:l(()=>[D.title!==q(we).NONE?(S(),B(Ue,{key:0,src:q(T).getImagePath("icons/trainingItem",D.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ye("",!0)]),_:2},1040,["title"])]),selection:l(({item:V})=>[V.title!==q(we).NONE?(S(),B(ul,{key:0,pill:"",class:"pl-0",color:$(V.title)},{default:l(()=>[e(ol,{left:"",class:"mr-1"},{default:l(()=>[e(Ue,{src:q(T).getImagePath("icons/trainingItem",V.title)},null,8,["src"])]),_:2},1024),J(" "+j(V.title),1)]),_:2},1032,["color"])):(S(),z("span",tt,j(V.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),y("td",ut,[e(Q,{modelValue:O.value[N-1].charm,"onUpdate:modelValue":V=>O.value[N-1].charm=V,items:L.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:V,item:D})=>[e(Xe,je({ref_for:!0},V,{title:D.title}),{prepend:l(()=>[D.title!==q(we).NONE?(S(),B(Ue,{key:0,src:q(T).getImagePath("icons/trainingItem",D.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ye("",!0)]),_:2},1040,["title"])]),selection:l(({item:V})=>[V.title!==q(we).NONE?(S(),B(ul,{key:0,pill:"",class:"pl-0",color:$(V.title)},{default:l(()=>[e(ol,{left:"",class:"mr-1"},{default:l(()=>[e(Ue,{src:q(T).getImagePath("icons/trainingItem",V.title)},null,8,["src"])]),_:2},1024),J(" "+j(V.title),1)]),_:2},1032,["color"])):(S(),z("span",ot,j(V.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])])])),64))])]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(E,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mb-3",onClick:b[3]||(b[3]=N=>_.navigator.clipboard.writeText(x.value))}),e(Me,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":x.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1}))}}),nl={heartCaptcha:"ハートキャプチャ系",loveAttract:"ラブアトラクト系",voltage:"ボルテージ系",mental:"メンタル系",extend:"手札枚数変更系",boost:"ブースト系",AP:"AP変化系",other:"その他"},nt={class:"text-h5"},st={class:"text-subtitle-2"},rt={class:"text-caption"},dt={class:"d-flex justify-end mt-3"},ct=xe({__name:"EditSkillDataDialog",props:{modelValue:{type:Boolean},isNew:{type:Boolean},item:{default:()=>({name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}})},existingItems:{}},emits:["update:modelValue","save"],setup(p,{emit:T}){const C=p,R=T,w=Te(),O=gl(),u=m({...C.item}),L=m(!1),x=m(0),M=m(null),$=m(!1),_=a=>{const U=u.value[a];return!U||!C.isNew&&C.item&&U===C.item[a]?!1:C.existingItems.some(v=>v[a]===U)},b=[a=>a?/^[\u3040-\u309F0-9ー]+$/.test(a)||"Only Hiragana and Numbers are allowed":!0],N=[a=>a?/^[a-zA-Z0-9_-]+$/.test(a)?!C.isNew&&a===C.item?.ID?!0:!C.existingItems.some(v=>v.ID===a)||"ID already exists":'Only half-width alphanumeric characters, "_", and "-" are allowed':"ID is required"];se(()=>C.modelValue,a=>{a&&(u.value=JSON.parse(JSON.stringify(C.item)))});const V=a=>{R("update:modelValue",a)},D=()=>{M.value=null,L.value=!0},h=a=>{M.value=a,L.value=!0},k=a=>{u.value.detail.type.splice(a,1)},r=a=>{const U={};if(!O.skillDetails)return U;for(const[v,f]of Object.entries(O.skillDetails))f.skillTypeKey===a&&(U[v]=f);return U},s=(a,U)=>{if(u.value.detail||(u.value.detail={attr:"",type:[]}),u.value.detail.type||(u.value.detail.type=[]),M.value!==null){if(u.value.detail.type.includes(a))return;u.value.detail.type[M.value]=a}else{if(u.value.detail.type.includes(a))return;u.value.detail.type.push(a)}L.value=!1,M.value=null},o=async()=>{const a=w.isDev?Ae:ce;if(!u.value.name||!u.value.ID){R("save",{...u.value,error:"SkillName and ID are required"});return}if(C.isNew&&C.existingItems.some(P=>P.ID===u.value.ID)){R("save",{...u.value,error:"This ID already exists"});return}$.value=!0;const{ID:U,...v}=u.value,f={};f[`skills/skill/${U}`]=v;try{await Be(be(a),f),R("save",u.value),V(!1)}catch(I){console.error(I),R("save",{...u.value,error:"Error saving data"})}finally{$.value=!1}};return(a,U)=>(S(),z(ee,null,[e(Le,{"model-value":p.modelValue,"max-width":"1280px","onUpdate:modelValue":V},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[y("span",nt,j(`${p.isNew?"New":"Edit"} Skill`),1)]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:u.value.name,"onUpdate:modelValue":U[0]||(U[0]=v=>u.value.name=v),label:"SkillName",variant:"outlined",density:"compact","base-color":_("name")?"warning":void 0,color:_("name")?"warning":void 0,messages:_("name")?"Warning: Skill Name already exists":void 0},null,8,["modelValue","base-color","color","messages"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:u.value.kana,"onUpdate:modelValue":U[1]||(U[1]=v=>u.value.kana=v),label:"Kana",variant:"outlined",density:"compact",rules:b,"validate-on":"blur"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(K,{modelValue:u.value.ID,"onUpdate:modelValue":U[2]||(U[2]=v=>u.value.ID=v),label:"ID",variant:"outlined",density:"compact",rules:N},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[...U[10]||(U[10]=[J("Text",-1)])]),_:1}),e(fe,null,{default:l(()=>[(S(!0),z(ee,null,ue(u.value.text,(v,f)=>(S(),z("div",{key:f,class:"d-flex align-center mb-4"},[e(K,{modelValue:u.value.text[f],"onUpdate:modelValue":I=>u.value.text[f]=I,label:`Text${f+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"]),e(E,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",disabled:u.value.text.length===1,onClick:I=>u.value.text.splice(f,1)},null,8,["disabled","onClick"])]))),128)),e(E,{"prepend-icon":"mdi-plus",text:"Add Text",variant:"outlined",block:"",onClick:U[3]||(U[3]=v=>u.value.text.push(""))})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[...U[11]||(U[11]=[J("Detail",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:u.value.detail.attr,"onUpdate:modelValue":U[4]||(U[4]=v=>u.value.detail.attr=v),label:"Attr",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),(S(!0),z(ee,null,ue(u.value.detail.type,(v,f)=>(S(),B(c,{key:f,cols:"6",md:"4"},{default:l(()=>[e(re,{color:q(O).skillDetails[v]?.colorCode,class:"d-flex flex-column fill-height"},{default:l(()=>[e(ve,{class:"d-flex text-no-wrap text-body-2"},{default:l(()=>[J(j(`Type ${f+1}`)+" ",1),e(Ve),e(E,{icon:"mdi-close",density:"compact",color:"error",size:"small",onClick:I=>k(f)},null,8,["onClick"])]),_:2},1024),q(O).skillDetails[v]?(S(),B(fe,{key:0,class:"pb-0"},{default:l(()=>[y("p",st,j(q(O).skillDetails[v].skillDetailName),1),y("p",rt,j(q(O).skillDetails[v].description),1)]),_:2},1024)):ye("",!0),e(Ve),e(qe,null,{default:l(()=>[e(E,{text:"Change Type",variant:"outlined",block:"",onClick:I=>h(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["color"])]),_:2},1024))),128)),e(c,{cols:"6",md:"4"},{default:l(()=>[e(E,{"prepend-icon":"mdi-plus",text:"Add Type",variant:"outlined",class:"py-2 fill-height",block:"",onClick:D})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(E,{color:"error",variant:"text",text:"Cancel",onClick:U[5]||(U[5]=v=>V(!1))}),e(E,{color:"primary",variant:"text",text:"Save",disabled:!u.value.name||!u.value.ID||_("ID"),loading:$.value,onClick:o},null,8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]),e(Le,{modelValue:L.value,"onUpdate:modelValue":U[9]||(U[9]=v=>L.value=v),"max-width":"1080px"},{default:l(()=>[e(El,{class:"pa-3"},{default:l(()=>[U[12]||(U[12]=y("h3",null,"Add Type",-1)),y("div",null,[e(Ll,{modelValue:x.value,"onUpdate:modelValue":U[6]||(U[6]=v=>x.value=v),color:"pink"},{default:l(()=>[(S(!0),z(ee,null,ue(q(nl),(v,f)=>(S(),B(Ee,{key:f,value:f},{default:l(()=>[J(j(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(Qe),e(Bl,{modelValue:x.value,"onUpdate:modelValue":U[7]||(U[7]=v=>x.value=v)},{default:l(()=>[(S(!0),z(ee,null,ue(q(nl),(v,f)=>(S(),B(Re,{key:f,value:f},{default:l(()=>[e(El,{style:{height:"500px","overflow-y":"auto"}},{default:l(()=>[e(Ol,{density:"compact"},{default:l(()=>[(S(!0),z(ee,null,ue(r(f),(I,P)=>(S(),B(Xe,{key:P,title:I.skillDetailName,subtitle:I.description,disabled:u.value.detail?.type?.includes(P),style:{"border-bottom":"1px solid #888"},onClick:G=>s(P,f)},{prepend:l(()=>[e(ol,{color:I.colorCode,size:"small",class:"mr-2"},null,8,["color"])]),_:2},1032,["title","subtitle","disabled","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),y("div",dt,[e(E,{color:"error",variant:"text",text:"Cancel",onClick:U[8]||(U[8]=v=>L.value=!1)})])]),_:1})]),_:1},8,["modelValue"])],64))}}),mt=xe({__name:"AddSkill",setup(p){const T=Te(),C=m({}),R=m(""),w=()=>{const h=be(ce,"skills/skill");sl(h,k=>{const r=k.val();C.value=r??{}})};Fe(w),se(()=>T.isDev,w);const O=Z(()=>{const h=[];if(!C.value)return h;for(const[k,r]of Object.entries(C.value))h.push({ID:k,...r});return h}),u=[{title:"ID",key:"ID"},{title:"Skill Name",key:"name"},{title:"Kana",key:"kana"},{title:"Attr",key:"detail.attr"},{title:"Edit",key:"edit",sortable:!1}],L=m(!1),x=m(!1),M=m({}),$=m(!1),_=m(""),b=m("success"),N=()=>{M.value={name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}},x.value=!0,L.value=!0},V=h=>{M.value=JSON.parse(JSON.stringify(h)),x.value=!1,L.value=!0},D=h=>{h.error?(_.value=h.error,b.value="error"):(_.value=`Saved to ${T.isDev?"Dev":"Prod"}`,b.value="success"),$.value=!0};return(h,k)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(K,{modelValue:R.value,"onUpdate:modelValue":k[0]||(k[0]=r=>R.value=r),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"ma-2"},{append:l(()=>[e(E,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:N})]),_:1},8,["modelValue"]),e(bl,{headers:u,items:O.value,search:R.value,density:"compact","items-per-page":50,hover:""},{"item.edit":l(({item:r})=>[e(Tl,{icon:"mdi-pencil",size:"small",onClick:s=>V(r)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1}),e(ct,{modelValue:L.value,"onUpdate:modelValue":k[1]||(k[1]=r=>L.value=r),"is-new":x.value,item:M.value,"existing-items":O.value,onSave:D},null,8,["modelValue","is-new","item","existing-items"]),e(He,{modelValue:$.value,"onUpdate:modelValue":k[2]||(k[2]=r=>$.value=r),timeout:3e3,color:b.value},{default:l(()=>[J(j(_.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),vt=xe({__name:"AddSkillDetail",setup(p){const T=Te(),C=gl(),R=m(""),w=Z(()=>Object.entries(nl).map(([k,r])=>({title:r,value:k}))),O=[{title:"ID",key:"id"},{title:"Skill Detail Name",key:"skillDetailName"},{title:"Color Code",key:"colorCode"},{title:"Skill Type",key:"skillTypeKey"},{title:"Description",key:"description"},{title:"Edit",key:"edit",sortable:!1}],u=Z(()=>{const k=Object.entries(C.skillDetails).map(([r,s])=>({id:r,...typeof s=="object"?s:{value:s}}));return R.value?k.filter(r=>r.skillTypeKey===R.value):k}),L=m(!1),x=m({id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"}),M=m(!1),$=m(!1),_=m(""),b=m("success"),N=()=>{x.value={id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"},M.value=!0,L.value=!0},V=k=>{x.value={...k},M.value=!1,L.value=!0},D=()=>{L.value=!1},h=async()=>{const k={};if(!x.value.id){_.value="ID is required",b.value="error",$.value=!0;return}if(M.value&&u.value.some(o=>o.id===x.value.id)){_.value="ID already exists",b.value="error",$.value=!0;return}const{id:r,...s}=x.value;k[`skills/skillDetail/${r}`]=s;try{await Be(be(ce),k),_.value=`Saved to ${T.isDev?"Dev":"Prod"}`,b.value="success",$.value=!0,L.value=!1}catch(o){console.error(o),_.value="Error saving data",b.value="error",$.value=!0}};return(k,r)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(Q,{modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=s=>R.value=s),items:w.value,label:"Filter by Skill Type","prepend-inner-icon":"mdi-filter",variant:"outlined","hide-details":"",class:"ma-2",clearable:""},{append:l(()=>[e(E,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:N})]),_:1},8,["modelValue","items"]),e(bl,{headers:O,items:u.value,density:"compact","items-per-page":-1,hover:""},{"item.colorCode":l(({value:s})=>[s?(S(),B(ul,{key:0,color:s,size:"small",variant:"flat"},{default:l(()=>[J(j(s),1)]),_:2},1032,["color"])):ye("",!0)]),"item.skillTypeKey":l(({value:s})=>[J(j(q(nl)[s]||s),1)]),"item.edit":l(({item:s})=>[e(E,{icon:"mdi-pencil",size:"small",onClick:o=>V(s)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),e(Le,{modelValue:L.value,"onUpdate:modelValue":r[6]||(r[6]=s=>L.value=s),"max-width":"600px"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[...r[8]||(r[8]=[J("Edit Skill Detail",-1)])]),_:1}),e(fe,null,{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:x.value.id,"onUpdate:modelValue":r[1]||(r[1]=s=>x.value.id=s),label:"ID",readonly:!M.value,disabled:!M.value,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","readonly","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:x.value.skillDetailName,"onUpdate:modelValue":r[2]||(r[2]=s=>x.value.skillDetailName=s),label:"Skill Detail Name",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:x.value.colorCode,"onUpdate:modelValue":r[3]||(r[3]=s=>x.value.colorCode=s),label:"Color Code",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:x.value.skillTypeKey,"onUpdate:modelValue":r[4]||(r[4]=s=>x.value.skillTypeKey=s),items:w.value,"item-title":"title","item-value":"value",label:"Skill Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Me,{modelValue:x.value.description,"onUpdate:modelValue":r[5]||(r[5]=s=>x.value.description=s),label:"Description",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(E,{text:"Cancel",color:"error",onClick:D}),e(E,{text:"Save",color:"primary",onClick:h})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:$.value,"onUpdate:modelValue":r[7]||(r[7]=s=>$.value=s),timeout:3e3,color:b.value},{default:l(()=>[J(j(_.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),pt={class:"text-h5"},ft={class:"d-flex justify-space-evenly mt-3"},yt=xe({__name:"EditEventDataDialog",props:{modelValue:{type:Boolean},eventData:{},isNew:{type:Boolean}},emits:["update:modelValue","save"],setup(p,{emit:T}){const C=p,R=T,w=m({}),O=m(null),u=m(null),L=m(null),x=["liveGP","live","movie","other"],M=s=>{if(!s||!Array.isArray(s)||s.length<5)return"";const[o,a,U,v,f]=s;return`${o}-${String(a).padStart(2,"0")}-${String(U).padStart(2,"0")}T${String(v).padStart(2,"0")}:${String(f).padStart(2,"0")}`},$=s=>{if(!s)return[];const o=new Date(s);return[o.getFullYear(),o.getMonth()+1,o.getDate(),o.getHours(),o.getMinutes()]};se(()=>C.modelValue,s=>{s&&C.eventData&&(w.value=JSON.parse(JSON.stringify(C.eventData)),V())});const _=Z({get:()=>M(w.value.firstDay),set:s=>w.value.firstDay=$(s)}),b=Z({get:()=>M(w.value.lastDay),set:s=>w.value.lastDay=$(s)}),N=s=>{const o=Array.isArray(s)?s[0]:s;if(!o){V();return}L.value=o;const a=new FileReader;a.onload=U=>{O.value=U.target?.result},a.readAsDataURL(o)},V=()=>{L.value=null,O.value=null,u.value&&(u.value.value="")},D=()=>{u.value?.click()},h=s=>{const o=s.target;o.files&&o.files.length>0&&N(o.files[0])},k=()=>{R("update:modelValue",!1)},r=()=>{R("save",{event:w.value,file:L.value})};return(s,o)=>(S(),B(Le,{"model-value":p.modelValue,"max-width":"1000px","onUpdate:modelValue":k},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[y("span",pt,j(`${p.isNew?"New":"Edit"} Event`),1)]),_:1}),e(fe,{class:"px-4 py-2"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:w.value.id,"onUpdate:modelValue":o[0]||(o[0]=a=>w.value.id=a),label:"Event ID",readonly:!p.isNew,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue","readonly"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:w.value.title,"onUpdate:modelValue":o[1]||(o[1]=a=>w.value.title=a),label:"Event Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(K,{modelValue:w.value.text,"onUpdate:modelValue":o[2]||(o[2]=a=>w.value.text=a),label:"Sub Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:w.value.type,"onUpdate:modelValue":o[3]||(o[3]=a=>w.value.type=a),label:"Event Type",items:x,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=a=>_.value=a),label:"First Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(K,{modelValue:b.value,"onUpdate:modelValue":o[5]||(o[5]=a=>b.value=a),label:"Last Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Ue,{src:O.value||w.value.imageUrl||q(Pl)},null,8,["src"]),y("div",ft,[e(E,{text:"Import Image","prepend-icon":"mdi-file-import",color:"primary",onClick:D}),e(E,{text:"Delete","prepend-icon":"mdi-close",color:"error",disabled:!L.value,onClick:V},null,8,["disabled"])]),y("input",{ref_key:"fileInputRef",ref:u,type:"file",accept:"image/webp",style:{display:"none"},onChange:h},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:w.value.link,"onUpdate:modelValue":o[6]||(o[6]=a=>w.value.link=a),label:"URL",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(qe,{class:"py-0"},{default:l(()=>[e(Ve),e(E,{text:"Cancel",color:"red",variant:"text",onClick:k}),e(E,{text:"Save",color:"primary",variant:"text",onClick:r})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),gt={class:"text-right mb-3"},kt=xe({__name:"AddEvent",setup(p){const T=Te(),C=m(!1),R=m(""),w=m("success"),O=m(!1),u=m(!1),L=[{title:"ID",key:"id",sortable:!1},{title:"Title",key:"title",sortable:!1},{title:"SubTitle",key:"text",sortable:!1},{title:"First Day",key:"firstDay"},{title:"Last Day",key:"lastDay"},{title:"Edit",key:"edit",sortable:!1}],x=r=>{if(!r||!Array.isArray(r))return"";const[s,o,a,U,v]=r;return`${s}/${String(o).padStart(2,"0")}/${String(a).padStart(2,"0")} ${String(U).padStart(2,"0")}:${String(v).padStart(2,"0")}`},M=m({}),$=async()=>{const r=T.isDev?Ae:ce,s=await Rl(be(r,"eventInformation"));s.exists()?M.value=s.val():M.value={}};Fe($),se(()=>T.isDev,$);const _=Z(()=>Object.entries(M.value).map(([r,s])=>({id:r,...s}))),b=async()=>{const r=T.isDev?Ae:ce,s=be(r,"cards");try{const o=await Rl(s);if(o.exists()){const a=o.val(),U=(v,f)=>{for(const I in v)I===f?delete v[I]:typeof v[I]=="object"&&v[I]!==null&&U(v[I],f)};U(a,"fluctuationStatus"),await ba(s,a),R.value="Updated Card List (removed fluctuationStatus)",w.value="success",C.value=!0}}catch(o){console.error(o),R.value="Error updating card list",w.value="error",C.value=!0}},N=m(null),V=(r,s)=>{const o=JSON.parse(JSON.stringify(s));r==="copy"&&(o.id=""),N.value=o,u.value=r!=="edit",O.value=!0},D=()=>{N.value={id:"",title:"",text:"",type:"liveGP",firstDay:[],lastDay:[],link:"",imageUrl:""},u.value=!0,O.value=!0},h=async r=>{if(!confirm(`Are you sure you want to delete "${r.title}"?`))return;const s=T.isDev?Ae:ce;try{await Va(be(s,`eventInformation/${r.id}`)),R.value="Deleted successfully",w.value="success",C.value=!0,await $()}catch(o){console.error(o),R.value="Error deleting event",w.value="error",C.value=!0}},k=async({event:r,file:s})=>{if(!r.id){R.value="ID is required",w.value="error",C.value=!0;return}const o=T.isDev?Ae:ce,{id:a,...U}=r;try{if(R.value="Uploading Now...",w.value="yellow",C.value=!0,s){const v=Pe(ce.app),f=_e(v,`event/${s.name}`),I=await Ze(f,s),P=await Ie(I.ref);U.imageUrl=P}await Be(be(o,`eventInformation/${a}`),U),R.value="Saved successfully",w.value="success",O.value=!1,await $()}catch(v){console.error(v),R.value="Error saving event",w.value="error"}};return(r,s)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[y("div",gt,[e(Ve),e(E,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:D})]),e(bl,{headers:L,items:_.value,class:"elevation-1","items-per-page":-1,"sort-by":[{key:"firstDay",order:"asc"}],hover:""},{"item.firstDay":l(({value:o})=>[J(j(x(o)),1)]),"item.lastDay":l(({value:o})=>[J(j(x(o)),1)]),"item.edit":l(({item:o})=>[e(E,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-pencil",onClick:a=>V("edit",o)},null,8,["onClick"]),e(E,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-content-copy",onClick:a=>V("copy",o)},null,8,["onClick"]),e(E,{size:"small",variant:"tonal",color:"error",icon:"mdi-delete",onClick:a=>h(o)},null,8,["onClick"])]),_:2},1032,["items"]),e(yt,{modelValue:O.value,"onUpdate:modelValue":s[0]||(s[0]=o=>O.value=o),"event-data":N.value,"is-new":u.value,onSave:k},null,8,["modelValue","event-data","is-new"]),e(ae,{class:"mt-2"},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(E,{text:"Update Card List",color:"yellow",onClick:b})]),_:1})]),_:1}),e(He,{modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=o=>C.value=o),color:w.value,timeout:2e3},{default:l(()=>[J(j(R.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),bt={key:0},Vt={style:{"white-space":"pre-wrap"}},Dt=xe({__name:"MngInfo",setup(p){const T=m([]),C=m([]),R=m(!1),w=m(""),O=m(""),u=m(!1),L=m(""),x=m("success"),M=Pe(ce.app),$=_e(M,"info"),_=async()=>{try{const h=await kl($);C.value=h.items.map(k=>({name:k.name,ref:k}))}catch(h){console.error(h),D("Failed to fetch file list","error")}},b=async()=>{if(!T.value||T.value.length===0)return;const h=T.value[0],k=_e(M,`info/${h.name}`);try{await Ze(k,h),D("Upload successful","success"),T.value=[],await _()}catch(r){console.error(r),D("Upload failed","error")}},N=async h=>{try{const k=await Ie(h.ref),s=await(await fetch(k)).text();w.value=h.name,O.value=s,R.value=!0}catch(k){console.error(k),D("Failed to load file content","error")}},V=async h=>{if(confirm(`Are you sure you want to delete "${h.name}"?`))try{await Sa(h.ref),D("Deleted successfully","success"),await _()}catch(k){console.error(k),D("Delete failed","error")}},D=(h,k)=>{L.value=h,x.value=k,u.value=!0};return Fe(()=>{_()}),(h,k)=>(S(),B(Oe,{fluid:""},{default:l(()=>[e(ae,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[...k[4]||(k[4]=[y("h2",null,"Info Management (MD Files)",-1)])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Da,{modelValue:T.value,"onUpdate:modelValue":k[0]||(k[0]=r=>T.value=r),label:"Select MD File",accept:".md","show-size":"","prepend-icon":"mdi-file-document-outline",variant:"outlined",density:"compact"},{"append-inner":l(()=>[e(E,{color:"primary",size:"small",class:"ml-2",disabled:!T.value||T.value.length===0,onClick:b},{default:l(()=>[...k[5]||(k[5]=[J(" Upload ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,null,{default:l(()=>[...k[6]||(k[6]=[J("File List (storage/info)",-1)])]),_:1}),e(rl,{density:"compact"},{default:l(()=>[k[8]||(k[8]=y("thead",null,[y("tr",null,[y("th",null,"Name"),y("th",null,"Actions")])],-1)),y("tbody",null,[(S(!0),z(ee,null,ue(C.value,r=>(S(),z("tr",{key:r.name},[y("td",null,j(r.name),1),y("td",null,[e(E,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:s=>N(r)},null,8,["onClick"]),e(E,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:s=>V(r)},null,8,["onClick"])])]))),128)),C.value.length===0?(S(),z("tr",bt,[...k[7]||(k[7]=[y("td",{colspan:"2",class:"text-center"},"No files found.",-1)])])):ye("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(Le,{modelValue:R.value,"onUpdate:modelValue":k[2]||(k[2]=r=>R.value=r),"max-width":"800px",scrollable:""},{default:l(()=>[e(re,null,{default:l(()=>[e(ve,{class:"d-flex justify-space-between align-center"},{default:l(()=>[y("span",null,j(w.value),1),e(E,{icon:"mdi-close",variant:"text",onClick:k[1]||(k[1]=r=>R.value=!1)})]),_:1}),e(fe,{style:{"max-height":"600px","overflow-y":"auto"}},{default:l(()=>[y("pre",Vt,j(O.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:u.value,"onUpdate:modelValue":k[3]||(k[3]=r=>u.value=r),color:x.value,timeout:3e3},{default:l(()=>[J(j(L.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),St={class:"d-flex align-center"},wt=xe({__name:"AddData",setup(p){const T=m("pendingDataList"),C=Te(),R=xa(),w=m(0),O=async()=>{const x=wa();try{await ha(x),R.push({name:"Home"})}catch(M){console.error("Logout failed",M)}},u=()=>{w.value++};se(()=>C.isDev,()=>{u()});const L=x=>{T.value=`${x}${x==="card"?"List":""}`};return(x,M)=>(S(),B(Oe,{fluid:"",class:"py-2 px-0"},{default:l(()=>[M[3]||(M[3]=y("h1",null,"DATA MANAGEMENT",-1)),y("div",St,[e(We,{modelValue:q(C).isDev,"onUpdate:modelValue":M[0]||(M[0]=$=>q(C).isDev=$),label:"isDev",color:"pink",density:"compact","hide-details":"","hide-input":"",class:"px-2"},null,8,["modelValue"]),e(E,{text:"Logout",color:"error","prepend-icon":"mdi-logout",size:"small",class:"mr-2",onClick:O}),e(E,{text:"Sync","prepend-icon":"mdi-refresh",size:"small",color:"primary",onClick:u})]),e(Ll,{modelValue:T.value,"onUpdate:modelValue":M[1]||(M[1]=$=>T.value=$),color:"pink"},{default:l(()=>[e(Ee,{value:"pendingDataList",text:"Pending Data"}),e(Ee,{value:"cardList",text:"Card"}),e(Ee,{value:"skillList",text:"Skill"}),e(Ee,{value:"skillDetail",text:"Skill Detail"}),e(Ee,{value:"music",text:"Music"}),e(Ee,{value:"item",text:"Item"}),e(Ee,{value:"event",text:"Event"}),e(Ee,{value:"info",text:"Info"})]),_:1},8,["modelValue"]),e(Qe,{class:"mb-2"}),e(Bl,{modelValue:T.value,"onUpdate:modelValue":M[2]||(M[2]=$=>T.value=$),class:"pt-3"},{default:l(()=>[e(Re,{value:"pendingDataList"},{default:l(()=>[(S(),B(Na,{key:w.value,onEdit:L}))]),_:1}),e(Re,{value:"cardList"},{default:l(()=>[(S(),B(za,{key:w.value}))]),_:1}),e(Re,{value:"skillList"},{default:l(()=>[(S(),B(mt,{key:w.value}))]),_:1}),e(Re,{value:"skillDetail"},{default:l(()=>[(S(),B(vt,{key:w.value}))]),_:1}),e(Re,{value:"music"},{default:l(()=>[(S(),B(Wa,{key:w.value}))]),_:1}),e(Re,{value:"item"},{default:l(()=>[(S(),B(it,{key:w.value}))]),_:1}),e(Re,{value:"event"},{default:l(()=>[(S(),B(kt,{key:w.value}))]),_:1}),e(Re,{value:"info"},{default:l(()=>[(S(),B(Dt,{key:w.value}))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{wt as default};
