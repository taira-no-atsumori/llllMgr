import{g as Bl,I as kl,u as Fl,a as Hl,b as jl,c as ql,r as m,w as Kl,o as Fe,d as oe,e as Jl,f as zl,h as Gl,V as bl,i as Vl,j as e,k as y,F as ee,l as Xl,m as je,n as Dl,v as Wl,p as Nl,q as sl,s as Yl,t as Qe,x as Zl,y as Q,z as Ql,A as ea,B as la,C as aa,D as ta,E as ua,G as oa,H as ia,J as Se,K as pl,L as S,M as B,N as Oe,O as l,P as q,Q as G,R as N,S as c,T as na,U as K,W as j,X as $l,Y as ue,Z as Ge,_ as sa,$ as qe,a0 as ra,a1 as le,a2 as re,a3 as fe,a4 as ke,a5 as Ke,a6 as Ve,a7 as Pe,a8 as He,a9 as Le,aa as me,ab as Ee,ac as Ye,ad as Re,ae as Be,af as be,ag as Te,ah as Z,ai as H,aj as El,ak as ge,al as dl,am as cl,an as ml,ao as vl,ap as ol,aq as Xe,ar as il,as as Sl,at as da,au as fl,av as Je,aw as xl,ax as wl,ay as rl,az as tl,aA as Ue,aB as $e,aC as Rl,aD as Ze,aE as ca,aF as ma,aG as va,aH as hl,aI as ze,aJ as pa,aK as Cl,aL as Ul,aM as fa,aN as el,aO as Ml,aP as ya,aQ as xe,aR as ll,aS as al,aT as Il,aU as _l,aV as Ol,aW as Ae,aX as Tl,aY as Ne,aZ as yl,a_ as Al,a$ as ga,b0 as ka,b1 as ba,b2 as Va,b3 as Da,b4 as Sa,b5 as xa}from"./index.js";const wa=aa({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:p=>!isNaN(parseFloat(p))},maxHeight:{type:[Number,String],validator:p=>!isNaN(parseFloat(p))},maxRows:{type:[Number,String],validator:p=>!isNaN(parseFloat(p))},suffix:String,modelModifiers:Object,...ia(),...ua(oa(),["direction"]),...ta()},"VTextarea"),Me=Bl()({name:"VTextarea",directives:{vIntersect:kl},inheritAttrs:!1,props:wa(),emits:{"click:control":p=>!0,"mousedown:control":p=>!0,"update:focused":p=>!0,"update:modelValue":p=>!0,"update:rows":p=>!0},setup(p,O){let{attrs:h,emit:E,slots:x}=O;const M=Fl(p,"modelValue"),{isFocused:o,focus:P,blur:D}=Hl(p),{onIntersect:R}=la(p),$=Q(()=>typeof p.counterValue=="function"?p.counterValue(M.value):(M.value||"").toString().length),U=Q(()=>{if(h.maxlength)return h.maxlength;if(!(!p.counter||typeof p.counter!="number"&&typeof p.counter!="string"))return p.counter}),k=m(),_=m(),b=ea(""),V=m(),w=m(0),{platform:g}=jl(),r=ql(p),n=Q(()=>p.persistentPlaceholder||o.value||p.active);function i(){r.isSuppressing.value&&r.update(),V.value!==document.activeElement&&V.value?.focus(),o.value||P()}function a(X){i(),E("click:control",X)}function C(X){E("mousedown:control",X)}function v(X){X.stopPropagation(),i(),Qe(()=>{M.value="",Ql(p["onClick:clear"],X)})}function f(X){const ie=X.target;if(!p.modelModifiers?.trim){M.value=ie.value;return}const de=ie.value,he=ie.selectionStart,we=ie.selectionEnd;M.value=de,Qe(()=>{let De=0;de.trimStart().length===ie.value.length&&(De=de.length-ie.value.length),he!=null&&(ie.selectionStart=he-De),we!=null&&(ie.selectionEnd=we-De)})}const I=m(),T=m(Number(p.rows)),J=Q(()=>["plain","underlined"].includes(p.variant));Kl(()=>{p.autoGrow||(T.value=Number(p.rows))});function Y(){Qe(()=>{if(!V.value)return;if(g.value.firefox){w.value=12;return}const{offsetWidth:X,clientWidth:ie}=V.value;w.value=Math.max(0,X-ie)}),p.autoGrow&&Qe(()=>{if(!I.value||!_.value)return;const X=getComputedStyle(I.value),ie=getComputedStyle(_.value.$el),de=parseFloat(X.getPropertyValue("--v-field-padding-top"))+parseFloat(X.getPropertyValue("--v-input-padding-top"))+parseFloat(X.getPropertyValue("--v-field-padding-bottom")),he=I.value.scrollHeight,we=parseFloat(X.lineHeight),De=Math.max(parseFloat(p.rows)*we+de,parseFloat(ie.getPropertyValue("--v-input-control-height"))),A=p.maxHeight?parseFloat(p.maxHeight):parseFloat(p.maxRows)*we+de||1/0,d=Zl(he??0,De,A);T.value=Math.floor((d-de)/we),b.value=sl(d)})}Fe(Y),oe(M,Y),oe(()=>p.rows,Y),oe(()=>p.maxHeight,Y),oe(()=>p.maxRows,Y),oe(()=>p.density,Y),oe(T,X=>{E("update:rows",X)});let ye;return oe(I,X=>{X?(ye=new ResizeObserver(Y),ye.observe(I.value)):ye?.disconnect()}),Jl(()=>{ye?.disconnect()}),zl(()=>{const X=!!(x.counter||p.counter||p.counterValue),ie=!!(X||x.details),[de,he]=Gl(h),{modelValue:we,...De}=bl.filterProps(p),A={...Vl.filterProps(p),"onClick:clear":v};return e(bl,je({ref:k,modelValue:M.value,"onUpdate:modelValue":d=>M.value=d,class:["v-textarea v-text-field",{"v-textarea--prefixed":p.prefix,"v-textarea--suffixed":p.suffix,"v-text-field--prefixed":p.prefix,"v-text-field--suffixed":p.suffix,"v-textarea--auto-grow":p.autoGrow,"v-textarea--no-resize":p.noResize||p.autoGrow,"v-input--plain-underlined":J.value},p.class],style:[{"--v-textarea-max-height":p.maxHeight?sl(p.maxHeight):void 0,"--v-textarea-scroll-bar-width":sl(w.value)},p.style]},de,De,{centerAffix:T.value===1&&!J.value,focused:o.value}),{...x,default:d=>{let{id:t,isDisabled:z,isDirty:ne,isReadonly:ve,isValid:pe,hasDetails:Ce}=d;return e(Vl,je({ref:_,style:{"--v-textarea-control-height":b.value},onClick:a,onMousedown:C,"onClick:prependInner":p["onClick:prependInner"],"onClick:appendInner":p["onClick:appendInner"]},A,{id:t.value,active:n.value||ne.value,labelId:`${t.value}-label`,centerAffix:T.value===1&&!J.value,dirty:ne.value||p.dirty,disabled:z.value,focused:o.value,details:Ce.value,error:pe.value===!1}),{...x,default:nl=>{let{props:{class:F,...s},controlRef:u}=nl;return y(ee,null,[p.prefix&&y("span",{class:"v-text-field__prefix"},[p.prefix]),Dl(y("textarea",je({ref:L=>V.value=u.value=L,class:F,value:M.value,onInput:f,autofocus:p.autofocus,readonly:ve.value,disabled:z.value,placeholder:p.placeholder,rows:p.rows,name:r.fieldName.value,autocomplete:r.fieldAutocomplete.value,onFocus:i,onBlur:D,"aria-labelledby":`${t.value}-label`},s,he),null),[[kl,{handler:R},null,{once:!0}]]),p.autoGrow&&Dl(y("textarea",{class:Nl([F,"v-textarea__sizer"]),id:`${s.id}-sizer`,"onUpdate:modelValue":L=>M.value=L,ref:I,readonly:!0,"aria-hidden":"true"},null),[[Wl,M.value]]),p.suffix&&y("span",{class:"v-text-field__suffix"},[p.suffix])])}})},details:ie?d=>y(ee,null,[x.details?.(d),X&&y(ee,null,[y("span",null,null),e(Xl,{active:p.persistentCounter||o.value,value:$.value,max:U.value,disabled:p.disabled},x.counter)])]):void 0})}),Yl({},k,_,V)}}),ha={key:0,class:"mb-4 text-grey"},Ca={key:1},Ua={class:"text-caption mr-2"},Ia={class:"text-caption"},_a=Se({__name:"PendingData",emits:["edit"],setup(p,{emit:O}){const h=pl(),E=m(!1),x=m(""),M=m(""),o=m([]),P=m(!1),D=m(!1),R=m(""),$=O,U=b=>{h.setEditTarget(b.type,b.key),$("edit",b.type)},k=b=>{if(M.value=JSON.stringify(b.data,null,2),b.status==="update"){let V=null;b.type==="music"?V=h.prodData.music[b.key]:b.type==="card"&&(V=h.flattenCards(h.prodData.card)[b.key]?.data),x.value=JSON.stringify(V,null,2)}else x.value="New Data"},_=async()=>{if(o.value.length===0)return;E.value=!0;const b=Le(me.app);try{const V={};for(const w of o.value){const g=h.diffList.find(i=>i.key===w);if(!g)continue;const r=JSON.parse(JSON.stringify(g.data));let n=null;if(g.type==="music"?n=h.prodData.music[g.key]:g.type==="card"&&(n=h.flattenCards(h.prodData.card)[g.key]?.data),r.imageURL&&r.imageURL.startsWith("http")&&(!n||!n.imageURL))try{const a=await(await fetch(r.imageURL)).blob();let C="webp";try{const Y=new URL(r.imageURL),X=decodeURIComponent(Y.pathname).match(/\.([a-zA-Z0-9]+)$/);X&&(C=X[1])}catch{}const v=`${w}.${C}`,f=g.type==="card"?"cardIllust":g.type==="music"?"cdJacket":"eventInformation",I=Ee(b,`${f}/${v}`),T=await Ye(I,a),J=await Re(T.ref);r.imageURL=J}catch(i){console.error(`Failed to copy image for ${w}:`,i)}V[g.path]=r}await Be(be(me),V),P.value=!0,o.value=[],x.value="",M.value=""}catch(V){console.error("Upload failed:",V),R.value=String(V),D.value=!0}finally{E.value=!1}};return(b,V)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[q(h).diffList.length===0?(S(),G("div",ha," Dev環境と本番環境のデータに差分はありません。 ")):(S(),G("div",Ca,[e(N,{text:"Deploy to Prod",color:"primary","prepend-icon":"mdi-cloud-upload",loading:E.value,disabled:o.value.length===0,onClick:_},null,8,["loading","disabled"]),e(le,{class:"mt-0"},{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(na,null,{default:l(()=>[K(" Diff: "+j(q(h).diffList.length),1)]),_:1}),e($l,{variant:"flat",class:"mb-4"},{default:l(()=>[(S(!0),G(ee,null,ue(q(h).diffList,w=>(S(),B(Ge,{key:w.key,class:Nl(w.status==="new"?"bg-blue-lighten-4":"bg-yellow-lighten-4"),onClick:g=>k(w)},{prepend:l(()=>[e(ra,{modelValue:o.value,"onUpdate:modelValue":V[0]||(V[0]=g=>o.value=g),value:w.key,color:"pink",onClick:V[1]||(V[1]=qe(()=>{},["stop"]))},null,8,["modelValue","value"])]),append:l(()=>[e(N,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:qe(g=>U(w),["stop"])},null,8,["onClick"])]),default:l(()=>[e(sa,null,{default:l(()=>[y("span",Ua,"["+j(w.type)+"]",1),K(" "+j(w.data.title||w.data.cardName||w.key)+" ",1),y("span",Ia,"("+j(w.status)+")",1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Me,{modelValue:x.value,"onUpdate:modelValue":V[2]||(V[2]=w=>x.value=w),label:"Prod (Before)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Me,{modelValue:M.value,"onUpdate:modelValue":V[3]||(V[3]=w=>M.value=w),label:"Dev (After)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1})]),_:1})])),e(Pe,{modelValue:D.value,"onUpdate:modelValue":V[5]||(V[5]=w=>D.value=w),"max-width":"600"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,{class:"text-h5 bg-error"},{default:l(()=>[...V[8]||(V[8]=[K("Upload Failed",-1)])]),_:1}),e(ke,{class:"pt-4"},{default:l(()=>[V[9]||(V[9]=y("p",null," アップロードに失敗しました。コンソールで詳細を確認してください。 ",-1)),V[10]||(V[10]=y("p",{class:"mt-4 font-weight-bold"},"エラーメッセージ:",-1)),e(Me,{"model-value":R.value,readonly:"",variant:"outlined",rows:"5","auto-grow":"",class:"mt-2"},null,8,["model-value"])]),_:1}),e(Ke,null,{default:l(()=>[e(Ve),e(N,{color:"primary",text:"Close",onClick:V[4]||(V[4]=w=>D.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:P.value,"onUpdate:modelValue":V[7]||(V[7]=w=>P.value=w),timeout:3e3,color:"success"},{actions:l(()=>[e(N,{variant:"text",text:"Close",onClick:V[6]||(V[6]=w=>P.value=!1)})]),default:l(()=>[V[11]||(V[11]=K(" Upload Completed! ",-1))]),_:1},8,["modelValue"])]),_:1}))}}),Pl=[{title:"あ行",value:"あ"},{title:"か行",value:"か"},{title:"さ行",value:"さ"},{title:"た行",value:"た"},{title:"な行",value:"な"},{title:"は行",value:"は"},{title:"ま行",value:"ま"},{title:"や行",value:"や"},{title:"ら行",value:"ら"},{title:"わ行",value:"わ"},{title:"数字",value:"other"}],Ll=p=>p?/[あ-おア-オ]/.test(p)?"あ":/[か-こカ-コが-ごガ-ゴ]/.test(p)?"か":/[さ-そサ-ソざ-ぞザ-ゾ]/.test(p)?"さ":/[た-とタ-トだ-どダ-ド]/.test(p)?"た":/[な-のナ-ノ]/.test(p)?"な":/[は-ほハ-ホば-ぼバ-ボぱ-ぽパ-ポ]/.test(p)?"は":/[ま-もマ-モ]/.test(p)?"ま":/[や-よヤ-ヨ]/.test(p)?"や":/[ら-ろラ-ロ]/.test(p)?"ら":/[わ-んワ-ン]/.test(p)?"わ":"other":"other",Aa={class:"d-flex mb-3"},Na={class:"pr-3",style:{width:"90%"}},$a={style:{width:"10%"}},Ea={key:0,class:"mb-3"},Ra={class:"text-subtitle-1"},We=Se({__name:"SkillFormComponent",props:{modelValue:{},type:{},index:{}},emits:["update:modelValue","open-detail"],setup(p,{emit:O}){const h=m(!1),E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=p,M=O,o=Q({get:()=>x.modelValue,set:v=>M("update:modelValue",v)}),P=Te(),D=m({}),R=()=>{const v=be(me,"skills/skill");ol(v,f=>{const I=f.val();if(I){for(const T in I)I[T]={ID:T,...I[T]};D.value=I}})};Fe(R),oe(()=>P.isDev,R),oe(D,v=>{if(Object.keys(v).length>0&&!x.modelValue.name&&!x.modelValue.ID){const f=k.value[0];f&&w(f.value)}});const $=m("all"),U=[{title:"All",value:"all"},...Pl],k=Q(()=>{const v=[],f=new Set;for(const I in D.value){const T=D.value[I],J=T.name,Y=T.kana;$.value!=="all"&&Ll(Y.charAt(0))!==$.value||f.has(J)||(f.add(J),v.push({title:J,value:I}))}return v.sort((I,T)=>I.title.localeCompare(T.title,"ja"))}),_=Q(()=>{switch(x.type){case"SA":return"Special Appeal";case"skill":return"Skill";case"addSA":return"Add Special Appeal";default:return"Skill"}}),b=Q(()=>{const v=o.value.name,f=[];if(!v)return f;for(const I in D.value)D.value[I].name===v&&f.push(D.value[I].ID);return f}),V=Q(()=>{const v=o.value.name,f=o.value.ID;return v&&f&&Object.keys(D.value).includes(f)?D.value[f].detail.type:[]}),w=v=>{if(!v)return;const f=[];for(const I in D.value)D.value[I].ID===v&&f.push(D.value[I]);f.length>0&&(o.value.ID=f[0].ID,o.value.name=f[0].name,g(f[0].ID))},g=v=>{if(!v)return;if(o.value.name){const I=D.value[v];if(I&&I.text){const T=Math.max(0,I.text.length-1);o.value.detail=new Array(T).fill(null).map(()=>[...E])}}},r={ID:"",name:"",AP:0,detail:[...E]},n={...r,characteristic:{name:"",detail:"",type:[""]}},i=v=>{o.value[`add${v}`]||(o.value[`add${v}`]=[]),o.value[`add${v}`].push(JSON.parse(JSON.stringify(v==="SA"?r:n)))},a=(v,f)=>{o.value[`add${v}`].splice(f,1)},C=()=>{let v="",f="",I=[];if(k.value.length>0){const T=k.value[0],J=D.value[T.value];if(J&&(v=J.ID,f=J.name,J.text)){const Y=Math.max(0,J.text.length-1);I=new Array(Y).fill(null).map(()=>[...E])}}o.value={...o.value,ID:v,name:f,AP:0,detail:I,addSA:[],addSkill:[]},h.value=!1};return(v,f)=>(S(),G(ee,null,[y("div",Aa,[y("div",Na,[e(Z,{modelValue:$.value,"onUpdate:modelValue":f[0]||(f[0]=I=>$.value=I),items:U,label:"Filter by Kana",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Z,{modelValue:o.value.name,"onUpdate:modelValue":[f[1]||(f[1]=I=>o.value.name=I),w],items:k.value,label:`${_.value} Name`,required:"",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue","items","label"]),e(Z,{modelValue:o.value.ID,"onUpdate:modelValue":[f[2]||(f[2]=I=>o.value.ID=I),g],items:b.value,label:`${_.value} ID`,required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","label"])]),y("div",$a,[e(H,{modelValue:o.value.AP,"onUpdate:modelValue":f[3]||(f[3]=I=>o.value.AP=I),modelModifiers:{number:!0},label:"AP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":"","bg-color":o.value.AP===0?"error":void 0,class:"mb-3"},null,8,["modelValue","bg-color"]),e(N,{text:"Reset",color:"primary",block:"",onClick:C})])]),p.type==="SA"&&o.value.ID?(S(),G("div",Ea,[h.value?(S(),B(H,{key:1,modelValue:o.value.EXAP,"onUpdate:modelValue":f[6]||(f[6]=I=>o.value.EXAP=I),modelModifiers:{number:!0},label:"SA EXAP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":""},{append:l(()=>[e(El,{color:"error",icon:"mdi-delete",onClick:f[5]||(f[5]=I=>h.value=!1)})]),_:1},8,["modelValue"])):(S(),B(N,{key:0,text:"Add EXAP","prepend-icon":"mdi-plus",block:"",onClick:f[4]||(f[4]=I=>h.value=!0)}))])):ge("",!0),e(le,null,{default:l(()=>[o.value.detail&&o.value.detail.length>0?(S(),B(c,{key:0,cols:"12",class:"d-flex align-center"},{default:l(()=>[y("p",Ra,j(_.value)+" Detail",1)]),_:1})):ge("",!0),(S(!0),G(ee,null,ue(o.value.detail,(I,T)=>(S(),G(ee,{key:T},[e(c,{cols:"12",class:"py-0"},{default:l(()=>[K("Detail "+j(T+1),1)]),_:2},1024),e(c,{cols:"12",class:"d-flex"},{default:l(()=>[(S(!0),G(ee,null,ue(o.value.detail[T],(J,Y)=>(S(),B(H,{key:Y,modelValue:o.value.detail[T][Y],"onUpdate:modelValue":ye=>o.value.detail[T][Y]=ye,label:`Level ${Y+1}`,variant:"underlined",density:"compact","hide-details":"",readonly:"",class:"pr-3",style:{width:"calc(100% / 15)"}},null,8,["modelValue","onUpdate:modelValue","label"]))),128)),e(N,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:J=>v.$emit("open-detail",o.value.detail,T)},null,8,["onClick"])]),_:2},1024)],64))),128)),o.value.addSA?(S(!0),G(ee,{key:1},ue(o.value.addSA,(I,T)=>(S(),B(c,{key:T,cols:"12"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[K(j(`Add Special Appeal ${T+1}`)+" ",1),e(Ve),e(N,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:qe(J=>a("SA",T),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(We,{modelValue:o.value.addSA[T],"onUpdate:modelValue":J=>o.value.addSA[T]=J,type:"addSA",index:T,onOpenDetail:f[7]||(f[7]=(J,Y)=>v.$emit("open-detail",J,Y))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ge("",!0),o.value.addSA&&V.value.includes("addSA")?(S(),B(c,{key:2,cols:"12"},{default:l(()=>[e(N,{color:"yellow","prepend-icon":"mdi-plus",text:"Add SA",block:"",onClick:f[8]||(f[8]=I=>i("SA"))})]),_:1})):ge("",!0),o.value.addSkill?(S(!0),G(ee,{key:3},ue(o.value.addSkill,(I,T)=>(S(),B(c,{key:T,cols:"12"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[K(j(`Add Skill ${T+1}`)+" ",1),e(Ve),e(N,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:qe(J=>a("Skill",T),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(We,{modelValue:o.value.addSkill[T],"onUpdate:modelValue":J=>o.value.addSkill[T]=J,type:"addSkill",index:T,onOpenDetail:f[9]||(f[9]=(J,Y)=>v.$emit("open-detail",J,Y))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ge("",!0),o.value.addSkill&&V.value.includes("addCard")?(S(),B(c,{key:4,cols:"12"},{default:l(()=>[e(N,{color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",onClick:f[10]||(f[10]=I=>i("Skill"))})]),_:1})):ge("",!0)]),_:1})],64))}}),Ma={class:"d-flex align-center"},Oa={class:"text-center"},Ta={class:"text-center"},Pa=Se({__name:"EditDetailDataDialog",props:{modelValue:{type:Boolean},initialValues:{}},emits:["update:modelValue","save"],setup(p,{emit:O}){const h=p,E=O,x=[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,2,2.1,2.2,2.3,2.5],M={trunc:"整数",floor:"切り捨て",round:"四捨五入",ceil:"切り上げ"},o=m(0),P=m(!1),D=m(2),R=m("ceil"),$=m(!1),U=m([]),k=m([]),_=Q(()=>P.value?o.value/2.5:o.value);oe(()=>h.modelValue,n=>{if(n){const i=JSON.parse(JSON.stringify(h.initialValues||[]));k.value=i.map(a=>a===null?"null":a),U.value=k.value.map(a=>String(a).endsWith("?")),$.value=U.value.every(Boolean)}});const b=n=>parseFloat(n.toFixed(10)),V=n=>{const i=String(k.value[n]||"");U.value[n]?i.endsWith("?")||(k.value[n]=i+"?"):i.endsWith("?")&&(k.value[n]=i.slice(0,-1))},w=()=>{U.value=U.value.map(()=>$.value),U.value.forEach((n,i)=>V(i))},g=n=>{const i=Math.pow(10,D.value);k.value=x.map((a,C)=>{const v=_.value*a;let f=0;switch(n){case"trunc":f=Math.trunc(b(v));break;case"floor":f=Math.floor(b(v*i))/i;break;case"round":f=Math.round(b(v*i))/i;break;case"ceil":f=Math.ceil(b(v*i))/i;break;default:f=0}return U.value[C]?String(f)+"?":f})},r=()=>{const n=k.value.map(i=>{const a=String(i);return a==="null"?null:a});E("save",n),E("update:modelValue",!1)};return(n,i)=>(S(),B(Pe,{"model-value":p.modelValue,"max-width":"1200px","onUpdate:modelValue":i[7]||(i[7]=a=>n.$emit("update:modelValue",a))},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...i[8]||(i[8]=[K("Edit Detail Data",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=a=>o.value=a),label:"Init Number",type:"number",min:"0",step:"0.1",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Xe,{modelValue:P.value,"onUpdate:modelValue":i[1]||(i[1]=a=>P.value=a),label:"14",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:D.value,"onUpdate:modelValue":i[2]||(i[2]=a=>D.value=a),label:"Decimal Point",type:"number",max:"9",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[y("div",Ma,[e(Z,{modelValue:R.value,"onUpdate:modelValue":i[3]||(i[3]=a=>R.value=a),items:Object.entries(M).map(([a,C])=>({title:C,value:a})),"item-title":"title","item-value":"value",label:"Data Format Type",variant:"outlined",density:"compact","hide-details":"",class:"mr-3"},null,8,["modelValue","items"]),e(N,{text:"Set",color:"primary","prepend-icon":"mdi-plus",onClick:i[4]||(i[4]=a=>g(R.value))})])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(il,{density:"compact"},{default:l(()=>[y("thead",null,[y("tr",null,[i[9]||(i[9]=y("th",{class:"text-center"},"Level",-1)),i[10]||(i[10]=y("th",{class:"text-center"},"倍率",-1)),(S(),G(ee,null,ue(M,(a,C)=>y("th",{key:C,class:"text-center"},j(a),1)),64)),i[11]||(i[11]=y("th",{class:"text-center",style:{width:"125px"}},"Result",-1)),y("th",Oa,[e(Sl,{modelValue:$.value,"onUpdate:modelValue":[i[5]||(i[5]=a=>$.value=a),w],color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])])])]),y("tbody",Ta,[(S(),G(ee,null,ue(x,(a,C)=>y("tr",{key:C},[y("td",null,j(C+1),1),y("td",null,j(a),1),y("td",null,j(Math.trunc(b(_.value*a))),1),y("td",null,j(Math.floor(b(_.value*a*Math.pow(10,D.value)))/Math.pow(10,D.value)),1),y("td",null,j(Math.round(b(_.value*a*Math.pow(10,D.value)))/Math.pow(10,D.value)),1),y("td",null,j(Math.ceil(b(_.value*a*Math.pow(10,D.value)))/Math.pow(10,D.value)),1),y("td",null,[e(H,{modelValue:k.value[C],"onUpdate:modelValue":v=>k.value[C]=v,variant:"underlined",density:"compact","hide-details":"",onKeyup:da(r,["enter"])},{"append-inner":l(()=>[e(N,{size:"x-small",variant:"text",color:"grey",class:"pa-0",style:{"min-width":"24px"},text:"null",onClick:v=>k.value[C]="null"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),y("td",null,[e(Sl,{modelValue:U.value[C],"onUpdate:modelValue":[v=>U.value[C]=v,v=>V(C)],color:"pink",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ke,null,{default:l(()=>[e(Ve),e(N,{text:"Cancel",color:"error",onClick:i[6]||(i[6]=a=>n.$emit("update:modelValue",!1))}),e(N,{text:"Save",color:"primary",onClick:r})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),La={style:{width:"calc(100% / 6)"}},Ba={class:"mb-3"},Fa={class:"d-flex justify-space-between mb-3"},Ha=["onClick"],ja={class:"text-subtitle-1 text-center mb-1"},qa=["onChange"],Ka=Se({__name:"AddCard",setup(p){const O=Te(),h=fl(),E=["smile","pure","cool","mental","BP"],x=Q(()=>Object.entries(h.skillDetails).map(([F,s])=>({title:s.skillDetailName,value:F}))),M=()=>{g.value=!1},o=()=>{r.value=!1},P=pl(),D=m({}),R=m(""),$=m(!1),U=m(""),k=m("success"),_=m(""),b=m(!1),V=m([]),w=m(null),g=m(!0),r=m(!0),n=m(null),i=m(null),a=m(null),C=m(null),v=m(null),f=m(null),I=F=>{F==="before"?n.value?.click():i.value?.click()},T=(F,s)=>{const u=F.target;if(u.files&&u.files.length>0){const L=u.files[0],W=new Image,se=URL.createObjectURL(L);W.onload=()=>{const Ie=600/W.width,_e=Math.round(W.height*Ie);_e!==389&&(U.value=`画像のアスペクト比が不正です。
期待値: 600x389相当
検出: ${W.width}x${W.height} (リサイズ後: 600x${_e})`,k.value="warning",$.value=!0),URL.revokeObjectURL(se)},W.src=se;const ae=new FileReader;s==="before"?(a.value=L,ae.onload=te=>v.value=te.target?.result):(C.value=L,ae.onload=te=>f.value=te.target?.result),ae.readAsDataURL(L)}},J=F=>{F==="before"?(a.value=null,v.value=null,t.value.imageUrl.before="",n.value&&(n.value.value="")):(C.value=null,f.value=null,t.value.imageUrl.after="",i.value&&(i.value.value=""))},Y=["standard","max"],ye=m(Y[1]),X=m({smile:0,pure:0,cool:0,mental:0,BP:100});oe([X,ye],()=>{const F=ye.value==="max"?1.2:1;E.forEach(s=>{const u=Number(X.value[s]),L=/mental|BP/.test(s)?1:F;t.value.uniqueStatus[s]=isNaN(u)?0:Math.ceil(u/L)})},{deep:!0});const ie=Q(()=>V.value&&w.value!==null?V.value[w.value]||[]:[]),de=(F,s)=>{V.value=F,w.value=s,b.value=!0},he=F=>{w.value!==null&&(V.value[w.value]=F)},we=()=>{t.value.characteristic.addSkill.push(JSON.parse(JSON.stringify(d)))},De=F=>{t.value.characteristic.addSkill.splice(F,1)},d={...{ID:"",name:"",AP:0,detail:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},characteristic:{name:"",detail:"",type:[""]}},t=m({cardName:"",memberName:tl.KAHO,rare:rl[3],styleType:wl.PERFORMER.en,mood:xl.HAPPY.en,gacha:{addSeason:"",period:Je.normal.en},year:2025,split:1,series:"",kana:"",imageUrl:{before:"",after:""},uniqueStatus:{smile:0,pure:0,cool:0,mental:0,BP:100},specialAppeal:{ID:"",name:"",AP:0,EXAP:[0,0,0,0,0,0,0,0,0,0,0,0,0,0],detail:[],addSA:[],addSkill:[]},skill:{ID:"",name:"",AP:0,detail:[],addSkill:[]},characteristic:{name:"",detail:"",type:[],addSkill:[]}}),z=async()=>{if(!_.value)return;let F;try{F=JSON.parse(_.value)}catch{try{F=new Function("return "+_.value)(),_.value=JSON.stringify(F,null,2)}catch{U.value="JSONのフォーマットが不正です",k.value="error",$.value=!0;return}}try{const s=O.isDev?Ue:me,u=Le(me.app),L={};for(const[W,se]of Object.entries(F)){const ae=t.value.rare;let te="",ce="";try{te=await Re(Ee(u,`cardIllust/${W}_before.webp`))}catch{console.warn(`Before image not found for ${W}`)}try{ce=await Re(Ee(u,`cardIllust/${W}_after.webp`))}catch{console.warn(`After image not found for ${W}`)}const Ie={...se,imageUrl:{before:te,after:ce}};L[`cards/${ca(W.split("_")[0])}/${ae}/${W}`]=Ie}await Be(be(s),L),U.value=`Uploaded to ${O.isDev?"Dev":"Prod"}`,k.value="success",$.value=!0}catch(s){console.error(s),U.value="Error uploading card data",k.value="error",$.value=!0}};Fe(()=>{const F=be(Ue,"card");ol(F,s=>{const u=s.val();u&&(D.value=u)})}),oe([()=>P.editTarget,D],([F,s])=>{if(F&&F.type==="card"&&F.id&&s&&Object.keys(s).length>0){let u=null,L,W;for(const ae in s){for(const te in s[ae])if(s[ae][te][F.id]){u=s[ae][te][F.id],L=ae,W=te;break}if(u)break}if(!u)return;R.value=F.id,t.value.memberName=L,t.value.rare=W,t.value.cardName=u.cardName,t.value.kana=u.kana,t.value.series=u.series||"",t.value.styleType=u.styleType,t.value.mood=u.mood;const se=Object.entries(Je).find(([ae,te])=>ae===u.gacha.period);t.value.gacha.period=se?se[1].en:Je.normal.en,t.value.gacha.addSeason=u.gacha.addSeason,t.value.uniqueStatus={...u.uniqueStatus},u.specialAppeal&&(t.value.specialAppeal.ID=u.specialAppeal.ID,t.value.specialAppeal.name=u.specialAppeal.name,t.value.specialAppeal.AP=u.specialAppeal.AP,t.value.specialAppeal.detail=u.specialAppeal.detail||[]),u.skill&&(t.value.skill.ID=u.skill.ID,t.value.skill.name=u.skill.name,t.value.skill.AP=u.skill.AP,t.value.skill.detail=u.skill.detail||[]),u.characteristic&&(t.value.characteristic.name=u.characteristic.name,t.value.characteristic.detail=u.characteristic.detail,t.value.characteristic.type=u.characteristic.type||[]),u.imageUrl?(t.value.imageUrl.before=u.imageUrl.before||"",t.value.imageUrl.after=u.imageUrl.after||""):(t.value.imageUrl.before="",t.value.imageUrl.after=""),P.setEditTarget("","")}},{immediate:!0});function ne(){if(R.value)return R.value;const F=t.value.memberName,s=ma[F];let u=0;const L=D.value[F];if(L){for(const W in L)for(const se in L[W])if(se.startsWith(s+"_")){const ae=parseInt(se.split("_")[1],10);!isNaN(ae)&&ae>u&&(u=ae)}}return`${s}_${String(u+1).padStart(3,"0")}`}function ve(F){const s=Object.entries(Je).find(([,u])=>u.en===F);return s?s[0]:"normal"}const pe=Q(()=>{const F=ne(),s=ve(t.value.gacha.period),u={cardName:t.value.cardName,styleType:t.value.styleType,mood:t.value.mood,series:t.value.series,kana:t.value.kana,gacha:{addSeason:t.value.gacha.addSeason,period:s},uniqueStatus:{smile:t.value.uniqueStatus.smile,pure:t.value.uniqueStatus.pure,cool:t.value.uniqueStatus.cool,mental:t.value.uniqueStatus.mental,BP:t.value.uniqueStatus.BP},imageUrl:{...t.value.imageUrl.before&&{before:""},after:""},...g.value&&{specialAppeal:{ID:t.value.specialAppeal.ID,name:t.value.specialAppeal.name,AP:t.value.specialAppeal.AP,detail:t.value.specialAppeal.detail}},skill:{ID:t.value.skill.ID,name:t.value.skill.name,AP:t.value.skill.AP,detail:t.value.skill.detail},...r.value&&{characteristic:{name:t.value.characteristic.name,detail:t.value.characteristic.detail,type:t.value.characteristic.type}}},L={[F]:u};return JSON.stringify(L,null,2)}),Ce=(F,s,u)=>new Promise((L,W)=>{const se=new Image,ae=new FileReader;ae.onload=te=>{se.src=te.target?.result},ae.onerror=te=>W(te),se.onload=()=>{const te=s/se.width,ce=document.createElement("canvas");if(ce.width=s,ce.height=Math.round(se.height*te),ce.height!==u){W(new Error(`画像サイズが不正です。
期待値: ${s}x${u}
実際: ${ce.width}x${ce.height}`));return}const Ie=ce.getContext("2d");Ie?(Ie.drawImage(se,0,0,ce.width,ce.height),ce.toBlob(_e=>{_e?L(_e):W(new Error("Canvas to Blob failed"))},"image/webp")):W(new Error("Canvas context not available"))}}),nl=async()=>{try{const F=JSON.parse(pe.value),s=t.value.rare,u=Object.keys(F[s])[0],L=F[s][u],W=t.value.memberName,se=Le(me.app),ae=async ce=>{const Ie=ce==="before"?a.value:C.value;if(!Ie)return;const _e=await Ce(Ie,600,389),gl=Ee(se,`cardIllust/${u}_${ce}.webp`);await Ye(gl,_e),L.imageUrl[ce]=await Re(gl)};if(C.value)await ae("after");else throw new Error("覚醒後画像(After)を設定してください");a.value&&await ae("before");const te={};te[`card/${W}/${s}/${u}`]=L,await Be(be(Ue),te),U.value="Dev環境にデータをアップロードしました",k.value="success",$.value=!0,R.value="",J("before"),J("after")}catch(F){console.error(F),U.value=F.message||"アップロードに失敗しました",k.value="error",$.value=!0}};return(F,s)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,{class:"mb-3"},{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Z,{modelValue:t.value.memberName,"onUpdate:modelValue":s[0]||(s[0]=u=>t.value.memberName=u),label:"Member Name",items:Object.values(q(tl)),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:t.value.rare,"onUpdate:modelValue":s[1]||(s[1]=u=>t.value.rare=u),label:"Rarity",items:q(rl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:t.value.styleType,"onUpdate:modelValue":s[2]||(s[2]=u=>t.value.styleType=u),label:"Style Type",items:Object.values(q(wl)).map(u=>u.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:t.value.mood,"onUpdate:modelValue":s[3]||(s[3]=u=>t.value.mood=u),label:"Mood",items:Object.values(q(xl)).map(u=>u.en),"item-title":"text","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:t.value.cardName,"onUpdate:modelValue":s[4]||(s[4]=u=>t.value.cardName=u),label:"Card Name",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:t.value.kana,"onUpdate:modelValue":s[5]||(s[5]=u=>t.value.kana=u),label:"Kana",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:t.value.series,"onUpdate:modelValue":s[6]||(s[6]=u=>t.value.series=u),label:"Series",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[...s[25]||(s[25]=[K("Unique Status",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(il,{density:"compact"},{default:l(()=>[s[27]||(s[27]=y("thead",null,[y("tr",null,[y("th",null,"Training Level"),y("th",null,"Smile"),y("th",null,"Pure"),y("th",null,"Cool"),y("th",null,"Mental"),y("th",null,"BP")])],-1)),y("tbody",null,[y("tr",null,[y("td",La,[e(Z,{modelValue:ye.value,"onUpdate:modelValue":s[7]||(s[7]=u=>ye.value=u),items:Y,variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue"])]),(S(),G(ee,null,ue(E,u=>y("td",{key:u,style:{width:"calc(100% / 6)"}},[e(H,{modelValue:X.value[u],"onUpdate:modelValue":L=>X.value[u]=L,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))]),y("tr",null,[s[26]||(s[26]=y("td",{style:{width:"calc(100% / 6)"}},null,-1)),(S(),G(ee,null,ue(E,u=>y("td",{key:u,style:{width:"calc(100% / 6)"}},[e(H,{modelValue:t.value.uniqueStatus[u],"onUpdate:modelValue":L=>t.value.uniqueStatus[u]=L,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[...s[28]||(s[28]=[K("Gacha",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Z,{modelValue:t.value.gacha.period,"onUpdate:modelValue":s[8]||(s[8]=u=>t.value.gacha.period=u),label:"Period",items:Object.values(q(Je)).map(u=>u.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:t.value.year,"onUpdate:modelValue":s[9]||(s[9]=u=>t.value.year=u),label:"Year",type:"number",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"1"},{default:l(()=>[e(H,{modelValue:t.value.split,"onUpdate:modelValue":s[10]||(s[10]=u=>t.value.split=u),label:"Sprit",type:"number",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:t.value.gacha.addSeason,"onUpdate:modelValue":s[11]||(s[11]=u=>t.value.gacha.addSeason=u),label:"Add Season",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),y("div",Ba,[g.value?(S(),B(re,{key:1},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap mb-2"},{default:l(()=>[s[29]||(s[29]=K(" Special Appeal ",-1)),e(Ve),e(N,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:M})]),_:1}),e(ke,null,{default:l(()=>[e(We,{modelValue:t.value.specialAppeal,"onUpdate:modelValue":s[13]||(s[13]=u=>t.value.specialAppeal=u),type:"SA",onOpenDetail:de},null,8,["modelValue"])]),_:1})]),_:1})):(S(),B(N,{key:0,text:"Add Special Appeal","prepend-icon":"mdi-plus",block:"",onClick:s[12]||(s[12]=u=>g.value=!0)}))]),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"text-no-wrap mb-2"},{default:l(()=>[...s[30]||(s[30]=[K("Skill",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(We,{modelValue:t.value.skill,"onUpdate:modelValue":s[14]||(s[14]=u=>t.value.skill=u),type:"skill",onOpenDetail:de},null,8,["modelValue"])]),_:1})]),_:1}),y("div",null,[r.value?(S(),B(re,{key:1},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap"},{default:l(()=>[s[31]||(s[31]=K(" Characteristic ",-1)),e(Ve),e(N,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:o})]),_:1}),e(ke,null,{default:l(()=>[e(H,{modelValue:t.value.characteristic.name,"onUpdate:modelValue":s[16]||(s[16]=u=>t.value.characteristic.name=u),label:"Characteristic Name",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Me,{modelValue:t.value.characteristic.detail,"onUpdate:modelValue":s[17]||(s[17]=u=>t.value.characteristic.detail=u),label:"Characteristic Detail",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),s[32]||(s[32]=y("p",{class:"text-subtitle-1 mb-3"},"Type",-1)),e(le,null,{default:l(()=>[(S(!0),G(ee,null,ue(t.value.characteristic.type,(u,L)=>(S(),B(c,{key:L,cols:"4",class:"d-flex align-center"},{default:l(()=>[e(Z,{modelValue:t.value.characteristic.type[L],"onUpdate:modelValue":W=>t.value.characteristic.type[L]=W,items:x.value,"item-title":"title","item-value":"value",label:`Type ${L+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items","label"]),e(N,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",onClick:W=>t.value.characteristic.type.splice(L,1)},null,8,["onClick"])]),_:2},1024))),128)),e(c,{cols:"4"},{default:l(()=>[e(N,{text:"Add Type","prepend-icon":"mdi-plus",block:"",onClick:s[18]||(s[18]=u=>t.value.characteristic.type.push(""))})]),_:1})]),_:1}),(S(!0),G(ee,null,ue(t.value.characteristic.addSkill,(u,L)=>(S(),B(c,{key:L,cols:"12",class:"mt-3"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[K(j(`Add Skill ${L+1}`)+" ",1),e(Ve),e(N,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:qe(W=>De(L),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(We,{modelValue:t.value.characteristic.addSkill[L],"onUpdate:modelValue":W=>t.value.characteristic.addSkill[L]=W,type:"addSkill",index:L,onOpenDetail:de},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),t.value.characteristic.type.includes("addCard")?(S(),B(N,{key:0,color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",class:"mt-3",onClick:we})):ge("",!0)]),_:1})]),_:1})):(S(),B(N,{key:0,text:"Add Characteristic","prepend-icon":"mdi-plus",block:"",onClick:s[15]||(s[15]=u=>r.value=!0)}))])]),_:1}),e(c,{cols:"4"},{default:l(()=>[y("div",Fa,[(S(),G(ee,null,ue(["before","after"],u=>y("div",{key:u,class:"position-relative cursor-pointer",style:{width:"49%"},onClick:L=>I(u)},[y("p",ja,j(u==="before"?"Before":"After"),1),e($e,{src:(u==="before"?v.value:f.value)||t.value.imageUrl[u]||q(Rl),width:"100%"},null,8,["src"]),(u==="before"?v.value:f.value)||t.value.imageUrl[u]?(S(),B(N,{key:0,icon:"mdi-close",size:"x-small",color:"error",style:{position:"absolute",top:"5px",right:"5px","z-index":"1"},onClick:qe(L=>J(u),["stop"])},null,8,["onClick"])):ge("",!0),y("input",{ref_for:!0,ref:L=>u==="before"?n.value=L:i.value=L,type:"file",accept:"image/webp",class:"d-none",onChange:L=>T(L,u)},null,40,qa)],8,Ha)),64))]),e(Me,{label:"Result","auto-grow":"",readonly:"","model-value":pe.value},null,8,["model-value"]),e(N,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mr-2",onClick:s[19]||(s[19]=u=>F.navigator.clipboard.writeText(pe.value))}),e(N,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",onClick:nl})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Ze)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:t.value.rare,"onUpdate:modelValue":s[20]||(s[20]=u=>t.value.rare=u),label:"Rarity",items:q(rl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(Me,{modelValue:_.value,"onUpdate:modelValue":s[21]||(s[21]=u=>_.value=u)},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(N,{color:"green","prepend-icon":"mdi-cloud-upload",text:`${q(O).isDev?"Dev":"Prod"} Upload`,onClick:s[22]||(s[22]=u=>z())},null,8,["text"])]),_:1})]),_:1}),e(Pa,{modelValue:b.value,"onUpdate:modelValue":s[23]||(s[23]=u=>b.value=u),"initial-values":ie.value,onSave:he},null,8,["modelValue","initial-values"]),e(He,{modelValue:$.value,"onUpdate:modelValue":s[24]||(s[24]=u=>$.value=u),timeout:3e3,color:k.value},{default:l(()=>[K(j(U.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Ja={style:{"max-width":"300px"}},za={class:"d-flex justify-space-evenly mt-3"},Ga=Se({__name:"AddMusic",setup(p){const O=m(!1),h=m("group"),E=m(!1),x=m(null),M=m([]),o=m(null),P=m(null),D=m(!1),R=m(!1),$=m("データを一時保存しました"),U=m("success"),k=m(!1),_=m(null),b=m(null),V=Pl,w=pl(),g=Te(),r=m({});Fe(()=>{const A=be(Ue,"music");ol(A,d=>{const t=d.val();if(t&&(r.value=t,a.value.musicName==="")){const z=Object.keys(t).length,ne=w.pendingList.filter(pe=>pe.type==="music"&&!t[Object.keys(pe.data)[0]]).length,ve=`m_${z+ne+1}`;a.value.ID=ve,a.value.ID_original=ve,a.value.ID_preset=ve}})}),oe([()=>w.editTarget,r],([A,d])=>{A&&A.type==="music"&&A.id&&d&&Object.keys(d).length>0&&d[A.id]&&(_.value=A.id,J(),w.setEditTarget("",""))},{immediate:!0});const n=Q(()=>{let A=Object.entries(r.value);return b.value&&(A=A.filter(([d,t])=>{const z=t.musicData.kana;return z?Ll(z.charAt(0))===b.value:!1})),A.map(([d,t])=>({title:t.title,value:d}))}),i=()=>{const A=Object.keys(r.value).length,d=w.pendingList.filter(z=>z.type==="music"&&!r.value[Object.keys(z.data)[0]]).length,t=`m_${A+d+1}`;return{ID:t,ID_original:t,ID_preset:t,musicName:"",musicData:{kana:"",singer:el.HASUNOSORA,singer_group:"HASUNOSORA_105",singer_solo:[tl.KAHO],releaseDate:{year:2026,month:1,date:1},numbering:"",BPM:{original:150,inGame:150},time:{minuts:1,seconds:0,miliSeconds:0},cover:!1},imageURL:"",attribute:Cl.SMILE.en,BHcount:0,level:0,term:105,center:tl.KAHO,bonusSkill:Ul.BEAT_HEART_UP,singingMembers:[],scoreData:{difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}}},a=m(i()),C=/^[\u3040-\u309F\u30FC0-9]*$/,v=[A=>C.test(A)||"ひらがなと数字のみ入力可能です"],f=Q({get:()=>{const A=a.value.musicData.releaseDate;return`${A.year}-${String(A.month).padStart(2,"0")}-${String(A.date).padStart(2,"0")}`},set:A=>{if(!A)return;const[d,t,z]=A.split("-").map(Number);a.value.musicData.releaseDate.year=d,a.value.musicData.releaseDate.month=t,a.value.musicData.releaseDate.date=z}});oe(k,A=>{A&&(a.value.musicData.releaseDate={year:2099,month:12,date:31})});const I=Q(()=>a.value.musicName!==""&&a.value.musicData.kana!==""&&C.test(a.value.musicData.kana)),T=Q(()=>{if(h.value==="group"){const A=a.value.musicData.singer_group;return ze[A].MEMBERS}else return a.value.musicData.singer_solo}),J=()=>{if(!_.value)return;const A=r.value[_.value];if(!A)return;if(O.value=!0,a.value.ID_preset=_.value,a.value.ID=O.value?_.value:a.value.ID_original,a.value.musicName=A.title,a.value.musicData.kana=A.musicData.kana,a.value.musicData.singer=A.musicData.singer,Object.values(el).includes(A.musicData.singer)){h.value="group";const z=Object.entries(el).find(([pe,Ce])=>Ce===A.musicData.singer),ne=z?z[0]:null,ve=Object.entries(ze).find(([pe,Ce])=>Ce.KEY===ne&&JSON.stringify(Ce.MEMBERS)===JSON.stringify(A.singingMembers));ve&&(a.value.musicData.singer_group=ve[0])}else h.value="solo",a.value.musicData.singer_group=i().musicData.singer_group;a.value.musicData.singer_solo=A.singingMembers,a.value.musicData.releaseDate={...A.musicData.releaseDate},k.value=a.value.musicData.releaseDate.year===2099&&a.value.musicData.releaseDate.month===12&&a.value.musicData.releaseDate.date===31,a.value.musicData.numbering=A.musicData.numbering,a.value.musicData.BPM={...A.musicData.BPM},a.value.musicData.cover=A.musicData.cover;const d=A.musicData.time;a.value.musicData.time.minuts=Math.floor(d/60);const t=Math.floor(d%60);a.value.musicData.time.seconds=t,a.value.musicData.time.miliSeconds=parseFloat(((d-a.value.musicData.time.minuts*60-t)*10).toFixed(1)),a.value.imageURL=A.imageURL||"",a.value.attribute=A.attribute,a.value.BHcount=A.BHcount,a.value.level=A.level,a.value.term=A.term,a.value.center=A.center,a.value.bonusSkill=A.bonusSkill,a.value.singingMembers=[...A.singingMembers],A.scoreData?(D.value=!0,a.value.scoreData=JSON.parse(JSON.stringify(A.scoreData))):(D.value=!1,a.value.scoreData={difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}),_.value=null,x.value=null},Y=()=>{O.value=!1,_.value=null,D.value=!1,x.value=null,h.value="group",a.value=i(),k.value=!1},ye=async()=>{try{const A=JSON.parse(De.value),d=Object.keys(A)[0];if(E.value=!0,o.value){const z=Le(me.app),ne=Ee(z,`cdJacket/${o.value.name}`);try{if(await Re(ne),!confirm(`同名のファイル (${o.value.name}) が既に存在します。
上書きしますか？`)){E.value=!1;return}}catch{}const ve=await Ye(ne,o.value),pe=await Re(ve.ref);A[d].imageURL=pe,g.imageCache.llllMgr_musicImageUrls||(g.imageCache.llllMgr_musicImageUrls={}),g.imageCache.llllMgr_musicImageUrls[d]=pe}const t={};t[`music/${d}`]=A[d],await Be(be(Ue),t),$.value="Dev環境にデータをアップロードしました",U.value="success",R.value=!0,de()}catch(A){console.error("Failed to parse JSON",A),$.value="アップロードに失敗しました",U.value="error",R.value=!0}finally{E.value=!1}},X=async()=>{if(!a.value.musicName)return;const A=Le(me.app),d=Ee(A,"cdJacket");try{const z=(await Ml(d)).items.find(ne=>{const ve=ne.name,pe=ve.lastIndexOf(".");return(pe!==-1?ve.substring(0,pe):ve)===a.value.musicName});if(z){const ne=await Re(z);a.value.imageURL=ne,g.imageCache.llllMgr_musicImageUrls||(g.imageCache.llllMgr_musicImageUrls={}),g.imageCache.llllMgr_musicImageUrls[a.value.ID]=ne,$.value="画像URLを取得しました",U.value="success",R.value=!0}else $.value="画像が見つかりませんでした",U.value="warning",R.value=!0}catch(t){console.error("Failed to fetch image",t),$.value="画像の取得に失敗しました",U.value="error",R.value=!0}},ie=A=>{const d=Array.isArray(A)?A[0]:A;if(!d){de();return}o.value=d;const t=new FileReader;t.onload=z=>{P.value=z.target?.result},t.readAsDataURL(d)},de=()=>{o.value=null,P.value=null,M.value=[],x.value&&(x.value.value="")},he=()=>{x.value?.click()},we=A=>{const d=A.target;d.files&&d.files.length>0&&ie(d.files[0])},De=Q(()=>{const A=(a.value.musicData.time.minuts||0)*60+(a.value.musicData.time.seconds||0)+(a.value.musicData.time.miliSeconds||0)/10,d={[O.value?a.value.ID_preset:a.value.ID_original]:{title:a.value.musicName,musicData:{kana:a.value.musicData.kana,singer:h.value==="group"?el[ze[a.value.musicData.singer_group].KEY]:a.value.musicData.singer_solo.map(t=>ya(t)).join("、"),releaseDate:{year:a.value.musicData.releaseDate.year,month:a.value.musicData.releaseDate.month,date:a.value.musicData.releaseDate.date},numbering:a.value.musicData.numbering,BPM:{original:a.value.musicData.BPM.original,inGame:a.value.musicData.BPM.inGame},time:A,cover:a.value.musicData.cover},imageURL:a.value.imageURL,attribute:a.value.attribute,BHcount:a.value.BHcount,level:a.value.level,term:a.value.term,center:a.value.center,bonusSkill:a.value.bonusSkill,singingMembers:h.value==="group"?ze[a.value.musicData.singer_group].MEMBERS:a.value.musicData.singer_solo}};return D.value&&(d[O.value?a.value.ID_preset:a.value.ID_original].scoreData={difficultyLevel:{NORMAL:a.value.scoreData.difficultyLevel.NORMAL,HARD:a.value.scoreData.difficultyLevel.HARD,EXPERT:a.value.scoreData.difficultyLevel.EXPERT,MASTER:a.value.scoreData.difficultyLevel.MASTER},maxCombo:{NORMAL:a.value.scoreData.maxCombo.NORMAL,HARD:a.value.scoreData.maxCombo.HARD,EXPERT:a.value.scoreData.maxCombo.EXPERT,MASTER:a.value.scoreData.maxCombo.MASTER}}),JSON.stringify(d,null,2)});return(A,d)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=t=>b.value=t),label:"五十音",items:q(V),"item-title":"title","item-value":"value",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"7"},{default:l(()=>[e(Z,{modelValue:_.value,"onUpdate:modelValue":d[1]||(d[1]=t=>_.value=t),label:"Preset",items:n.value,"item-title":"title","item-value":"value",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(N,{color:"primary",text:"Set",disabled:!_.value,onClick:J},null,8,["disabled"]),e(N,{color:"warning",text:"Reset",class:"mx-2",onClick:Y}),e(N,{color:"yellow","prepend-icon":"mdi-image-sync",text:"get",disabled:!a.value.musicName,onClick:X},null,8,["disabled"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Ze)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{"model-value":O.value?a.value.ID_preset:a.value.ID_original,label:"Music ID",readonly:"","prepend-inner-icon":"mdi-information",density:"compact",variant:"outlined","hide-details":""},null,8,["model-value"])]),_:1}),e(c,{cols:"10"},{default:l(()=>[e(Xe,{modelValue:O.value,"onUpdate:modelValue":d[2]||(d[2]=t=>O.value=t),label:"ID Override",color:"pink",disabled:a.value.ID_preset===a.value.ID_original,class:"pl-2",density:"compact","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:a.value.musicName,"onUpdate:modelValue":d[3]||(d[3]=t=>a.value.musicName=t),label:"Song Title",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:a.value.musicData.kana,"onUpdate:modelValue":d[4]||(d[4]=t=>a.value.musicData.kana=t),label:"Kana",required:"",rules:v,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(va,{modelValue:h.value,"onUpdate:modelValue":d[5]||(d[5]=t=>h.value=t),label:"Singer",inline:"",density:"compact","hide-details":""},{default:l(()=>[e(hl,{label:"Group",value:"group",color:"pink",class:"mr-3"}),e(hl,{label:"Solo",value:"solo",color:"pink"})]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Z,{modelValue:a.value.musicData.singer_group,"onUpdate:modelValue":d[6]||(d[6]=t=>a.value.musicData.singer_group=t),items:Object.entries(q(ze)).map(([t,z])=>({title:z.NAME,value:t})),"item-title":"title","item-value":"value",label:"Group",disabled:h.value!=="group",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Z,{modelValue:a.value.musicData.singer_solo,"onUpdate:modelValue":d[7]||(d[7]=t=>a.value.musicData.singer_solo=t),items:q(pa)(),label:"Solo",multiple:"",disabled:h.value!=="solo",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(H,{modelValue:f.value,"onUpdate:modelValue":d[8]||(d[8]=t=>f.value=t),label:"Release Date",type:"date",disabled:k.value,required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(Xe,{modelValue:k.value,"onUpdate:modelValue":d[9]||(d[9]=t=>k.value=t),label:"Unknown Date",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:a.value.musicData.numbering,"onUpdate:modelValue":d[10]||(d[10]=t=>a.value.musicData.numbering=t),label:"Numbering",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.musicData.BPM.original,"onUpdate:modelValue":d[11]||(d[11]=t=>a.value.musicData.BPM.original=t),modelModifiers:{number:!0},label:"BPM (Original)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.musicData.BPM.inGame,"onUpdate:modelValue":d[12]||(d[12]=t=>a.value.musicData.BPM.inGame=t),modelModifiers:{number:!0},label:"BPM (In Game)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.musicData.time.minuts,"onUpdate:modelValue":d[13]||(d[13]=t=>a.value.musicData.time.minuts=t),modelModifiers:{number:!0},label:"Time (minuts)",type:"number",max:"9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.musicData.time.seconds,"onUpdate:modelValue":d[14]||(d[14]=t=>a.value.musicData.time.seconds=t),modelModifiers:{number:!0},label:"Time (seconds)",type:"number",max:"59",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.musicData.time.miliSeconds,"onUpdate:modelValue":d[15]||(d[15]=t=>a.value.musicData.time.miliSeconds=t),modelModifiers:{number:!0},label:"Time (miliSeconds)",type:"number",step:"0.1",max:"99.9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Xe,{modelValue:a.value.musicData.cover,"onUpdate:modelValue":d[16]||(d[16]=t=>a.value.musicData.cover=t),label:"Cover",color:"pink",class:"pl-1",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:a.value.attribute,"onUpdate:modelValue":d[17]||(d[17]=t=>a.value.attribute=t),label:"Attribute",items:Object.values(q(Cl)).map(t=>t.en),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.BHcount,"onUpdate:modelValue":d[18]||(d[18]=t=>a.value.BHcount=t),modelModifiers:{number:!0},label:"BH Count",type:"number",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.level,"onUpdate:modelValue":d[19]||(d[19]=t=>a.value.level=t),modelModifiers:{number:!0},label:"Level",type:"number",max:"1",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(H,{modelValue:a.value.term,"onUpdate:modelValue":d[20]||(d[20]=t=>a.value.term=t),modelModifiers:{number:!0},label:"Term",type:"number",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Z,{modelValue:a.value.center,"onUpdate:modelValue":d[21]||(d[21]=t=>a.value.center=t),label:"Center",items:T.value,"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(Z,{modelValue:a.value.bonusSkill,"onUpdate:modelValue":d[22]||(d[22]=t=>a.value.bonusSkill=t),label:"Bonus Skill",items:Object.entries(q(Ul)).map(([t,z])=>z),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[D.value?(S(),B(re,{key:1},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[...d[28]||(d[28]=[K("Difficulty Level",-1)])]),_:1}),e(c,{cols:"6",class:"d-flex"},{default:l(()=>[d[29]||(d[29]=K(" Max Combo ",-1)),e(Ve),e(N,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:d[24]||(d[24]=t=>D.value=!1)})]),_:1})]),_:1})]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[(S(),G(ee,null,ue(["difficultyLevel","maxCombo"],t=>e(c,{key:t,cols:"6"},{default:l(()=>[e(le,null,{default:l(()=>[(S(),G(ee,null,ue(["NORMAL","HARD","EXPERT","MASTER"],z=>e(c,{key:z,cols:"3"},{default:l(()=>[e(H,{modelValue:a.value.scoreData[t][z],"onUpdate:modelValue":ne=>a.value.scoreData[t][z]=ne,modelModifiers:{number:!0},label:z,type:"number",max:"99",min:"1",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})):(S(),B(N,{key:0,text:"Include Score Data (Difficulty Level & Max Combo)","prepend-icon":"mdi-plus",block:"",onClick:d[23]||(d[23]=t=>D.value=!0)}))]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(N,{color:"primary","prepend-icon":"mdi-content-copy",text:"Copy",class:"mr-5",onClick:d[25]||(d[25]=t=>A.navigator.clipboard.writeText(De.value.value))}),e(N,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",disabled:!I.value,onClick:ye},null,8,["disabled"])]),_:1}),e(c,{cols:"12",align:"center"},{default:l(()=>[y("div",Ja,[e($e,{src:P.value||a.value.imageURL||q(fa)},null,8,["src"]),y("div",za,[e(N,{color:"primary","prepend-icon":"mdi-file-import",text:"Import Image",onClick:he}),e(N,{color:"error","prepend-icon":"mdi-close",text:"Delete",disabled:!o.value,onClick:de},null,8,["disabled"])])]),y("input",{ref_key:"fileInputRef",ref:x,type:"file",accept:"image/webp",class:"d-none",onChange:we},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:a.value.imageURL,"onUpdate:modelValue":d[26]||(d[26]=t=>a.value.imageURL=t),label:"Image URL","prepend-icon":"mdi-link-variant",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a.value.imageURL?(S(),B(c,{key:0,cols:"12",class:"text-center"})):ge("",!0),e(c,{cols:"12"},{default:l(()=>[e(Me,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":De.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(He,{modelValue:R.value,"onUpdate:modelValue":d[27]||(d[27]=t=>R.value=t),timeout:3e3,color:U.value},{default:l(()=>[K(j($.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Xa={style:{width:"15%"}},Wa={style:{width:"5%"}},Ya={style:{width:"5%"}},Za={style:{width:"20%"}},Qa={key:1},et={style:{width:"30%"}},lt={key:1},at={style:{width:"25%"}},tt={key:1},ut=Se({__name:"AddItem",setup(p){const O=Te(),h=m(105),E=m("Spring"),x=m(1),M=m(Array.from({length:15},()=>({skillBook:"ITEMS.NONE",piece:"ITEMS.NONE",charm:"ITEMS.NONE"}))),o=Q(()=>{const U=[{title:xe.NONE,value:"ITEMS.NONE"}];return Object.entries(xe.SKILL_BOOK).forEach(([k,_])=>{U.push({title:_,value:`ITEMS.SKILL_BOOK.${k}`})}),U}),P=Q(()=>{const U=[{title:xe.NONE,value:"ITEMS.NONE"}];return Object.entries(xe.CHARM).forEach(([k,_])=>{typeof _=="object"?Object.entries(_).forEach(([b,V])=>{U.push({title:V,value:`ITEMS.CHARM.${k}.${b}`})}):U.push({title:_,value:`ITEMS.CHARM.${k}`})}),U}),D=Q(()=>{const U=M.value.map(k=>`        {
          獲得可能アイテム: [${k.skillBook}, ${k.piece}, ${k.charm}],
          //'低確率獲得可能アイテム': ITEMS.SKILL_BOOK.LOW,
        }`).join(`,
`);return`    ${E.value}: [
      [
${U}
      ],
    ],`}),R=Q(()=>{const U=[{title:xe.NONE,value:"ITEMS.NONE"}],k=_=>{Object.entries(xe.PIECE[_]).forEach(([b,V])=>{U.push({title:V,value:`ITEMS.PIECE.${_}.${b}`})})};switch(k("GARNET"),k("CARNELIAN"),E.value){case"Spring":k("EMERALD"),k("DIA");break;case"Summer":k("PERIDOT"),k("RUBY");break;case"Autumn":k("TOPAZ"),k("SAPPHIRE");break;case"Winter":k("TURQUOISE"),k("AMETHYST");break}return U}),$=U=>{U=/技能書/.test(U)?U:U.split("(")[0];for(const k in Il)if(U===k)return Il[k]};return(U,k)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(Z,{modelValue:h.value,"onUpdate:modelValue":k[0]||(k[0]=_=>h.value=_),items:[103,104,105],label:"Period",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Z,{modelValue:E.value,"onUpdate:modelValue":k[1]||(k[1]=_=>E.value=_),items:["Spring","Summer","Autumn","Winter"],label:"Season",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Z,{modelValue:x.value,"onUpdate:modelValue":k[2]||(k[2]=_=>x.value=_),items:[1,2,3,4,5],label:"Area",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ze,{class:"my-5"}),e(il,{density:"compact"},{default:l(()=>[k[4]||(k[4]=y("thead",null,[y("tr",null,[y("th",{style:{width:"15%"}},"期/季節"),y("th",{style:{width:"5%"}},"Area"),y("th",{style:{width:"5%"}},"Stage"),y("th",{style:{width:"20%"}},"Item (Skill Book)"),y("th",{style:{width:"30%"}},"Item (Piece)"),y("th",{style:{width:"25%"}},"Item (Charm)")])],-1)),y("tbody",null,[(S(),G(ee,null,ue(15,_=>y("tr",{key:_},[y("td",Xa,j(`${h.value}期${E.value}`),1),y("td",Wa,j(x.value),1),y("td",Ya,j(_),1),y("td",Za,[e(Z,{modelValue:M.value[_-1].skillBook,"onUpdate:modelValue":b=>M.value[_-1].skillBook=b,items:o.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:V})=>[e(Ge,je({ref_for:!0},b,{title:V.title}),{prepend:l(()=>[V.title!==q(xe).NONE?(S(),B($e,{key:0,src:q(O).getImagePath("icons/trainingItem",V.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==q(xe).NONE?(S(),B(ll,{key:0,pill:"",class:"pl-0",color:$(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e($e,{src:q(O).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),K(" "+j(b.title),1)]),_:2},1032,["color"])):(S(),G("span",Qa,j(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),y("td",et,[e(Z,{modelValue:M.value[_-1].piece,"onUpdate:modelValue":b=>M.value[_-1].piece=b,items:R.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:V})=>[e(Ge,je({ref_for:!0},b,{title:V.title}),{prepend:l(()=>[V.title!==q(xe).NONE?(S(),B($e,{key:0,src:q(O).getImagePath("icons/trainingItem",V.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==q(xe).NONE?(S(),B(ll,{key:0,pill:"",class:"pl-0",color:$(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e($e,{src:q(O).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),K(" "+j(b.title),1)]),_:2},1032,["color"])):(S(),G("span",lt,j(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),y("td",at,[e(Z,{modelValue:M.value[_-1].charm,"onUpdate:modelValue":b=>M.value[_-1].charm=b,items:P.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:V})=>[e(Ge,je({ref_for:!0},b,{title:V.title}),{prepend:l(()=>[V.title!==q(xe).NONE?(S(),B($e,{key:0,src:q(O).getImagePath("icons/trainingItem",V.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==q(xe).NONE?(S(),B(ll,{key:0,pill:"",class:"pl-0",color:$(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e($e,{src:q(O).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),K(" "+j(b.title),1)]),_:2},1032,["color"])):(S(),G("span",tt,j(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])])])),64))])]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(N,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mb-3",onClick:k[3]||(k[3]=_=>U.navigator.clipboard.writeText(D.value))}),e(Me,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":D.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1}))}}),ul={heartCaptcha:"ハートキャプチャ系",loveAttract:"ラブアトラクト系",voltage:"ボルテージ系",mental:"メンタル系",extend:"手札枚数変更系",boost:"ブースト系",AP:"AP変化系",other:"その他"},ot={class:"text-h5"},it={class:"text-subtitle-2"},nt={class:"text-caption"},st={class:"d-flex justify-end mt-3"},rt=Se({__name:"EditSkillDataDialog",props:{modelValue:{type:Boolean},isNew:{type:Boolean},item:{default:()=>({name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}})},existingItems:{}},emits:["update:modelValue","save"],setup(p,{emit:O}){const h=p,E=O,x=Te(),M=fl(),o=m({...h.item}),P=m(!1),D=m(0),R=m(null),$=m(!1),U=a=>{const C=o.value[a];return!C||!h.isNew&&h.item&&C===h.item[a]?!1:h.existingItems.some(v=>v[a]===C)},k=[a=>a?/^[\u3040-\u309F0-9ー]+$/.test(a)||"Only Hiragana and Numbers are allowed":!0],_=[a=>a?/^[a-zA-Z0-9_-]+$/.test(a)?!h.isNew&&a===h.item?.ID?!0:!h.existingItems.some(v=>v.ID===a)||"ID already exists":'Only half-width alphanumeric characters, "_", and "-" are allowed':"ID is required"];oe(()=>h.modelValue,a=>{a&&(o.value=JSON.parse(JSON.stringify(h.item)))});const b=a=>{E("update:modelValue",a)},V=()=>{R.value=null,P.value=!0},w=a=>{R.value=a,P.value=!0},g=a=>{o.value.detail.type.splice(a,1)},r=a=>{const C={};if(!M.skillDetails)return C;for(const[v,f]of Object.entries(M.skillDetails))f.skillTypeKey===a&&(C[v]=f);return C},n=(a,C)=>{if(o.value.detail||(o.value.detail={attr:"",type:[]}),o.value.detail.type||(o.value.detail.type=[]),R.value!==null){if(o.value.detail.type.includes(a))return;o.value.detail.type[R.value]=a}else{if(o.value.detail.type.includes(a))return;o.value.detail.type.push(a)}P.value=!1,R.value=null},i=async()=>{const a=x.isDev?Ue:me;if(!o.value.name||!o.value.ID){E("save",{...o.value,error:"SkillName and ID are required"});return}if(h.isNew&&h.existingItems.some(T=>T.ID===o.value.ID)){E("save",{...o.value,error:"This ID already exists"});return}$.value=!0;const{ID:C,...v}=o.value,f={};f[`skills/skill/${C}`]=v;try{await Be(be(a),f),E("save",o.value),b(!1)}catch(I){console.error(I),E("save",{...o.value,error:"Error saving data"})}finally{$.value=!1}};return(a,C)=>(S(),G(ee,null,[e(Pe,{"model-value":p.modelValue,"max-width":"1280px","onUpdate:modelValue":b},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[y("span",ot,j(`${p.isNew?"New":"Edit"} Skill`),1)]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:o.value.name,"onUpdate:modelValue":C[0]||(C[0]=v=>o.value.name=v),label:"SkillName",variant:"outlined",density:"compact","base-color":U("name")?"warning":void 0,color:U("name")?"warning":void 0,messages:U("name")?"Warning: Skill Name already exists":void 0},null,8,["modelValue","base-color","color","messages"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:o.value.kana,"onUpdate:modelValue":C[1]||(C[1]=v=>o.value.kana=v),label:"Kana",variant:"outlined",density:"compact",rules:k,"validate-on":"blur"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(H,{modelValue:o.value.ID,"onUpdate:modelValue":C[2]||(C[2]=v=>o.value.ID=v),label:"ID",variant:"outlined",density:"compact",rules:_},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...C[10]||(C[10]=[K("Text",-1)])]),_:1}),e(ke,null,{default:l(()=>[(S(!0),G(ee,null,ue(o.value.text,(v,f)=>(S(),G("div",{key:f,class:"d-flex align-center mb-4"},[e(H,{modelValue:o.value.text[f],"onUpdate:modelValue":I=>o.value.text[f]=I,label:`Text${f+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"]),e(N,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",disabled:o.value.text.length===1,onClick:I=>o.value.text.splice(f,1)},null,8,["disabled","onClick"])]))),128)),e(N,{"prepend-icon":"mdi-plus",text:"Add Text",variant:"outlined",block:"",onClick:C[3]||(C[3]=v=>o.value.text.push(""))})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...C[11]||(C[11]=[K("Detail",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:o.value.detail.attr,"onUpdate:modelValue":C[4]||(C[4]=v=>o.value.detail.attr=v),label:"Attr",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),(S(!0),G(ee,null,ue(o.value.detail.type,(v,f)=>(S(),B(c,{key:f,cols:"6",md:"4"},{default:l(()=>[e(re,{color:q(M).skillDetails[v]?.colorCode,class:"d-flex flex-column fill-height"},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap text-body-2"},{default:l(()=>[K(j(`Type ${f+1}`)+" ",1),e(Ve),e(N,{icon:"mdi-close",density:"compact",color:"error",size:"small",onClick:I=>g(f)},null,8,["onClick"])]),_:2},1024),q(M).skillDetails[v]?(S(),B(ke,{key:0,class:"pb-0"},{default:l(()=>[y("p",it,j(q(M).skillDetails[v].skillDetailName),1),y("p",nt,j(q(M).skillDetails[v].description),1)]),_:2},1024)):ge("",!0),e(Ve),e(Ke,null,{default:l(()=>[e(N,{text:"Change Type",variant:"outlined",block:"",onClick:I=>w(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["color"])]),_:2},1024))),128)),e(c,{cols:"6",md:"4"},{default:l(()=>[e(N,{"prepend-icon":"mdi-plus",text:"Add Type",variant:"outlined",class:"py-2 fill-height",block:"",onClick:V})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ke,null,{default:l(()=>[e(Ve),e(N,{color:"error",variant:"text",text:"Cancel",onClick:C[5]||(C[5]=v=>b(!1))}),e(N,{color:"primary",variant:"text",text:"Save",disabled:!o.value.name||!o.value.ID||U("ID"),loading:$.value,onClick:i},null,8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]),e(Pe,{modelValue:P.value,"onUpdate:modelValue":C[9]||(C[9]=v=>P.value=v),"max-width":"1080px"},{default:l(()=>[e(_l,{class:"pa-3"},{default:l(()=>[C[12]||(C[12]=y("h3",null,"Add Type",-1)),y("div",null,[e(Ol,{modelValue:D.value,"onUpdate:modelValue":C[6]||(C[6]=v=>D.value=v),color:"pink"},{default:l(()=>[(S(!0),G(ee,null,ue(q(ul),(v,f)=>(S(),B(Ae,{key:f,value:f},{default:l(()=>[K(j(v),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(Ze),e(Tl,{modelValue:D.value,"onUpdate:modelValue":C[7]||(C[7]=v=>D.value=v)},{default:l(()=>[(S(!0),G(ee,null,ue(q(ul),(v,f)=>(S(),B(Ne,{key:f,value:f},{default:l(()=>[e(_l,{style:{height:"500px","overflow-y":"auto"}},{default:l(()=>[e($l,{density:"compact"},{default:l(()=>[(S(!0),G(ee,null,ue(r(f),(I,T)=>(S(),B(Ge,{key:T,title:I.skillDetailName,subtitle:I.description,disabled:o.value.detail?.type?.includes(T),style:{"border-bottom":"1px solid #888"},onClick:J=>n(T,f)},{prepend:l(()=>[e(al,{color:I.colorCode,size:"small",class:"mr-2"},null,8,["color"])]),_:2},1032,["title","subtitle","disabled","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),y("div",st,[e(N,{color:"error",variant:"text",text:"Cancel",onClick:C[8]||(C[8]=v=>P.value=!1)})])]),_:1})]),_:1},8,["modelValue"])],64))}}),dt=Se({__name:"AddSkill",setup(p){const O=Te(),h=m({}),E=m(""),x=()=>{const w=be(me,"skills/skill");ol(w,g=>{const r=g.val();h.value=r??{}})};Fe(x),oe(()=>O.isDev,x);const M=Q(()=>{const w=[];if(!h.value)return w;for(const[g,r]of Object.entries(h.value))w.push({ID:g,...r});return w}),o=[{title:"ID",key:"ID"},{title:"Skill Name",key:"name"},{title:"Kana",key:"kana"},{title:"Edit",key:"edit",sortable:!1}],P=m(!1),D=m(!1),R=m({}),$=m(!1),U=m(""),k=m("success"),_=()=>{R.value={name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}},D.value=!0,P.value=!0},b=w=>{R.value=JSON.parse(JSON.stringify(w)),D.value=!1,P.value=!0},V=w=>{w.error?(U.value=w.error,k.value="error"):(U.value=`Saved to ${O.isDev?"Dev":"Prod"}`,k.value="success"),$.value=!0};return(w,g)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(H,{modelValue:E.value,"onUpdate:modelValue":g[0]||(g[0]=r=>E.value=r),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"ma-2"},{append:l(()=>[e(N,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:_})]),_:1},8,["modelValue"]),e(yl,{headers:o,items:M.value,search:E.value,density:"compact","items-per-page":50,hover:""},{"item.edit":l(({item:r})=>[e(El,{icon:"mdi-pencil",size:"small",onClick:n=>b(r)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1}),e(rt,{modelValue:P.value,"onUpdate:modelValue":g[1]||(g[1]=r=>P.value=r),"is-new":D.value,item:R.value,"existing-items":M.value,onSave:V},null,8,["modelValue","is-new","item","existing-items"]),e(He,{modelValue:$.value,"onUpdate:modelValue":g[2]||(g[2]=r=>$.value=r),timeout:3e3,color:k.value},{default:l(()=>[K(j(U.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),ct=Se({__name:"AddSkillDetail",setup(p){const O=Te(),h=fl(),E=m(""),x=Q(()=>Object.entries(ul).map(([g,r])=>({title:r,value:g}))),M=[{title:"ID",key:"id"},{title:"Skill Detail Name",key:"skillDetailName"},{title:"Color Code",key:"colorCode"},{title:"Skill Type",key:"skillTypeKey"},{title:"Description",key:"description"},{title:"Edit",key:"edit",sortable:!1}],o=Q(()=>{const g=Object.entries(h.skillDetails).map(([r,n])=>({id:r,...typeof n=="object"?n:{value:n}}));return E.value?g.filter(r=>r.skillTypeKey===E.value):g}),P=m(!1),D=m({id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"}),R=m(!1),$=m(!1),U=m(""),k=m("success"),_=()=>{D.value={id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"},R.value=!0,P.value=!0},b=g=>{D.value={...g},R.value=!1,P.value=!0},V=()=>{P.value=!1},w=async()=>{const g={};if(!D.value.id){U.value="ID is required",k.value="error",$.value=!0;return}if(R.value&&o.value.some(i=>i.id===D.value.id)){U.value="ID already exists",k.value="error",$.value=!0;return}const{id:r,...n}=D.value;g[`skills/skillDetail/${r}`]=n;try{await Be(be(me),g),U.value=`Saved to ${O.isDev?"Dev":"Prod"}`,k.value="success",$.value=!0,P.value=!1}catch(i){console.error(i),U.value="Error saving data",k.value="error",$.value=!0}};return(g,r)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(Z,{modelValue:E.value,"onUpdate:modelValue":r[0]||(r[0]=n=>E.value=n),items:x.value,label:"Filter by Skill Type","prepend-inner-icon":"mdi-filter",variant:"outlined","hide-details":"",class:"ma-2",clearable:""},{append:l(()=>[e(N,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:_})]),_:1},8,["modelValue","items"]),e(yl,{headers:M,items:o.value,density:"compact","items-per-page":-1,hover:""},{"item.colorCode":l(({value:n})=>[n?(S(),B(ll,{key:0,color:n,size:"small",variant:"flat"},{default:l(()=>[K(j(n),1)]),_:2},1032,["color"])):ge("",!0)]),"item.skillTypeKey":l(({value:n})=>[K(j(q(ul)[n]||n),1)]),"item.edit":l(({item:n})=>[e(N,{icon:"mdi-pencil",size:"small",onClick:i=>b(n)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),e(Pe,{modelValue:P.value,"onUpdate:modelValue":r[6]||(r[6]=n=>P.value=n),"max-width":"600px"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...r[8]||(r[8]=[K("Edit Skill Detail",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:D.value.id,"onUpdate:modelValue":r[1]||(r[1]=n=>D.value.id=n),label:"ID",readonly:!R.value,disabled:!R.value,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","readonly","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:D.value.skillDetailName,"onUpdate:modelValue":r[2]||(r[2]=n=>D.value.skillDetailName=n),label:"Skill Detail Name",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:D.value.colorCode,"onUpdate:modelValue":r[3]||(r[3]=n=>D.value.colorCode=n),label:"Color Code",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Z,{modelValue:D.value.skillTypeKey,"onUpdate:modelValue":r[4]||(r[4]=n=>D.value.skillTypeKey=n),items:x.value,"item-title":"title","item-value":"value",label:"Skill Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Me,{modelValue:D.value.description,"onUpdate:modelValue":r[5]||(r[5]=n=>D.value.description=n),label:"Description",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ke,null,{default:l(()=>[e(Ve),e(N,{text:"Cancel",color:"error",onClick:V}),e(N,{text:"Save",color:"primary",onClick:w})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:$.value,"onUpdate:modelValue":r[7]||(r[7]=n=>$.value=n),timeout:3e3,color:k.value},{default:l(()=>[K(j(U.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),mt={class:"text-h5"},vt={class:"d-flex justify-space-evenly mt-3"},pt=Se({__name:"EditEventDataDialog",props:{modelValue:{type:Boolean},eventData:{},isNew:{type:Boolean}},emits:["update:modelValue","save"],setup(p,{emit:O}){const h=p,E=O,x=m({}),M=m(null),o=m(null),P=m(null),D=["liveGP","live","movie","other"],R=n=>{if(!n||!Array.isArray(n)||n.length<5)return"";const[i,a,C,v,f]=n;return`${i}-${String(a).padStart(2,"0")}-${String(C).padStart(2,"0")}T${String(v).padStart(2,"0")}:${String(f).padStart(2,"0")}`},$=n=>{if(!n)return[];const i=new Date(n);return[i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours(),i.getMinutes()]};oe(()=>h.modelValue,n=>{n&&h.eventData&&(x.value=JSON.parse(JSON.stringify(h.eventData)),b())});const U=Q({get:()=>R(x.value.firstDay),set:n=>x.value.firstDay=$(n)}),k=Q({get:()=>R(x.value.lastDay),set:n=>x.value.lastDay=$(n)}),_=n=>{const i=Array.isArray(n)?n[0]:n;if(!i){b();return}P.value=i;const a=new FileReader;a.onload=C=>{M.value=C.target?.result},a.readAsDataURL(i)},b=()=>{P.value=null,M.value=null,o.value&&(o.value.value="")},V=()=>{o.value?.click()},w=n=>{const i=n.target;i.files&&i.files.length>0&&_(i.files[0])},g=()=>{E("update:modelValue",!1)},r=()=>{E("save",{event:x.value,file:P.value})};return(n,i)=>(S(),B(Pe,{"model-value":p.modelValue,"max-width":"1000px","onUpdate:modelValue":g},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[y("span",mt,j(`${p.isNew?"New":"Edit"} Event`),1)]),_:1}),e(ke,{class:"px-4 py-2"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:x.value.id,"onUpdate:modelValue":i[0]||(i[0]=a=>x.value.id=a),label:"Event ID",readonly:!p.isNew,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue","readonly"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:x.value.title,"onUpdate:modelValue":i[1]||(i[1]=a=>x.value.title=a),label:"Event Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(H,{modelValue:x.value.text,"onUpdate:modelValue":i[2]||(i[2]=a=>x.value.text=a),label:"Sub Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Z,{modelValue:x.value.type,"onUpdate:modelValue":i[3]||(i[3]=a=>x.value.type=a),label:"Event Type",items:D,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:U.value,"onUpdate:modelValue":i[4]||(i[4]=a=>U.value=a),label:"First Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(H,{modelValue:k.value,"onUpdate:modelValue":i[5]||(i[5]=a=>k.value=a),label:"Last Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e($e,{src:M.value||x.value.imageUrl||q(Rl)},null,8,["src"]),y("div",vt,[e(N,{text:"Import Image","prepend-icon":"mdi-file-import",color:"primary",onClick:V}),e(N,{text:"Delete","prepend-icon":"mdi-close",color:"error",disabled:!P.value,onClick:b},null,8,["disabled"])]),y("input",{ref_key:"fileInputRef",ref:o,type:"file",accept:"image/webp",style:{display:"none"},onChange:w},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(H,{modelValue:x.value.link,"onUpdate:modelValue":i[6]||(i[6]=a=>x.value.link=a),label:"URL",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ke,{class:"py-0"},{default:l(()=>[e(Ve),e(N,{text:"Cancel",color:"red",variant:"text",onClick:g}),e(N,{text:"Save",color:"primary",variant:"text",onClick:r})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),ft={class:"text-right mb-3"},yt=Se({__name:"AddEvent",setup(p){const O=Te(),h=m(!1),E=m(""),x=m("success"),M=m(!1),o=m(!1),P=[{title:"ID",key:"id",sortable:!1},{title:"Title",key:"title",sortable:!1},{title:"SubTitle",key:"text",sortable:!1},{title:"First Day",key:"firstDay"},{title:"Last Day",key:"lastDay"},{title:"Edit",key:"edit",sortable:!1}],D=r=>{if(!r||!Array.isArray(r))return"";const[n,i,a,C,v]=r;return`${n}/${String(i).padStart(2,"0")}/${String(a).padStart(2,"0")} ${String(C).padStart(2,"0")}:${String(v).padStart(2,"0")}`},R=m({}),$=async()=>{const r=O.isDev?Ue:me,n=await Al(be(r,"eventInformation"));n.exists()?R.value=n.val():R.value={}};Fe($),oe(()=>O.isDev,$);const U=Q(()=>Object.entries(R.value).map(([r,n])=>({id:r,...n}))),k=async()=>{const r=O.isDev?Ue:me,n=be(r,"cards");try{const i=await Al(n);if(i.exists()){const a=i.val(),C=(v,f)=>{for(const I in v)I===f?delete v[I]:typeof v[I]=="object"&&v[I]!==null&&C(v[I],f)};C(a,"fluctuationStatus"),await ga(n,a),E.value="Updated Card List (removed fluctuationStatus)",x.value="success",h.value=!0}}catch(i){console.error(i),E.value="Error updating card list",x.value="error",h.value=!0}},_=m(null),b=(r,n)=>{const i=JSON.parse(JSON.stringify(n));r==="copy"&&(i.id=""),_.value=i,o.value=r!=="edit",M.value=!0},V=()=>{_.value={id:"",title:"",text:"",type:"liveGP",firstDay:[],lastDay:[],link:"",imageUrl:""},o.value=!0,M.value=!0},w=async r=>{if(!confirm(`Are you sure you want to delete "${r.title}"?`))return;const n=O.isDev?Ue:me;try{await ka(be(n,`eventInformation/${r.id}`)),E.value="Deleted successfully",x.value="success",h.value=!0,await $()}catch(i){console.error(i),E.value="Error deleting event",x.value="error",h.value=!0}},g=async({event:r,file:n})=>{if(!r.id){E.value="ID is required",x.value="error",h.value=!0;return}const i=O.isDev?Ue:me,{id:a,...C}=r;try{if(E.value="Uploading Now...",x.value="yellow",h.value=!0,n){const v=Le(me.app),f=Ee(v,`event/${n.name}`),I=await Ye(f,n),T=await Re(I.ref);C.imageUrl=T}await Be(be(i,`eventInformation/${a}`),C),E.value="Saved successfully",x.value="success",M.value=!1,await $()}catch(v){console.error(v),E.value="Error saving event",x.value="error"}};return(r,n)=>(S(),B(Oe,{fluid:"",class:"pa-0"},{default:l(()=>[y("div",ft,[e(Ve),e(N,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:V})]),e(yl,{headers:P,items:U.value,class:"elevation-1","items-per-page":-1,"sort-by":[{key:"firstDay",order:"asc"}],hover:""},{"item.firstDay":l(({value:i})=>[K(j(D(i)),1)]),"item.lastDay":l(({value:i})=>[K(j(D(i)),1)]),"item.edit":l(({item:i})=>[e(N,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-pencil",onClick:a=>b("edit",i)},null,8,["onClick"]),e(N,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-content-copy",onClick:a=>b("copy",i)},null,8,["onClick"]),e(N,{size:"small",variant:"tonal",color:"error",icon:"mdi-delete",onClick:a=>w(i)},null,8,["onClick"])]),_:2},1032,["items"]),e(pt,{modelValue:M.value,"onUpdate:modelValue":n[0]||(n[0]=i=>M.value=i),"event-data":_.value,"is-new":o.value,onSave:g},null,8,["modelValue","event-data","is-new"]),e(le,{class:"mt-2"},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(N,{text:"Update Card List",color:"yellow",onClick:k})]),_:1})]),_:1}),e(He,{modelValue:h.value,"onUpdate:modelValue":n[1]||(n[1]=i=>h.value=i),color:x.value,timeout:2e3},{default:l(()=>[K(j(E.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),gt={key:0},kt={style:{"white-space":"pre-wrap"}},bt=Se({__name:"MngInfo",setup(p){const O=m([]),h=m([]),E=m(!1),x=m(""),M=m(""),o=m(!1),P=m(""),D=m("success"),R=Le(me.app),$=Ee(R,"info"),U=async()=>{try{const w=await Ml($);h.value=w.items.map(g=>({name:g.name,ref:g}))}catch(w){console.error(w),V("Failed to fetch file list","error")}},k=async()=>{if(!O.value||O.value.length===0)return;const w=O.value[0],g=Ee(R,`info/${w.name}`);try{await Ye(g,w),V("Upload successful","success"),O.value=[],await U()}catch(r){console.error(r),V("Upload failed","error")}},_=async w=>{try{const g=await Re(w.ref),n=await(await fetch(g)).text();x.value=w.name,M.value=n,E.value=!0}catch(g){console.error(g),V("Failed to load file content","error")}},b=async w=>{if(confirm(`Are you sure you want to delete "${w.name}"?`))try{await Va(w.ref),V("Deleted successfully","success"),await U()}catch(g){console.error(g),V("Delete failed","error")}},V=(w,g)=>{P.value=w,D.value=g,o.value=!0};return Fe(()=>{U()}),(w,g)=>(S(),B(Oe,{fluid:""},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[...g[4]||(g[4]=[y("h2",null,"Info Management (MD Files)",-1)])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(ba,{modelValue:O.value,"onUpdate:modelValue":g[0]||(g[0]=r=>O.value=r),label:"Select MD File",accept:".md","show-size":"","prepend-icon":"mdi-file-document-outline",variant:"outlined",density:"compact"},{"append-inner":l(()=>[e(N,{color:"primary",size:"small",class:"ml-2",disabled:!O.value||O.value.length===0,onClick:k},{default:l(()=>[...g[5]||(g[5]=[K(" Upload ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...g[6]||(g[6]=[K("File List (storage/info)",-1)])]),_:1}),e(il,{density:"compact"},{default:l(()=>[g[8]||(g[8]=y("thead",null,[y("tr",null,[y("th",null,"Name"),y("th",null,"Actions")])],-1)),y("tbody",null,[(S(!0),G(ee,null,ue(h.value,r=>(S(),G("tr",{key:r.name},[y("td",null,j(r.name),1),y("td",null,[e(N,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:n=>_(r)},null,8,["onClick"]),e(N,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:n=>b(r)},null,8,["onClick"])])]))),128)),h.value.length===0?(S(),G("tr",gt,[...g[7]||(g[7]=[y("td",{colspan:"2",class:"text-center"},"No files found.",-1)])])):ge("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,{modelValue:E.value,"onUpdate:modelValue":g[2]||(g[2]=r=>E.value=r),"max-width":"800px",scrollable:""},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,{class:"d-flex justify-space-between align-center"},{default:l(()=>[y("span",null,j(x.value),1),e(N,{icon:"mdi-close",variant:"text",onClick:g[1]||(g[1]=r=>E.value=!1)})]),_:1}),e(ke,{style:{"max-height":"600px","overflow-y":"auto"}},{default:l(()=>[y("pre",kt,j(M.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=r=>o.value=r),color:D.value,timeout:3e3},{default:l(()=>[K(j(P.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Vt={class:"d-flex align-center"},St=Se({__name:"AddData",setup(p){const O=m("pendingDataList"),h=Te(),E=Da(),x=m(0),M=async()=>{const D=Sa();try{await xa(D),E.push({name:"Home"})}catch(R){console.error("Logout failed",R)}},o=()=>{x.value++};oe(()=>h.isDev,()=>{o()});const P=D=>{O.value=`${D}${D==="card"?"List":""}`};return(D,R)=>(S(),B(Oe,{fluid:"",class:"py-2 px-0"},{default:l(()=>[R[3]||(R[3]=y("h1",null,"DATA MANAGEMENT",-1)),y("div",Vt,[e(Xe,{modelValue:q(h).isDev,"onUpdate:modelValue":R[0]||(R[0]=$=>q(h).isDev=$),label:"isDev",color:"pink",density:"compact","hide-details":"","hide-input":"",class:"px-2"},null,8,["modelValue"]),e(N,{text:"Logout",color:"error","prepend-icon":"mdi-logout",size:"small",class:"mr-2",onClick:M}),e(N,{text:"Sync","prepend-icon":"mdi-refresh",size:"small",color:"primary",onClick:o})]),e(Ol,{modelValue:O.value,"onUpdate:modelValue":R[1]||(R[1]=$=>O.value=$),color:"pink"},{default:l(()=>[e(Ae,{value:"pendingDataList",text:"Pending Data"}),e(Ae,{value:"cardList",text:"Card"}),e(Ae,{value:"skillList",text:"Skill"}),e(Ae,{value:"skillDetail",text:"Skill Detail"}),e(Ae,{value:"music",text:"Music"}),e(Ae,{value:"item",text:"Item"}),e(Ae,{value:"event",text:"Event"}),e(Ae,{value:"info",text:"Info"})]),_:1},8,["modelValue"]),e(Ze,{class:"mb-2"}),e(Tl,{modelValue:O.value,"onUpdate:modelValue":R[2]||(R[2]=$=>O.value=$),class:"pt-3"},{default:l(()=>[e(Ne,{value:"pendingDataList"},{default:l(()=>[(S(),B(_a,{key:x.value,onEdit:P}))]),_:1}),e(Ne,{value:"cardList"},{default:l(()=>[(S(),B(Ka,{key:x.value}))]),_:1}),e(Ne,{value:"skillList"},{default:l(()=>[(S(),B(dt,{key:x.value}))]),_:1}),e(Ne,{value:"skillDetail"},{default:l(()=>[(S(),B(ct,{key:x.value}))]),_:1}),e(Ne,{value:"music"},{default:l(()=>[(S(),B(Ga,{key:x.value}))]),_:1}),e(Ne,{value:"item"},{default:l(()=>[(S(),B(ut,{key:x.value}))]),_:1}),e(Ne,{value:"event"},{default:l(()=>[(S(),B(yt,{key:x.value}))]),_:1}),e(Ne,{value:"info"},{default:l(()=>[(S(),B(bt,{key:x.value}))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{St as default};
