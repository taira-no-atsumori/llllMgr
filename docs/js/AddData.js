import{g as Bl,I as kl,u as Fl,a as jl,b as Hl,c as Kl,r as m,w as ql,o as Fe,d as oe,e as Jl,f as zl,h as Gl,V as bl,i as Vl,j as e,k as p,F as ee,l as Xl,m as He,n as Dl,v as Yl,p as $l,q as sl,s as Wl,t as Ze,x as Ql,y as Z,z as Zl,A as ea,B as la,C as aa,D as ta,E as ua,G as oa,H as ia,J as Se,K as pl,L as V,M as L,N as _e,O as l,P as K,Q as G,R as I,S as c,T as na,U as q,W as H,X as Nl,Y as ue,Z as Ge,_ as sa,$ as Ke,a0 as ra,a1 as le,a2 as re,a3 as fe,a4 as ke,a5 as qe,a6 as Ve,a7 as Pe,a8 as je,a9 as Le,aa as me,ab as Me,ac as We,ad as Re,ae as Be,af as be,ag as Te,ah as Q,ai as j,aj as El,ak as ge,al as dl,am as cl,an as ml,ao as vl,ap as ol,aq as Xe,ar as il,as as Sl,at as da,au as fl,av as Je,aw as xl,ax as wl,ay as rl,az as tl,aA as we,aB as Ee,aC as Ml,aD as Qe,aE as ca,aF as ma,aG as va,aH as hl,aI as ze,aJ as pa,aK as Cl,aL as Ul,aM as fa,aN as el,aO as Rl,aP as ya,aQ as xe,aR as ll,aS as al,aT as _l,aU as Il,aV as Ol,aW as $e,aX as Tl,aY as Ne,aZ as yl,a_ as Al,a$ as ga,b0 as ka,b1 as ba,b2 as Va,b3 as Da,b4 as Sa,b5 as xa}from"./index.js";const wa=aa({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:v=>!isNaN(parseFloat(v))},maxHeight:{type:[Number,String],validator:v=>!isNaN(parseFloat(v))},maxRows:{type:[Number,String],validator:v=>!isNaN(parseFloat(v))},suffix:String,modelModifiers:Object,...ia(),...ua(oa(),["direction"]),...ta()},"VTextarea"),Oe=Bl()({name:"VTextarea",directives:{vIntersect:kl},inheritAttrs:!1,props:wa(),emits:{"click:control":v=>!0,"mousedown:control":v=>!0,"update:focused":v=>!0,"update:modelValue":v=>!0,"update:rows":v=>!0},setup(v,R){let{attrs:h,emit:$,slots:D}=R;const M=Fl(v,"modelValue"),{isFocused:n,focus:T,blur:k}=jl(v),{onIntersect:N}=la(v),A=Z(()=>typeof v.counterValue=="function"?v.counterValue(M.value):(M.value||"").toString().length),C=Z(()=>{if(h.maxlength)return h.maxlength;if(!(!v.counter||typeof v.counter!="number"&&typeof v.counter!="string"))return v.counter}),y=m(),U=m(),b=ea(""),g=m(),S=m(0),{platform:f}=Hl(),s=Kl(v),o=Z(()=>v.persistentPlaceholder||n.value||v.active);function u(){s.isSuppressing.value&&s.update(),g.value!==document.activeElement&&g.value?.focus(),n.value||T()}function a(X){u(),$("click:control",X)}function O(X){$("mousedown:control",X)}function w(X){X.stopPropagation(),u(),Ze(()=>{M.value="",Zl(v["onClick:clear"],X)})}function x(X){const ie=X.target;if(!v.modelModifiers?.trim){M.value=ie.value;return}const de=ie.value,Ce=ie.selectionStart,he=ie.selectionEnd;M.value=de,Ze(()=>{let De=0;de.trimStart().length===ie.value.length&&(De=de.length-ie.value.length),Ce!=null&&(ie.selectionStart=Ce-De),he!=null&&(ie.selectionEnd=he-De)})}const E=m(),F=m(Number(v.rows)),J=Z(()=>["plain","underlined"].includes(v.variant));ql(()=>{v.autoGrow||(F.value=Number(v.rows))});function W(){Ze(()=>{if(!g.value)return;if(f.value.firefox){S.value=12;return}const{offsetWidth:X,clientWidth:ie}=g.value;S.value=Math.max(0,X-ie)}),v.autoGrow&&Ze(()=>{if(!E.value||!U.value)return;const X=getComputedStyle(E.value),ie=getComputedStyle(U.value.$el),de=parseFloat(X.getPropertyValue("--v-field-padding-top"))+parseFloat(X.getPropertyValue("--v-input-padding-top"))+parseFloat(X.getPropertyValue("--v-field-padding-bottom")),Ce=E.value.scrollHeight,he=parseFloat(X.lineHeight),De=Math.max(parseFloat(v.rows)*he+de,parseFloat(ie.getPropertyValue("--v-input-control-height"))),_=v.maxHeight?parseFloat(v.maxHeight):parseFloat(v.maxRows)*he+de||1/0,d=Ql(Ce??0,De,_);F.value=Math.floor((d-de)/he),b.value=sl(d)})}Fe(W),oe(M,W),oe(()=>v.rows,W),oe(()=>v.maxHeight,W),oe(()=>v.maxRows,W),oe(()=>v.density,W),oe(F,X=>{$("update:rows",X)});let ye;return oe(E,X=>{X?(ye=new ResizeObserver(W),ye.observe(E.value)):ye?.disconnect()}),Jl(()=>{ye?.disconnect()}),zl(()=>{const X=!!(D.counter||v.counter||v.counterValue),ie=!!(X||D.details),[de,Ce]=Gl(h),{modelValue:he,...De}=bl.filterProps(v),_={...Vl.filterProps(v),"onClick:clear":w};return e(bl,He({ref:y,modelValue:M.value,"onUpdate:modelValue":d=>M.value=d,class:["v-textarea v-text-field",{"v-textarea--prefixed":v.prefix,"v-textarea--suffixed":v.suffix,"v-text-field--prefixed":v.prefix,"v-text-field--suffixed":v.suffix,"v-textarea--auto-grow":v.autoGrow,"v-textarea--no-resize":v.noResize||v.autoGrow,"v-input--plain-underlined":J.value},v.class],style:[{"--v-textarea-max-height":v.maxHeight?sl(v.maxHeight):void 0,"--v-textarea-scroll-bar-width":sl(S.value)},v.style]},de,De,{centerAffix:F.value===1&&!J.value,focused:n.value}),{...D,default:d=>{let{id:t,isDisabled:z,isDirty:ne,isReadonly:ve,isValid:pe,hasDetails:Ue}=d;return e(Vl,He({ref:U,style:{"--v-textarea-control-height":b.value},onClick:a,onMousedown:O,"onClick:prependInner":v["onClick:prependInner"],"onClick:appendInner":v["onClick:appendInner"]},_,{id:t.value,active:o.value||ne.value,labelId:`${t.value}-label`,centerAffix:F.value===1&&!J.value,dirty:ne.value||v.dirty,disabled:z.value,focused:n.value,details:Ue.value,error:pe.value===!1}),{...D,default:nl=>{let{props:{class:B,...r},controlRef:i}=nl;return p(ee,null,[v.prefix&&p("span",{class:"v-text-field__prefix"},[v.prefix]),Dl(p("textarea",He({ref:P=>g.value=i.value=P,class:B,value:M.value,onInput:x,autofocus:v.autofocus,readonly:ve.value,disabled:z.value,placeholder:v.placeholder,rows:v.rows,name:s.fieldName.value,autocomplete:s.fieldAutocomplete.value,onFocus:u,onBlur:k,"aria-labelledby":`${t.value}-label`},r,Ce),null),[[kl,{handler:N},null,{once:!0}]]),v.autoGrow&&Dl(p("textarea",{class:$l([B,"v-textarea__sizer"]),id:`${r.id}-sizer`,"onUpdate:modelValue":P=>M.value=P,ref:E,readonly:!0,"aria-hidden":"true"},null),[[Yl,M.value]]),v.suffix&&p("span",{class:"v-text-field__suffix"},[v.suffix])])}})},details:ie?d=>p(ee,null,[D.details?.(d),X&&p(ee,null,[p("span",null,null),e(Xl,{active:v.persistentCounter||n.value,value:A.value,max:C.value,disabled:v.disabled},D.counter)])]):void 0})}),Wl({},y,U,g)}}),ha={key:0,class:"mb-4 text-grey"},Ca={key:1},Ua={class:"text-caption mr-2"},_a={class:"text-caption"},Ia=Se({__name:"PendingData",emits:["edit"],setup(v,{emit:R}){const h=pl(),$=m(!1),D=m(""),M=m(""),n=m([]),T=m(!1),k=m(!1),N=m(""),A=R,C=b=>{h.setEditTarget(b.type,b.key),A("edit",b.type)},y=b=>{if(M.value=JSON.stringify(b.data,null,2),b.status==="update"){let g=null;b.type==="music"?g=h.prodData.music[b.key]:b.type==="card"&&(g=h.flattenCards(h.prodData.card)[b.key]?.data),D.value=JSON.stringify(g,null,2)}else D.value="New Data"},U=async()=>{if(n.value.length===0)return;$.value=!0;const b=Le(me.app);try{const g={};for(const S of n.value){const f=h.diffList.find(u=>u.key===S);if(!f)continue;const s=JSON.parse(JSON.stringify(f.data));let o=null;if(f.type==="music"?o=h.prodData.music[f.key]:f.type==="card"&&(o=h.flattenCards(h.prodData.card)[f.key]?.data),s.imageURL&&s.imageURL.startsWith("http")&&(!o||!o.imageURL))try{const a=await(await fetch(s.imageURL)).blob();let O="webp";try{const W=new URL(s.imageURL),X=decodeURIComponent(W.pathname).match(/\.([a-zA-Z0-9]+)$/);X&&(O=X[1])}catch{}const w=`${S}.${O}`,x=f.type==="card"?"cardIllust":f.type==="music"?"cdJacket":"eventInformation",E=Me(b,`${x}/${w}`),F=await We(E,a),J=await Re(F.ref);s.imageURL=J}catch(u){console.error(`Failed to copy image for ${S}:`,u)}g[f.path]=s}await Be(be(me),g),T.value=!0,n.value=[],D.value="",M.value=""}catch(g){console.error("Upload failed:",g),N.value=String(g),k.value=!0}finally{$.value=!1}};return(b,g)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[K(h).diffList.length===0?(V(),G("div",ha," Dev環境と本番環境のデータに差分はありません。 ")):(V(),G("div",Ca,[e(I,{text:"Deploy to Prod",color:"primary","prepend-icon":"mdi-cloud-upload",loading:$.value,disabled:n.value.length===0,onClick:U},null,8,["loading","disabled"]),e(le,{class:"mt-0"},{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(na,null,{default:l(()=>[q(" Diff: "+H(K(h).diffList.length),1)]),_:1}),e(Nl,{variant:"flat",class:"mb-4"},{default:l(()=>[(V(!0),G(ee,null,ue(K(h).diffList,S=>(V(),L(Ge,{key:S.key,class:$l(S.status==="new"?"bg-blue-lighten-4":"bg-yellow-lighten-4"),onClick:f=>y(S)},{prepend:l(()=>[e(ra,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=f=>n.value=f),value:S.key,color:"pink",onClick:g[1]||(g[1]=Ke(()=>{},["stop"]))},null,8,["modelValue","value"])]),append:l(()=>[e(I,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:Ke(f=>C(S),["stop"])},null,8,["onClick"])]),default:l(()=>[e(sa,null,{default:l(()=>[p("span",Ua,"["+H(S.type)+"]",1),q(" "+H(S.data.title||S.data.cardName||S.key)+" ",1),p("span",_a,"("+H(S.status)+")",1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Oe,{modelValue:D.value,"onUpdate:modelValue":g[2]||(g[2]=S=>D.value=S),label:"Prod (Before)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Oe,{modelValue:M.value,"onUpdate:modelValue":g[3]||(g[3]=S=>M.value=S),label:"Dev (After)","auto-grow":"",readonly:"",variant:"solo"},null,8,["modelValue"])]),_:1})]),_:1})])),e(Pe,{modelValue:k.value,"onUpdate:modelValue":g[5]||(g[5]=S=>k.value=S),"max-width":"600"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,{class:"text-h5 bg-error"},{default:l(()=>[...g[8]||(g[8]=[q("Upload Failed",-1)])]),_:1}),e(ke,{class:"pt-4"},{default:l(()=>[g[9]||(g[9]=p("p",null," アップロードに失敗しました。コンソールで詳細を確認してください。 ",-1)),g[10]||(g[10]=p("p",{class:"mt-4 font-weight-bold"},"エラーメッセージ:",-1)),e(Oe,{"model-value":N.value,readonly:"",variant:"outlined",rows:"5","auto-grow":"",class:"mt-2"},null,8,["model-value"])]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(I,{color:"primary",text:"Close",onClick:g[4]||(g[4]=S=>k.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(je,{modelValue:T.value,"onUpdate:modelValue":g[7]||(g[7]=S=>T.value=S),timeout:3e3,color:"success"},{actions:l(()=>[e(I,{variant:"text",text:"Close",onClick:g[6]||(g[6]=S=>T.value=!1)})]),default:l(()=>[g[11]||(g[11]=q(" Upload Completed! ",-1))]),_:1},8,["modelValue"])]),_:1}))}}),Pl=[{title:"あ行",value:"あ"},{title:"か行",value:"か"},{title:"さ行",value:"さ"},{title:"た行",value:"た"},{title:"な行",value:"な"},{title:"は行",value:"は"},{title:"ま行",value:"ま"},{title:"や行",value:"や"},{title:"ら行",value:"ら"},{title:"わ行",value:"わ"},{title:"数字",value:"other"}],Ll=v=>v?/[あ-おア-オ]/.test(v)?"あ":/[か-こカ-コが-ごガ-ゴ]/.test(v)?"か":/[さ-そサ-ソざ-ぞザ-ゾ]/.test(v)?"さ":/[た-とタ-トだ-どダ-ド]/.test(v)?"た":/[な-のナ-ノ]/.test(v)?"な":/[は-ほハ-ホば-ぼバ-ボぱ-ぽパ-ポ]/.test(v)?"は":/[ま-もマ-モ]/.test(v)?"ま":/[や-よヤ-ヨ]/.test(v)?"や":/[ら-ろラ-ロ]/.test(v)?"ら":/[わ-んワ-ン]/.test(v)?"わ":"other":"other",Aa={class:"d-flex mb-3"},$a={class:"pr-3",style:{width:"90%"}},Na={style:{width:"10%"}},Ea={key:0,class:"mb-3"},Ma={class:"text-subtitle-1"},Ye=Se({__name:"SkillFormComponent",props:{modelValue:{},type:{},index:{}},emits:["update:modelValue","open-detail"],setup(v,{emit:R}){const h=m(!1),$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0],D=v,M=R,n=Z({get:()=>D.modelValue,set:w=>M("update:modelValue",w)}),T=Te(),k=m({}),N=()=>{const w=be(me,"skills/skill");ol(w,x=>{const E=x.val();if(E){for(const F in E)E[F]={ID:F,...E[F]};k.value=E}})};Fe(N),oe(()=>T.isDev,N),oe(k,w=>{if(Object.keys(w).length>0&&!D.modelValue.name&&!D.modelValue.ID){const x=y.value[0];x&&S(x.value)}});const A=m("all"),C=[{title:"All",value:"all"},...Pl],y=Z(()=>{const w=[],x=new Set;for(const E in k.value){const F=k.value[E],J=F.name,W=F.kana;A.value!=="all"&&Ll(W.charAt(0))!==A.value||x.has(J)||(x.add(J),w.push({title:J,value:E}))}return w.sort((E,F)=>E.title.localeCompare(F.title,"ja"))}),U=Z(()=>{switch(D.type){case"SA":return"Special Appeal";case"skill":return"Skill";case"addSA":return"Add Special Appeal";default:return"Skill"}}),b=Z(()=>{const w=n.value.name,x=[];if(!w)return x;for(const E in k.value)k.value[E].name===w&&x.push(k.value[E].ID);return x}),g=Z(()=>{const w=n.value.name,x=n.value.ID;return w&&x&&Object.keys(k.value).includes(x)?k.value[x].detail.type:[]}),S=w=>{if(!w)return;const x=[];for(const E in k.value)k.value[E].ID===w&&x.push(k.value[E]);x.length>0&&(n.value.ID=x[0].ID,n.value.name=x[0].name,f(x[0].ID))},f=w=>{if(!w)return;if(n.value.name){const E=k.value[w];if(E&&E.text){const F=Math.max(0,E.text.length-1);n.value.detail=new Array(F).fill(null).map(()=>[...$])}}},s={ID:"",name:"",AP:0,detail:[...$]},o={...s,characteristic:{name:"",detail:"",type:[""]}},u=w=>{n.value[`add${w}`]||(n.value[`add${w}`]=[]),n.value[`add${w}`].push(JSON.parse(JSON.stringify(w==="SA"?s:o)))},a=(w,x)=>{n.value[`add${w}`].splice(x,1)},O=()=>{let w="",x="",E=[];if(y.value.length>0){const F=y.value[0],J=k.value[F.value];if(J&&(w=J.ID,x=J.name,J.text)){const W=Math.max(0,J.text.length-1);E=new Array(W).fill(null).map(()=>[...$])}}n.value={...n.value,ID:w,name:x,AP:0,detail:E,addSA:[],addSkill:[]},h.value=!1};return(w,x)=>(V(),G(ee,null,[p("div",Aa,[p("div",$a,[e(Q,{modelValue:A.value,"onUpdate:modelValue":x[0]||(x[0]=E=>A.value=E),items:C,label:"Filter by Kana",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Q,{modelValue:n.value.name,"onUpdate:modelValue":[x[1]||(x[1]=E=>n.value.name=E),S],items:y.value,label:`${U.value} Name`,required:"",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue","items","label"]),e(Q,{modelValue:n.value.ID,"onUpdate:modelValue":[x[2]||(x[2]=E=>n.value.ID=E),f],items:b.value,label:`${U.value} ID`,required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","label"])]),p("div",Na,[e(j,{modelValue:n.value.AP,"onUpdate:modelValue":x[3]||(x[3]=E=>n.value.AP=E),modelModifiers:{number:!0},label:"AP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":"","bg-color":n.value.AP===0?"error":void 0,class:"mb-3"},null,8,["modelValue","bg-color"]),e(I,{text:"Reset",color:"primary",block:"",onClick:O})])]),v.type==="SA"&&n.value.ID?(V(),G("div",Ea,[h.value?(V(),L(j,{key:1,modelValue:n.value.EXAP,"onUpdate:modelValue":x[6]||(x[6]=E=>n.value.EXAP=E),modelModifiers:{number:!0},label:"SA EXAP",type:"number",max:"999",min:"0",required:"",variant:"outlined",density:"compact","hide-details":""},{append:l(()=>[e(El,{color:"error",icon:"mdi-delete",onClick:x[5]||(x[5]=E=>h.value=!1)})]),_:1},8,["modelValue"])):(V(),L(I,{key:0,text:"Add EXAP","prepend-icon":"mdi-plus",block:"",onClick:x[4]||(x[4]=E=>h.value=!0)}))])):ge("",!0),e(le,null,{default:l(()=>[n.value.detail&&n.value.detail.length>0?(V(),L(c,{key:0,cols:"12",class:"d-flex align-center"},{default:l(()=>[p("p",Ma,H(U.value)+" Detail",1)]),_:1})):ge("",!0),(V(!0),G(ee,null,ue(n.value.detail,(E,F)=>(V(),G(ee,{key:F},[e(c,{cols:"12",class:"py-0"},{default:l(()=>[q("Detail "+H(F+1),1)]),_:2},1024),e(c,{cols:"12",class:"d-flex"},{default:l(()=>[(V(!0),G(ee,null,ue(n.value.detail[F],(J,W)=>(V(),L(j,{key:W,modelValue:n.value.detail[F][W],"onUpdate:modelValue":ye=>n.value.detail[F][W]=ye,label:`Level ${W+1}`,variant:"underlined",density:"compact","hide-details":"",readonly:"",class:"pr-3",style:{width:"calc(100% / 15)"}},null,8,["modelValue","onUpdate:modelValue","label"]))),128)),e(I,{icon:"mdi-pencil",variant:"text",density:"compact",onClick:J=>w.$emit("open-detail",n.value.detail,F)},null,8,["onClick"])]),_:2},1024)],64))),128)),n.value.addSA?(V(!0),G(ee,{key:1},ue(n.value.addSA,(E,F)=>(V(),L(c,{key:F,cols:"12"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[q(H(`Add Special Appeal ${F+1}`)+" ",1),e(Ve),e(I,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(J=>a("SA",F),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(Ye,{modelValue:n.value.addSA[F],"onUpdate:modelValue":J=>n.value.addSA[F]=J,type:"addSA",index:F,onOpenDetail:x[7]||(x[7]=(J,W)=>w.$emit("open-detail",J,W))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ge("",!0),n.value.addSA&&g.value.includes("addSA")?(V(),L(c,{key:2,cols:"12"},{default:l(()=>[e(I,{color:"yellow","prepend-icon":"mdi-plus",text:"Add SA",block:"",onClick:x[8]||(x[8]=E=>u("SA"))})]),_:1})):ge("",!0),n.value.addSkill?(V(!0),G(ee,{key:3},ue(n.value.addSkill,(E,F)=>(V(),L(c,{key:F,cols:"12"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[q(H(`Add Skill ${F+1}`)+" ",1),e(Ve),e(I,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(J=>a("Skill",F),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(Ye,{modelValue:n.value.addSkill[F],"onUpdate:modelValue":J=>n.value.addSkill[F]=J,type:"addSkill",index:F,onOpenDetail:x[9]||(x[9]=(J,W)=>w.$emit("open-detail",J,W))},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)):ge("",!0),n.value.addSkill&&g.value.includes("addCard")?(V(),L(c,{key:4,cols:"12"},{default:l(()=>[e(I,{color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",onClick:x[10]||(x[10]=E=>u("Skill"))})]),_:1})):ge("",!0)]),_:1})],64))}}),Ra={class:"d-flex align-center"},Oa={class:"text-center"},Ta={class:"text-center"},Pa=Se({__name:"EditDetailDataDialog",props:{modelValue:{type:Boolean},initialValues:{}},emits:["update:modelValue","save"],setup(v,{emit:R}){const h=v,$=R,D=[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,2,2.1,2.2,2.3,2.5],M={trunc:"整数",floor:"切り捨て",round:"四捨五入",ceil:"切り上げ"},n=m(0),T=m(!1),k=m(2),N=m("ceil"),A=m(!1),C=m([]),y=m([]),U=Z(()=>T.value?n.value/2.5:n.value);oe(()=>h.modelValue,o=>{if(o){const u=JSON.parse(JSON.stringify(h.initialValues||[]));y.value=u.map(a=>a===null?"null":a),C.value=y.value.map(a=>String(a).endsWith("?")),A.value=C.value.every(Boolean)}});const b=o=>parseFloat(o.toFixed(10)),g=o=>{const u=String(y.value[o]||"");C.value[o]?u.endsWith("?")||(y.value[o]=u+"?"):u.endsWith("?")&&(y.value[o]=u.slice(0,-1))},S=()=>{C.value=C.value.map(()=>A.value),C.value.forEach((o,u)=>g(u))},f=o=>{const u=Math.pow(10,k.value);y.value=D.map((a,O)=>{const w=U.value*a;let x=0;switch(o){case"trunc":x=Math.trunc(b(w));break;case"floor":x=Math.floor(b(w*u))/u;break;case"round":x=Math.round(b(w*u))/u;break;case"ceil":x=Math.ceil(b(w*u))/u;break;default:x=0}return C.value[O]?String(x)+"?":x})},s=()=>{const o=y.value.map(u=>{const a=String(u);return a==="null"?null:a});$("save",o),$("update:modelValue",!1)};return(o,u)=>(V(),L(Pe,{"model-value":v.modelValue,"max-width":"1200px","onUpdate:modelValue":u[7]||(u[7]=a=>o.$emit("update:modelValue",a))},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...u[8]||(u[8]=[q("Edit Detail Data",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=a=>n.value=a),label:"Init Number",type:"number",min:"0",step:"0.1",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Xe,{modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=a=>T.value=a),label:"14",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:k.value,"onUpdate:modelValue":u[2]||(u[2]=a=>k.value=a),label:"Decimal Point",type:"number",max:"9",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[p("div",Ra,[e(Q,{modelValue:N.value,"onUpdate:modelValue":u[3]||(u[3]=a=>N.value=a),items:Object.entries(M).map(([a,O])=>({title:O,value:a})),"item-title":"title","item-value":"value",label:"Data Format Type",variant:"outlined",density:"compact","hide-details":"",class:"mr-3"},null,8,["modelValue","items"]),e(I,{text:"Set",color:"primary","prepend-icon":"mdi-plus",onClick:u[4]||(u[4]=a=>f(N.value))})])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(il,{density:"compact"},{default:l(()=>[p("thead",null,[p("tr",null,[u[9]||(u[9]=p("th",{class:"text-center"},"Level",-1)),u[10]||(u[10]=p("th",{class:"text-center"},"倍率",-1)),(V(),G(ee,null,ue(M,(a,O)=>p("th",{key:O,class:"text-center"},H(a),1)),64)),u[11]||(u[11]=p("th",{class:"text-center",style:{width:"125px"}},"Result",-1)),p("th",Oa,[e(Sl,{modelValue:A.value,"onUpdate:modelValue":[u[5]||(u[5]=a=>A.value=a),S],color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])])])]),p("tbody",Ta,[(V(),G(ee,null,ue(D,(a,O)=>p("tr",{key:O},[p("td",null,H(O+1),1),p("td",null,H(a),1),p("td",null,H(Math.trunc(b(U.value*a))),1),p("td",null,H(Math.floor(b(U.value*a*Math.pow(10,k.value)))/Math.pow(10,k.value)),1),p("td",null,H(Math.round(b(U.value*a*Math.pow(10,k.value)))/Math.pow(10,k.value)),1),p("td",null,H(Math.ceil(b(U.value*a*Math.pow(10,k.value)))/Math.pow(10,k.value)),1),p("td",null,[e(j,{modelValue:y.value[O],"onUpdate:modelValue":w=>y.value[O]=w,variant:"underlined",density:"compact","hide-details":"",onKeyup:da(s,["enter"])},{"append-inner":l(()=>[e(I,{size:"x-small",variant:"text",color:"grey",class:"pa-0",style:{"min-width":"24px"},text:"null",onClick:w=>y.value[O]="null"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),p("td",null,[e(Sl,{modelValue:C.value[O],"onUpdate:modelValue":[w=>C.value[O]=w,w=>g(O)],color:"pink",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])])),64))])]),_:1})]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(I,{text:"Cancel",color:"error",onClick:u[6]||(u[6]=a=>o.$emit("update:modelValue",!1))}),e(I,{text:"Save",color:"primary",onClick:s})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),La={style:{width:"calc(100% / 6)"}},Ba={class:"mb-3"},Fa={class:"d-flex justify-space-between mb-3"},ja=["onClick"],Ha={class:"text-subtitle-1 text-center mb-1"},Ka=["onChange"],qa=Se({__name:"AddCard",setup(v){const R=Te(),h=fl(),$=["smile","pure","cool","mental","BP"],D=Z(()=>Object.entries(h.skillDetails).map(([B,r])=>({title:r.skillDetailName,value:B}))),M=()=>{f.value=!1},n=()=>{s.value=!1},T=pl(),k=m({}),N=m(""),A=m(!1),C=m(""),y=m("success"),U=m(""),b=m(!1),g=m([]),S=m(null),f=m(!0),s=m(!0),o=m(null),u=m(null),a=m(null),O=m(null),w=m(null),x=m(null),E=B=>{B==="before"?o.value?.click():u.value?.click()},F=(B,r)=>{const i=B.target;if(i.files&&i.files.length>0){const P=i.files[0],Y=new Image,se=URL.createObjectURL(P);Y.onload=()=>{const Ie=600/Y.width,Ae=Math.round(Y.height*Ie);Ae!==389&&(C.value=`画像のアスペクト比が不正です。
期待値: 600x389相当
検出: ${Y.width}x${Y.height} (リサイズ後: 600x${Ae})`,y.value="warning",A.value=!0),URL.revokeObjectURL(se)},Y.src=se;const ae=new FileReader;r==="before"?(a.value=P,ae.onload=te=>w.value=te.target?.result):(O.value=P,ae.onload=te=>x.value=te.target?.result),ae.readAsDataURL(P)}},J=B=>{B==="before"?(a.value=null,w.value=null,t.value.imageUrl.before="",o.value&&(o.value.value="")):(O.value=null,x.value=null,t.value.imageUrl.after="",u.value&&(u.value.value=""))},W=["standard","max"],ye=m(W[1]),X=m({smile:0,pure:0,cool:0,mental:0,BP:100});oe([X,ye],()=>{const B=ye.value==="max"?1.2:1;$.forEach(r=>{const i=Number(X.value[r]),P=/mental|BP/.test(r)?1:B;t.value.uniqueStatus[r]=isNaN(i)?0:Math.ceil(i/P)})},{deep:!0});const ie=Z(()=>g.value&&S.value!==null?g.value[S.value]||[]:[]),de=(B,r)=>{g.value=B,S.value=r,b.value=!0},Ce=B=>{S.value!==null&&(g.value[S.value]=B)},he=()=>{t.value.characteristic.addSkill.push(JSON.parse(JSON.stringify(d)))},De=B=>{t.value.characteristic.addSkill.splice(B,1)},d={...{ID:"",name:"",AP:0,detail:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},characteristic:{name:"",detail:"",type:[""]}},t=m({cardName:"",memberName:tl.KAHO,rare:rl[3],styleType:wl.PERFORMER.en,mood:xl.HAPPY.en,gacha:{addSeason:"",period:Je.normal.en},year:2025,split:1,series:"",kana:"",imageUrl:{before:"",after:""},uniqueStatus:{smile:0,pure:0,cool:0,mental:0,BP:100},specialAppeal:{ID:"",name:"",AP:0,EXAP:[0,0,0,0,0,0,0,0,0,0,0,0,0,0],detail:[],addSA:[],addSkill:[]},skill:{ID:"",name:"",AP:0,detail:[],addSkill:[]},characteristic:{name:"",detail:"",type:[],addSkill:[]}}),z=async()=>{if(!U.value)return;let B;try{B=JSON.parse(U.value)}catch{try{B=new Function("return "+U.value)(),U.value=JSON.stringify(B,null,2)}catch{C.value="JSONのフォーマットが不正です",y.value="error",A.value=!0;return}}try{const r=R.isDev?we:me,i=Le(me.app),P={};for(const[Y,se]of Object.entries(B)){const ae=t.value.rare;let te="",ce="";try{te=await Re(Me(i,`cardIllust/${Y}_before.webp`))}catch{console.warn(`Before image not found for ${Y}`)}try{ce=await Re(Me(i,`cardIllust/${Y}_after.webp`))}catch{console.warn(`After image not found for ${Y}`)}const Ie={...se,imageUrl:{before:te,after:ce}};P[`cards/${ca(Y.split("_")[0])}/${ae}/${Y}`]=Ie}await Be(be(r),P),C.value=`Uploaded to ${R.isDev?"Dev":"Prod"}`,y.value="success",A.value=!0}catch(r){console.error(r),C.value="Error uploading card data",y.value="error",A.value=!0}};Fe(()=>{const B=be(we,"card");ol(B,r=>{const i=r.val();i&&(k.value=i)})}),oe([()=>T.editTarget,k],([B,r])=>{if(B&&B.type==="card"&&B.id&&r&&Object.keys(r).length>0){let i=null,P,Y;for(const ae in r){for(const te in r[ae])if(r[ae][te][B.id]){i=r[ae][te][B.id],P=ae,Y=te;break}if(i)break}if(!i)return;N.value=B.id,t.value.memberName=P,t.value.rare=Y,t.value.cardName=i.cardName,t.value.kana=i.kana,t.value.series=i.series||"",t.value.styleType=i.styleType,t.value.mood=i.mood;const se=Object.entries(Je).find(([ae,te])=>ae===i.gacha.period);t.value.gacha.period=se?se[1].en:Je.normal.en,t.value.gacha.addSeason=i.gacha.addSeason,t.value.uniqueStatus={...i.uniqueStatus},i.specialAppeal&&(t.value.specialAppeal.ID=i.specialAppeal.ID,t.value.specialAppeal.name=i.specialAppeal.name,t.value.specialAppeal.AP=i.specialAppeal.AP,t.value.specialAppeal.detail=i.specialAppeal.detail||[]),i.skill&&(t.value.skill.ID=i.skill.ID,t.value.skill.name=i.skill.name,t.value.skill.AP=i.skill.AP,t.value.skill.detail=i.skill.detail||[]),i.characteristic&&(t.value.characteristic.name=i.characteristic.name,t.value.characteristic.detail=i.characteristic.detail,t.value.characteristic.type=i.characteristic.type||[]),i.imageUrl?(t.value.imageUrl.before=i.imageUrl.before||"",t.value.imageUrl.after=i.imageUrl.after||""):(t.value.imageUrl.before="",t.value.imageUrl.after=""),T.setEditTarget("","")}},{immediate:!0});function ne(){if(N.value)return N.value;const B=t.value.memberName,r=ma[B];let i=0;const P=k.value[B];if(P){for(const Y in P)for(const se in P[Y])if(se.startsWith(r+"_")){const ae=parseInt(se.split("_")[1],10);!isNaN(ae)&&ae>i&&(i=ae)}}return`${r}_${String(i+1).padStart(3,"0")}`}function ve(B){const r=Object.entries(Je).find(([,i])=>i.en===B);return r?r[0]:"normal"}const pe=Z(()=>{const B=ne(),r=ve(t.value.gacha.period),i={cardName:t.value.cardName,styleType:t.value.styleType,mood:t.value.mood,series:t.value.series,kana:t.value.kana,gacha:{addSeason:t.value.gacha.addSeason,period:r},uniqueStatus:{smile:t.value.uniqueStatus.smile,pure:t.value.uniqueStatus.pure,cool:t.value.uniqueStatus.cool,mental:t.value.uniqueStatus.mental,BP:t.value.uniqueStatus.BP},imageUrl:{...t.value.imageUrl.before&&{before:""},after:""},...f.value&&{specialAppeal:{ID:t.value.specialAppeal.ID,name:t.value.specialAppeal.name,AP:t.value.specialAppeal.AP,detail:t.value.specialAppeal.detail}},skill:{ID:t.value.skill.ID,name:t.value.skill.name,AP:t.value.skill.AP,detail:t.value.skill.detail},...s.value&&{characteristic:{name:t.value.characteristic.name,detail:t.value.characteristic.detail,type:t.value.characteristic.type}}},P={[B]:i};return JSON.stringify(P,null,2)}),Ue=(B,r,i)=>new Promise((P,Y)=>{const se=new Image,ae=new FileReader;ae.onload=te=>{se.src=te.target?.result},ae.onerror=te=>Y(te),se.onload=()=>{const te=r/se.width,ce=document.createElement("canvas");if(ce.width=r,ce.height=Math.round(se.height*te),ce.height!==i){Y(new Error(`画像サイズが不正です。
期待値: ${r}x${i}
実際: ${ce.width}x${ce.height}`));return}const Ie=ce.getContext("2d");Ie?(Ie.drawImage(se,0,0,ce.width,ce.height),ce.toBlob(Ae=>{Ae?P(Ae):Y(new Error("Canvas to Blob failed"))},"image/webp")):Y(new Error("Canvas context not available"))}}),nl=async()=>{try{const B=JSON.parse(pe.value),r=t.value.rare,i=Object.keys(B[r])[0],P=B[r][i],Y=t.value.memberName,se=Le(me.app),ae=async ce=>{const Ie=ce==="before"?a.value:O.value;if(!Ie)return;const Ae=await Ue(Ie,600,389),gl=Me(se,`cardIllust/${i}_${ce}.webp`);await We(gl,Ae),P.imageUrl[ce]=await Re(gl)};if(O.value)await ae("after");else throw new Error("覚醒後画像(After)を設定してください");a.value&&await ae("before");const te={};te[`card/${Y}/${r}/${i}`]=P,await Be(be(we),te),C.value="Dev環境にデータをアップロードしました",y.value="success",A.value=!0,N.value="",J("before"),J("after")}catch(B){console.error(B),C.value=B.message||"アップロードに失敗しました",y.value="error",A.value=!0}};return(B,r)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,{class:"mb-3"},{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:t.value.memberName,"onUpdate:modelValue":r[0]||(r[0]=i=>t.value.memberName=i),label:"Member Name",items:Object.values(K(tl)),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:t.value.rare,"onUpdate:modelValue":r[1]||(r[1]=i=>t.value.rare=i),label:"Rarity",items:K(rl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:t.value.styleType,"onUpdate:modelValue":r[2]||(r[2]=i=>t.value.styleType=i),label:"Style Type",items:Object.values(K(wl)).map(i=>i.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:t.value.mood,"onUpdate:modelValue":r[3]||(r[3]=i=>t.value.mood=i),label:"Mood",items:Object.values(K(xl)).map(i=>i.en),"item-title":"text","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:t.value.cardName,"onUpdate:modelValue":r[4]||(r[4]=i=>t.value.cardName=i),label:"Card Name",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:t.value.kana,"onUpdate:modelValue":r[5]||(r[5]=i=>t.value.kana=i),label:"Kana",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:t.value.series,"onUpdate:modelValue":r[6]||(r[6]=i=>t.value.series=i),label:"Series",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[...r[25]||(r[25]=[q("Unique Status",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(il,{density:"compact"},{default:l(()=>[r[27]||(r[27]=p("thead",null,[p("tr",null,[p("th",null,"Training Level"),p("th",null,"Smile"),p("th",null,"Pure"),p("th",null,"Cool"),p("th",null,"Mental"),p("th",null,"BP")])],-1)),p("tbody",null,[p("tr",null,[p("td",La,[e(Q,{modelValue:ye.value,"onUpdate:modelValue":r[7]||(r[7]=i=>ye.value=i),items:W,variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue"])]),(V(),G(ee,null,ue($,i=>p("td",{key:i,style:{width:"calc(100% / 6)"}},[e(j,{modelValue:X.value[i],"onUpdate:modelValue":P=>X.value[i]=P,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))]),p("tr",null,[r[26]||(r[26]=p("td",{style:{width:"calc(100% / 6)"}},null,-1)),(V(),G(ee,null,ue($,i=>p("td",{key:i,style:{width:"calc(100% / 6)"}},[e(j,{modelValue:t.value.uniqueStatus[i],"onUpdate:modelValue":P=>t.value.uniqueStatus[i]=P,type:"number",max:"99999",min:"0",variant:"underlined",density:"compact","hide-details":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),_:1})]),_:1}),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[...r[28]||(r[28]=[q("Gacha",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:t.value.gacha.period,"onUpdate:modelValue":r[8]||(r[8]=i=>t.value.gacha.period=i),label:"Period",items:Object.values(K(Je)).map(i=>i.en),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:t.value.year,"onUpdate:modelValue":r[9]||(r[9]=i=>t.value.year=i),label:"Year",type:"number",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"1"},{default:l(()=>[e(j,{modelValue:t.value.split,"onUpdate:modelValue":r[10]||(r[10]=i=>t.value.split=i),label:"Sprit",type:"number",min:"0",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:t.value.gacha.addSeason,"onUpdate:modelValue":r[11]||(r[11]=i=>t.value.gacha.addSeason=i),label:"Add Season",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),p("div",Ba,[f.value?(V(),L(re,{key:1},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap mb-2"},{default:l(()=>[r[29]||(r[29]=q(" Special Appeal ",-1)),e(Ve),e(I,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:M})]),_:1}),e(ke,null,{default:l(()=>[e(Ye,{modelValue:t.value.specialAppeal,"onUpdate:modelValue":r[13]||(r[13]=i=>t.value.specialAppeal=i),type:"SA",onOpenDetail:de},null,8,["modelValue"])]),_:1})]),_:1})):(V(),L(I,{key:0,text:"Add Special Appeal","prepend-icon":"mdi-plus",block:"",onClick:r[12]||(r[12]=i=>f.value=!0)}))]),e(re,{class:"mb-3"},{default:l(()=>[e(fe,{class:"text-no-wrap mb-2"},{default:l(()=>[...r[30]||(r[30]=[q("Skill",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(Ye,{modelValue:t.value.skill,"onUpdate:modelValue":r[14]||(r[14]=i=>t.value.skill=i),type:"skill",onOpenDetail:de},null,8,["modelValue"])]),_:1})]),_:1}),p("div",null,[s.value?(V(),L(re,{key:1},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap"},{default:l(()=>[r[31]||(r[31]=q(" Characteristic ",-1)),e(Ve),e(I,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:n})]),_:1}),e(ke,null,{default:l(()=>[e(j,{modelValue:t.value.characteristic.name,"onUpdate:modelValue":r[16]||(r[16]=i=>t.value.characteristic.name=i),label:"Characteristic Name",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),e(Oe,{modelValue:t.value.characteristic.detail,"onUpdate:modelValue":r[17]||(r[17]=i=>t.value.characteristic.detail=i),label:"Characteristic Detail",variant:"outlined",density:"compact","hide-details":"",class:"mb-3"},null,8,["modelValue"]),r[32]||(r[32]=p("p",{class:"text-subtitle-1 mb-3"},"Type",-1)),e(le,null,{default:l(()=>[(V(!0),G(ee,null,ue(t.value.characteristic.type,(i,P)=>(V(),L(c,{key:P,cols:"4",class:"d-flex align-center"},{default:l(()=>[e(Q,{modelValue:t.value.characteristic.type[P],"onUpdate:modelValue":Y=>t.value.characteristic.type[P]=Y,items:D.value,"item-title":"title","item-value":"value",label:`Type ${P+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items","label"]),e(I,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",onClick:Y=>t.value.characteristic.type.splice(P,1)},null,8,["onClick"])]),_:2},1024))),128)),e(c,{cols:"4"},{default:l(()=>[e(I,{text:"Add Type","prepend-icon":"mdi-plus",block:"",onClick:r[18]||(r[18]=i=>t.value.characteristic.type.push(""))})]),_:1})]),_:1}),(V(!0),G(ee,null,ue(t.value.characteristic.addSkill,(i,P)=>(V(),L(c,{key:P,cols:"12",class:"mt-3"},{default:l(()=>[e(dl,{color:"yellow"},{default:l(()=>[e(cl,null,{default:l(()=>[e(ml,null,{default:l(()=>[q(H(`Add Skill ${P+1}`)+" ",1),e(Ve),e(I,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",onClick:Ke(Y=>De(P),["stop"])},null,8,["onClick"])]),_:2},1024),e(vl,null,{default:l(()=>[e(Ye,{modelValue:t.value.characteristic.addSkill[P],"onUpdate:modelValue":Y=>t.value.characteristic.addSkill[P]=Y,type:"addSkill",index:P,onOpenDetail:de},null,8,["modelValue","onUpdate:modelValue","index"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),t.value.characteristic.type.includes("addCard")?(V(),L(I,{key:0,color:"yellow","prepend-icon":"mdi-plus",text:"Add Skill",block:"",class:"mt-3",onClick:he})):ge("",!0)]),_:1})]),_:1})):(V(),L(I,{key:0,text:"Add Characteristic","prepend-icon":"mdi-plus",block:"",onClick:r[15]||(r[15]=i=>s.value=!0)}))])]),_:1}),e(c,{cols:"4"},{default:l(()=>[p("div",Fa,[(V(),G(ee,null,ue(["before","after"],i=>p("div",{key:i,class:"position-relative cursor-pointer",style:{width:"49%"},onClick:P=>E(i)},[p("p",Ha,H(i==="before"?"Before":"After"),1),e(Ee,{src:(i==="before"?w.value:x.value)||t.value.imageUrl[i]||K(Ml),width:"100%"},null,8,["src"]),(i==="before"?w.value:x.value)||t.value.imageUrl[i]?(V(),L(I,{key:0,icon:"mdi-close",size:"x-small",color:"error",style:{position:"absolute",top:"5px",right:"5px","z-index":"1"},onClick:Ke(P=>J(i),["stop"])},null,8,["onClick"])):ge("",!0),p("input",{ref_for:!0,ref:P=>i==="before"?o.value=P:u.value=P,type:"file",accept:"image/webp",class:"d-none",onChange:P=>F(P,i)},null,40,Ka)],8,ja)),64))]),e(Oe,{label:"Result","auto-grow":"",readonly:"","model-value":pe.value},null,8,["model-value"]),e(I,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mr-2",onClick:r[19]||(r[19]=i=>B.navigator.clipboard.writeText(pe.value))}),e(I,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",onClick:nl})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Qe)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:t.value.rare,"onUpdate:modelValue":r[20]||(r[20]=i=>t.value.rare=i),label:"Rarity",items:K(rl),"item-title":"label","item-value":"value",required:"",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(Oe,{modelValue:U.value,"onUpdate:modelValue":r[21]||(r[21]=i=>U.value=i)},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(I,{color:"green","prepend-icon":"mdi-cloud-upload",text:`${K(R).isDev?"Dev":"Prod"} Upload`,onClick:r[22]||(r[22]=i=>z())},null,8,["text"])]),_:1})]),_:1}),e(Pa,{modelValue:b.value,"onUpdate:modelValue":r[23]||(r[23]=i=>b.value=i),"initial-values":ie.value,onSave:Ce},null,8,["modelValue","initial-values"]),e(je,{modelValue:A.value,"onUpdate:modelValue":r[24]||(r[24]=i=>A.value=i),timeout:3e3,color:y.value},{default:l(()=>[q(H(C.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Ja={style:{"max-width":"300px"}},za={class:"d-flex justify-space-evenly mt-3"},Ga=Se({__name:"AddMusic",setup(v){const R=m(!1),h=m("group"),$=m(!1),D=m(null),M=m([]),n=m(null),T=m(null),k=m(!1),N=m(!1),A=m("データを一時保存しました"),C=m("success"),y=m(!1),U=m(null),b=m(null),g=Pl,S=pl(),f=Te(),s=m({});Fe(()=>{const _=be(we,"music");ol(_,d=>{const t=d.val();if(t&&(s.value=t,a.value.musicName==="")){const z=Object.keys(t).length,ne=S.pendingList.filter(pe=>pe.type==="music"&&!t[Object.keys(pe.data)[0]]).length,ve=`m_${z+ne+1}`;a.value.ID=ve,a.value.ID_original=ve,a.value.ID_preset=ve}})}),oe([()=>S.editTarget,s],([_,d])=>{_&&_.type==="music"&&_.id&&d&&Object.keys(d).length>0&&d[_.id]&&(U.value=_.id,J(),S.setEditTarget("",""))},{immediate:!0});const o=Z(()=>{let _=Object.entries(s.value);return b.value&&(_=_.filter(([d,t])=>{const z=t.musicData.kana;return z?Ll(z.charAt(0))===b.value:!1})),_.map(([d,t])=>({title:t.title,value:d}))}),u=()=>{const _=Object.keys(s.value).length,d=S.pendingList.filter(z=>z.type==="music"&&!s.value[Object.keys(z.data)[0]]).length,t=`m_${_+d+1}`;return{ID:t,ID_original:t,ID_preset:t,musicName:"",musicData:{kana:"",singer:el.HASUNOSORA,singer_group:"HASUNOSORA_105",singer_solo:[tl.KAHO],releaseDate:{year:2026,month:1,date:1},numbering:"",BPM:{original:150,inGame:150},time:{minuts:1,seconds:0,miliSeconds:0},cover:!1},imageURL:"",attribute:Cl.SMILE.en,BHcount:0,level:0,term:105,center:tl.KAHO,bonusSkill:Ul.BEAT_HEART_UP,singingMembers:[],scoreData:{difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}}},a=m(u()),O=/^[\u3040-\u309F\u30FC0-9]*$/,w=[_=>O.test(_)||"ひらがなと数字のみ入力可能です"],x=Z({get:()=>{const _=a.value.musicData.releaseDate;return`${_.year}-${String(_.month).padStart(2,"0")}-${String(_.date).padStart(2,"0")}`},set:_=>{if(!_)return;const[d,t,z]=_.split("-").map(Number);a.value.musicData.releaseDate.year=d,a.value.musicData.releaseDate.month=t,a.value.musicData.releaseDate.date=z}});oe(y,_=>{_&&(a.value.musicData.releaseDate={year:2099,month:12,date:31})});const E=Z(()=>a.value.musicName!==""&&a.value.musicData.kana!==""&&O.test(a.value.musicData.kana)),F=Z(()=>{if(h.value==="group"){const _=a.value.musicData.singer_group;return ze[_].MEMBERS}else return a.value.musicData.singer_solo}),J=()=>{if(!U.value)return;const _=s.value[U.value];if(!_)return;if(R.value=!0,a.value.ID_preset=U.value,a.value.ID=R.value?U.value:a.value.ID_original,a.value.musicName=_.title,a.value.musicData.kana=_.musicData.kana,a.value.musicData.singer=_.musicData.singer,Object.values(el).includes(_.musicData.singer)){h.value="group";const z=Object.entries(el).find(([pe,Ue])=>Ue===_.musicData.singer),ne=z?z[0]:null,ve=Object.entries(ze).find(([pe,Ue])=>Ue.KEY===ne&&JSON.stringify(Ue.MEMBERS)===JSON.stringify(_.singingMembers));ve&&(a.value.musicData.singer_group=ve[0])}else h.value="solo",a.value.musicData.singer_group=u().musicData.singer_group;a.value.musicData.singer_solo=_.singingMembers,a.value.musicData.releaseDate={..._.musicData.releaseDate},y.value=a.value.musicData.releaseDate.year===2099&&a.value.musicData.releaseDate.month===12&&a.value.musicData.releaseDate.date===31,a.value.musicData.numbering=_.musicData.numbering,a.value.musicData.BPM={..._.musicData.BPM},a.value.musicData.cover=_.musicData.cover;const d=_.musicData.time;a.value.musicData.time.minuts=Math.floor(d/60);const t=Math.floor(d%60);a.value.musicData.time.seconds=t,a.value.musicData.time.miliSeconds=parseFloat(((d-a.value.musicData.time.minuts*60-t)*10).toFixed(1)),a.value.imageURL=_.imageURL||"",a.value.attribute=_.attribute,a.value.BHcount=_.BHcount,a.value.level=_.level,a.value.term=_.term,a.value.center=_.center,a.value.bonusSkill=_.bonusSkill,a.value.singingMembers=[..._.singingMembers],_.scoreData?(k.value=!0,a.value.scoreData=JSON.parse(JSON.stringify(_.scoreData))):(k.value=!1,a.value.scoreData={difficultyLevel:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1},maxCombo:{NORMAL:1,HARD:1,EXPERT:1,MASTER:1}}),U.value=null,D.value=null},W=()=>{R.value=!1,U.value=null,k.value=!1,D.value=null,h.value="group",a.value=u(),y.value=!1},ye=async()=>{try{const _=JSON.parse(De.value),d=Object.keys(_)[0];if($.value=!0,n.value){const z=Le(me.app),ne=Me(z,`cdJacket/${n.value.name}`);try{if(await Re(ne),!confirm(`同名のファイル (${n.value.name}) が既に存在します。
上書きしますか？`)){$.value=!1;return}}catch{}const ve=await We(ne,n.value),pe=await Re(ve.ref);_[d].imageURL=pe,f.imageCache.llllMgr_musicImageUrls||(f.imageCache.llllMgr_musicImageUrls={}),f.imageCache.llllMgr_musicImageUrls[d]=pe}const t={};t[`music/${d}`]=_[d],await Be(be(we),t),A.value="Dev環境にデータをアップロードしました",C.value="success",N.value=!0,de()}catch(_){console.error("Failed to parse JSON",_),A.value="アップロードに失敗しました",C.value="error",N.value=!0}finally{$.value=!1}},X=async()=>{if(!a.value.musicName)return;const _=Le(me.app),d=Me(_,"cdJacket");try{const z=(await Rl(d)).items.find(ne=>{const ve=ne.name,pe=ve.lastIndexOf(".");return(pe!==-1?ve.substring(0,pe):ve)===a.value.musicName});if(z){const ne=await Re(z);a.value.imageURL=ne,f.imageCache.llllMgr_musicImageUrls||(f.imageCache.llllMgr_musicImageUrls={}),f.imageCache.llllMgr_musicImageUrls[a.value.ID]=ne,A.value="画像URLを取得しました",C.value="success",N.value=!0}else A.value="画像が見つかりませんでした",C.value="warning",N.value=!0}catch(t){console.error("Failed to fetch image",t),A.value="画像の取得に失敗しました",C.value="error",N.value=!0}},ie=_=>{const d=Array.isArray(_)?_[0]:_;if(!d){de();return}n.value=d;const t=new FileReader;t.onload=z=>{T.value=z.target?.result},t.readAsDataURL(d)},de=()=>{n.value=null,T.value=null,M.value=[],D.value&&(D.value.value="")},Ce=()=>{D.value?.click()},he=_=>{const d=_.target;d.files&&d.files.length>0&&ie(d.files[0])},De=Z(()=>{const _=(a.value.musicData.time.minuts||0)*60+(a.value.musicData.time.seconds||0)+(a.value.musicData.time.miliSeconds||0)/10,d={[R.value?a.value.ID_preset:a.value.ID_original]:{title:a.value.musicName,musicData:{kana:a.value.musicData.kana,singer:h.value==="group"?el[ze[a.value.musicData.singer_group].KEY]:a.value.musicData.singer_solo.map(t=>ya(t)).join("、"),releaseDate:{year:a.value.musicData.releaseDate.year,month:a.value.musicData.releaseDate.month,date:a.value.musicData.releaseDate.date},numbering:a.value.musicData.numbering,BPM:{original:a.value.musicData.BPM.original,inGame:a.value.musicData.BPM.inGame},time:_,cover:a.value.musicData.cover},imageURL:a.value.imageURL,attribute:a.value.attribute,BHcount:a.value.BHcount,level:a.value.level,term:a.value.term,center:a.value.center,bonusSkill:a.value.bonusSkill,singingMembers:h.value==="group"?ze[a.value.musicData.singer_group].MEMBERS:a.value.musicData.singer_solo}};return k.value&&(d[R.value?a.value.ID_preset:a.value.ID_original].scoreData={difficultyLevel:{NORMAL:a.value.scoreData.difficultyLevel.NORMAL,HARD:a.value.scoreData.difficultyLevel.HARD,EXPERT:a.value.scoreData.difficultyLevel.EXPERT,MASTER:a.value.scoreData.difficultyLevel.MASTER},maxCombo:{NORMAL:a.value.scoreData.maxCombo.NORMAL,HARD:a.value.scoreData.maxCombo.HARD,EXPERT:a.value.scoreData.maxCombo.EXPERT,MASTER:a.value.scoreData.maxCombo.MASTER}}),JSON.stringify(d,null,2)});return(_,d)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=t=>b.value=t),label:"五十音",items:K(g),"item-title":"title","item-value":"value",clearable:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"7"},{default:l(()=>[e(Q,{modelValue:U.value,"onUpdate:modelValue":d[1]||(d[1]=t=>U.value=t),label:"Preset",items:o.value,"item-title":"title","item-value":"value",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(I,{color:"primary",text:"Set",disabled:!U.value,onClick:J},null,8,["disabled"]),e(I,{color:"warning",text:"Reset",class:"mx-2",onClick:W}),e(I,{color:"yellow","prepend-icon":"mdi-image-sync",text:"get",disabled:!a.value.musicName,onClick:X},null,8,["disabled"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Qe)]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{"model-value":R.value?a.value.ID_preset:a.value.ID_original,label:"Music ID",readonly:"","prepend-inner-icon":"mdi-information",density:"compact",variant:"outlined","hide-details":""},null,8,["model-value"])]),_:1}),e(c,{cols:"10"},{default:l(()=>[e(Xe,{modelValue:R.value,"onUpdate:modelValue":d[2]||(d[2]=t=>R.value=t),label:"ID Override",color:"pink",disabled:a.value.ID_preset===a.value.ID_original,class:"pl-2",density:"compact","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:a.value.musicName,"onUpdate:modelValue":d[3]||(d[3]=t=>a.value.musicName=t),label:"Song Title",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:a.value.musicData.kana,"onUpdate:modelValue":d[4]||(d[4]=t=>a.value.musicData.kana=t),label:"Kana",required:"",rules:w,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(va,{modelValue:h.value,"onUpdate:modelValue":d[5]||(d[5]=t=>h.value=t),label:"Singer",inline:"",density:"compact","hide-details":""},{default:l(()=>[e(hl,{label:"Group",value:"group",color:"pink",class:"mr-3"}),e(hl,{label:"Solo",value:"solo",color:"pink"})]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:a.value.musicData.singer_group,"onUpdate:modelValue":d[6]||(d[6]=t=>a.value.musicData.singer_group=t),items:Object.entries(K(ze)).map(([t,z])=>({title:z.NAME,value:t})),"item-title":"title","item-value":"value",label:"Group",disabled:h.value!=="group",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:a.value.musicData.singer_solo,"onUpdate:modelValue":d[7]||(d[7]=t=>a.value.musicData.singer_solo=t),items:K(pa)(),label:"Solo",multiple:"",disabled:h.value!=="solo",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(j,{modelValue:x.value,"onUpdate:modelValue":d[8]||(d[8]=t=>x.value=t),label:"Release Date",type:"date",disabled:y.value,required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","disabled"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(Xe,{modelValue:y.value,"onUpdate:modelValue":d[9]||(d[9]=t=>y.value=t),label:"Unknown Date",color:"pink",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:a.value.musicData.numbering,"onUpdate:modelValue":d[10]||(d[10]=t=>a.value.musicData.numbering=t),label:"Numbering",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.musicData.BPM.original,"onUpdate:modelValue":d[11]||(d[11]=t=>a.value.musicData.BPM.original=t),modelModifiers:{number:!0},label:"BPM (Original)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.musicData.BPM.inGame,"onUpdate:modelValue":d[12]||(d[12]=t=>a.value.musicData.BPM.inGame=t),modelModifiers:{number:!0},label:"BPM (In Game)",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.musicData.time.minuts,"onUpdate:modelValue":d[13]||(d[13]=t=>a.value.musicData.time.minuts=t),modelModifiers:{number:!0},label:"Time (minuts)",type:"number",max:"9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.musicData.time.seconds,"onUpdate:modelValue":d[14]||(d[14]=t=>a.value.musicData.time.seconds=t),modelModifiers:{number:!0},label:"Time (seconds)",type:"number",max:"59",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.musicData.time.miliSeconds,"onUpdate:modelValue":d[15]||(d[15]=t=>a.value.musicData.time.miliSeconds=t),modelModifiers:{number:!0},label:"Time (miliSeconds)",type:"number",step:"0.1",max:"99.9",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Xe,{modelValue:a.value.musicData.cover,"onUpdate:modelValue":d[16]||(d[16]=t=>a.value.musicData.cover=t),label:"Cover",color:"pink",class:"pl-1",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:a.value.attribute,"onUpdate:modelValue":d[17]||(d[17]=t=>a.value.attribute=t),label:"Attribute",items:Object.values(K(Cl)).map(t=>t.en),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.BHcount,"onUpdate:modelValue":d[18]||(d[18]=t=>a.value.BHcount=t),modelModifiers:{number:!0},label:"BH Count",type:"number",max:"999",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.level,"onUpdate:modelValue":d[19]||(d[19]=t=>a.value.level=t),modelModifiers:{number:!0},label:"Level",type:"number",max:"1",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"2"},{default:l(()=>[e(j,{modelValue:a.value.term,"onUpdate:modelValue":d[20]||(d[20]=t=>a.value.term=t),modelModifiers:{number:!0},label:"Term",type:"number",min:"0",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(le,null,{default:l(()=>[e(c,{cols:"2"},{default:l(()=>[e(Q,{modelValue:a.value.center,"onUpdate:modelValue":d[21]||(d[21]=t=>a.value.center=t),label:"Center",items:F.value,"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"3"},{default:l(()=>[e(Q,{modelValue:a.value.bonusSkill,"onUpdate:modelValue":d[22]||(d[22]=t=>a.value.bonusSkill=t),label:"Bonus Skill",items:Object.entries(K(Ul)).map(([t,z])=>z),"item-text":"label","item-value":"value",required:"",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[k.value?(V(),L(re,{key:1},{default:l(()=>[e(fe,{class:"mb-2"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"6"},{default:l(()=>[...d[28]||(d[28]=[q("Difficulty Level",-1)])]),_:1}),e(c,{cols:"6",class:"d-flex"},{default:l(()=>[d[29]||(d[29]=q(" Max Combo ",-1)),e(Ve),e(I,{icon:"mdi-close",variant:"text",density:"compact",color:"error",onClick:d[24]||(d[24]=t=>k.value=!1)})]),_:1})]),_:1})]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[(V(),G(ee,null,ue(["difficultyLevel","maxCombo"],t=>e(c,{key:t,cols:"6"},{default:l(()=>[e(le,null,{default:l(()=>[(V(),G(ee,null,ue(["NORMAL","HARD","EXPERT","MASTER"],z=>e(c,{key:z,cols:"3"},{default:l(()=>[e(j,{modelValue:a.value.scoreData[t][z],"onUpdate:modelValue":ne=>a.value.scoreData[t][z]=ne,modelModifiers:{number:!0},label:z,type:"number",max:"99",min:"1",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)),64))]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})):(V(),L(I,{key:0,text:"Include Score Data (Difficulty Level & Max Combo)","prepend-icon":"mdi-plus",block:"",onClick:d[23]||(d[23]=t=>k.value=!0)}))]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(I,{color:"primary","prepend-icon":"mdi-content-copy",text:"Copy",class:"mr-5",onClick:d[25]||(d[25]=t=>_.navigator.clipboard.writeText(De.value.value))}),e(I,{color:"green","prepend-icon":"mdi-cloud-upload",text:"Dev Upload",disabled:!E.value,onClick:ye},null,8,["disabled"])]),_:1}),e(c,{cols:"12",align:"center"},{default:l(()=>[p("div",Ja,[e(Ee,{src:T.value||a.value.imageURL||K(fa)},null,8,["src"]),p("div",za,[e(I,{color:"primary","prepend-icon":"mdi-file-import",text:"Import Image",onClick:Ce}),e(I,{color:"error","prepend-icon":"mdi-close",text:"Delete",disabled:!n.value,onClick:de},null,8,["disabled"])])]),p("input",{ref_key:"fileInputRef",ref:D,type:"file",accept:"image/webp",class:"d-none",onChange:he},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:a.value.imageURL,"onUpdate:modelValue":d[26]||(d[26]=t=>a.value.imageURL=t),label:"Image URL","prepend-icon":"mdi-link-variant",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),a.value.imageURL?(V(),L(c,{key:0,cols:"12",class:"text-center"})):ge("",!0),e(c,{cols:"12"},{default:l(()=>[e(Oe,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":De.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(je,{modelValue:N.value,"onUpdate:modelValue":d[27]||(d[27]=t=>N.value=t),timeout:3e3,color:C.value},{default:l(()=>[q(H(A.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Xa={style:{width:"15%"}},Ya={style:{width:"5%"}},Wa={style:{width:"5%"}},Qa={style:{width:"20%"}},Za={key:1},et={style:{width:"30%"}},lt={key:1},at={style:{width:"25%"}},tt={key:1},ut=Se({__name:"AddItem",setup(v){const R=Te(),h=m(105),$=m("Spring"),D=m(1),M=m(Array.from({length:15},()=>({skillBook:"ITEMS.NONE",piece:"ITEMS.NONE",charm:"ITEMS.NONE"}))),n=Z(()=>{const C=[{title:xe.NONE,value:"ITEMS.NONE"}];return Object.entries(xe.SKILL_BOOK).forEach(([y,U])=>{C.push({title:U,value:`ITEMS.SKILL_BOOK.${y}`})}),C}),T=Z(()=>{const C=[{title:xe.NONE,value:"ITEMS.NONE"}];return Object.entries(xe.CHARM).forEach(([y,U])=>{typeof U=="object"?Object.entries(U).forEach(([b,g])=>{C.push({title:g,value:`ITEMS.CHARM.${y}.${b}`})}):C.push({title:U,value:`ITEMS.CHARM.${y}`})}),C}),k=Z(()=>{const C=M.value.map(y=>`        {
          獲得可能アイテム: [${y.skillBook}, ${y.piece}, ${y.charm}],
          //'低確率獲得可能アイテム': ITEMS.SKILL_BOOK.LOW,
        }`).join(`,
`);return`    ${$.value}: [
      [
${C}
      ],
    ],`}),N=Z(()=>{const C=[{title:xe.NONE,value:"ITEMS.NONE"}],y=U=>{Object.entries(xe.PIECE[U]).forEach(([b,g])=>{C.push({title:g,value:`ITEMS.PIECE.${U}.${b}`})})};switch(y("GARNET"),y("CARNELIAN"),$.value){case"Spring":y("EMERALD"),y("DIA");break;case"Summer":y("PERIDOT"),y("RUBY");break;case"Autumn":y("TOPAZ"),y("SAPPHIRE");break;case"Winter":y("TURQUOISE"),y("AMETHYST");break}return C}),A=C=>{C=/技能書/.test(C)?C:C.split("(")[0];for(const y in _l)if(C===y)return _l[y]};return(C,y)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:h.value,"onUpdate:modelValue":y[0]||(y[0]=U=>h.value=U),items:[103,104,105],label:"Period",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:$.value,"onUpdate:modelValue":y[1]||(y[1]=U=>$.value=U),items:["Spring","Summer","Autumn","Winter"],label:"Season",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:D.value,"onUpdate:modelValue":y[2]||(y[2]=U=>D.value=U),items:[1,2,3,4,5],label:"Area",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Qe,{class:"my-5"}),e(il,{density:"compact"},{default:l(()=>[y[4]||(y[4]=p("thead",null,[p("tr",null,[p("th",{style:{width:"15%"}},"期/季節"),p("th",{style:{width:"5%"}},"Area"),p("th",{style:{width:"5%"}},"Stage"),p("th",{style:{width:"20%"}},"Item (Skill Book)"),p("th",{style:{width:"30%"}},"Item (Piece)"),p("th",{style:{width:"25%"}},"Item (Charm)")])],-1)),p("tbody",null,[(V(),G(ee,null,ue(15,U=>p("tr",{key:U},[p("td",Xa,H(`${h.value}期${$.value}`),1),p("td",Ya,H(D.value),1),p("td",Wa,H(U),1),p("td",Qa,[e(Q,{modelValue:M.value[U-1].skillBook,"onUpdate:modelValue":b=>M.value[U-1].skillBook=b,items:n.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:g})=>[e(Ge,He({ref_for:!0},b,{title:g.title}),{prepend:l(()=>[g.title!==K(xe).NONE?(V(),L(Ee,{key:0,src:K(R).getImagePath("icons/trainingItem",g.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==K(xe).NONE?(V(),L(ll,{key:0,pill:"",class:"pl-0",color:A(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e(Ee,{src:K(R).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),q(" "+H(b.title),1)]),_:2},1032,["color"])):(V(),G("span",Za,H(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),p("td",et,[e(Q,{modelValue:M.value[U-1].piece,"onUpdate:modelValue":b=>M.value[U-1].piece=b,items:N.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:g})=>[e(Ge,He({ref_for:!0},b,{title:g.title}),{prepend:l(()=>[g.title!==K(xe).NONE?(V(),L(Ee,{key:0,src:K(R).getImagePath("icons/trainingItem",g.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==K(xe).NONE?(V(),L(ll,{key:0,pill:"",class:"pl-0",color:A(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e(Ee,{src:K(R).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),q(" "+H(b.title),1)]),_:2},1032,["color"])):(V(),G("span",lt,H(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])]),p("td",at,[e(Q,{modelValue:M.value[U-1].charm,"onUpdate:modelValue":b=>M.value[U-1].charm=b,items:T.value,"item-title":"title","item-value":"value",variant:"underlined","hide-details":""},{item:l(({props:b,item:g})=>[e(Ge,He({ref_for:!0},b,{title:g.title}),{prepend:l(()=>[g.title!==K(xe).NONE?(V(),L(Ee,{key:0,src:K(R).getImagePath("icons/trainingItem",g.title),style:{width:"40px"},class:"mr-2"},null,8,["src"])):ge("",!0)]),_:2},1040,["title"])]),selection:l(({item:b})=>[b.title!==K(xe).NONE?(V(),L(ll,{key:0,pill:"",class:"pl-0",color:A(b.title)},{default:l(()=>[e(al,{left:"",class:"mr-1"},{default:l(()=>[e(Ee,{src:K(R).getImagePath("icons/trainingItem",b.title)},null,8,["src"])]),_:2},1024),q(" "+H(b.title),1)]),_:2},1032,["color"])):(V(),G("span",tt,H(b.title),1))]),_:1},8,["modelValue","onUpdate:modelValue","items"])])])),64))])]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(I,{color:"primary","prepend-icon":"mdi-content-copy",text:"COPY",class:"mb-3",onClick:y[3]||(y[3]=U=>C.navigator.clipboard.writeText(k.value))}),e(Oe,{label:"Result","auto-grow":"",readonly:"",rows:"42","model-value":k.value},null,8,["model-value"])]),_:1})]),_:1})]),_:1}))}}),ul={heartCaptcha:"ハートキャプチャ系",loveAttract:"ラブアトラクト系",voltage:"ボルテージ系",mental:"メンタル系",extend:"手札枚数変更系",boost:"ブースト系",AP:"AP変化系",other:"その他"},ot={class:"text-h5"},it={class:"text-subtitle-2"},nt={class:"text-caption"},st={class:"d-flex justify-end mt-3"},rt=Se({__name:"EditSkillDataDialog",props:{modelValue:{type:Boolean},isNew:{type:Boolean},item:{default:()=>({name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}})},existingItems:{}},emits:["update:modelValue","save"],setup(v,{emit:R}){const h=v,$=R,D=Te(),M=fl(),n=m({...h.item}),T=m(!1),k=m(0),N=m(null),A=m(!1);oe(()=>h.modelValue,s=>{s&&(n.value=JSON.parse(JSON.stringify(h.item)))});const C=s=>{$("update:modelValue",s)},y=()=>{N.value=null,T.value=!0},U=s=>{N.value=s,T.value=!0},b=s=>{n.value.detail.type.splice(s,1)},g=s=>{const o={};if(!M.skillDetails)return o;for(const[u,a]of Object.entries(M.skillDetails))a.skillTypeKey===s&&(o[u]=a);return o},S=(s,o)=>{if(n.value.detail||(n.value.detail={attr:"",type:[]}),n.value.detail.type||(n.value.detail.type=[]),N.value!==null){if(n.value.detail.type.includes(s))return;n.value.detail.type[N.value]=s}else{if(n.value.detail.type.includes(s))return;n.value.detail.type.push(s)}T.value=!1,N.value=null},f=async()=>{const s=D.isDev?we:me;if(!n.value.name||!n.value.ID){$("save",{...n.value,error:"SkillName and ID are required"});return}if(h.isNew&&h.existingItems.some(w=>w.ID===n.value.ID)){$("save",{...n.value,error:"This ID already exists"});return}A.value=!0;const{ID:o,...u}=n.value,a={};a[`skills/skill/${o}`]=u;try{await Be(be(s),a),$("save",n.value),C(!1)}catch(O){console.error(O),$("save",{...n.value,error:"Error saving data"})}finally{A.value=!1}};return(s,o)=>(V(),G(ee,null,[e(Pe,{"model-value":v.modelValue,"max-width":"1280px","onUpdate:modelValue":C},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[p("span",ot,H(`${v.isNew?"New":"Edit"} Skill`),1)]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:n.value.name,"onUpdate:modelValue":o[0]||(o[0]=u=>n.value.name=u),label:"SkillName",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:n.value.kana,"onUpdate:modelValue":o[1]||(o[1]=u=>n.value.kana=u),label:"Kana",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(j,{modelValue:n.value.ID,"onUpdate:modelValue":o[2]||(o[2]=u=>n.value.ID=u),label:"ID",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...o[10]||(o[10]=[q("Text",-1)])]),_:1}),e(ke,null,{default:l(()=>[(V(!0),G(ee,null,ue(n.value.text,(u,a)=>(V(),G("div",{key:a,class:"d-flex align-center mb-4"},[e(j,{modelValue:n.value.text[a],"onUpdate:modelValue":O=>n.value.text[a]=O,label:`Text${a+1}`,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"]),e(I,{icon:"mdi-delete",variant:"text",density:"compact",color:"error",class:"ml-3",disabled:n.value.text.length===1,onClick:O=>n.value.text.splice(a,1)},null,8,["disabled","onClick"])]))),128)),e(I,{"prepend-icon":"mdi-plus",text:"Add Text",variant:"outlined",block:"",onClick:o[3]||(o[3]=u=>n.value.text.push(""))})]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...o[11]||(o[11]=[q("Detail",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:n.value.detail.attr,"onUpdate:modelValue":o[4]||(o[4]=u=>n.value.detail.attr=u),label:"Attr",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),(V(!0),G(ee,null,ue(n.value.detail.type,(u,a)=>(V(),L(c,{key:a,cols:"6",md:"4"},{default:l(()=>[e(re,{color:K(M).skillDetails[u]?.colorCode,class:"d-flex flex-column fill-height"},{default:l(()=>[e(fe,{class:"d-flex text-no-wrap text-body-2"},{default:l(()=>[q(H(`Type ${a+1}`)+" ",1),e(Ve),e(I,{icon:"mdi-close",density:"compact",color:"error",size:"small",onClick:O=>b(a)},null,8,["onClick"])]),_:2},1024),K(M).skillDetails[u]?(V(),L(ke,{key:0,class:"pb-0"},{default:l(()=>[p("p",it,H(K(M).skillDetails[u].skillDetailName),1),p("p",nt,H(K(M).skillDetails[u].description),1)]),_:2},1024)):ge("",!0),e(Ve),e(qe,null,{default:l(()=>[e(I,{text:"Change Type",variant:"outlined",block:"",onClick:O=>U(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["color"])]),_:2},1024))),128)),e(c,{cols:"6",md:"4"},{default:l(()=>[e(I,{"prepend-icon":"mdi-plus",text:"Add Type",variant:"outlined",class:"py-2 fill-height",block:"",onClick:y})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(I,{color:"error",variant:"text",text:"Cancel",onClick:o[5]||(o[5]=u=>C(!1))}),e(I,{color:"primary",variant:"text",text:`Save to ${K(D).isDev?"Dev":"Prod"}`,disabled:!n.value.name||!n.value.ID,loading:A.value,onClick:f},null,8,["text","disabled","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]),e(Pe,{modelValue:T.value,"onUpdate:modelValue":o[9]||(o[9]=u=>T.value=u),"max-width":"1080px"},{default:l(()=>[e(Il,{class:"pa-3"},{default:l(()=>[o[12]||(o[12]=p("h3",null,"Add Type",-1)),p("div",null,[e(Ol,{modelValue:k.value,"onUpdate:modelValue":o[6]||(o[6]=u=>k.value=u),color:"pink"},{default:l(()=>[(V(!0),G(ee,null,ue(K(ul),(u,a)=>(V(),L($e,{key:a,value:a},{default:l(()=>[q(H(u),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(Qe),e(Tl,{modelValue:k.value,"onUpdate:modelValue":o[7]||(o[7]=u=>k.value=u)},{default:l(()=>[(V(!0),G(ee,null,ue(K(ul),(u,a)=>(V(),L(Ne,{key:a,value:a},{default:l(()=>[e(Il,{style:{height:"500px","overflow-y":"auto"}},{default:l(()=>[e(Nl,{density:"compact"},{default:l(()=>[(V(!0),G(ee,null,ue(g(a),(O,w)=>(V(),L(Ge,{key:w,title:O.skillDetailName,subtitle:O.description,disabled:n.value.detail?.type?.includes(w),style:{"border-bottom":"1px solid #888"},onClick:x=>S(w,a)},{prepend:l(()=>[e(al,{color:O.colorCode,size:"small",class:"mr-2"},null,8,["color"])]),_:2},1032,["title","subtitle","disabled","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),p("div",st,[e(I,{color:"error",variant:"text",text:"Cancel",onClick:o[8]||(o[8]=u=>T.value=!1)})])]),_:1})]),_:1},8,["modelValue"])],64))}}),dt=Se({__name:"AddSkill",setup(v){const R=Te(),h=m({}),$=m(""),D=()=>{const S=R.isDev?we:me,f=be(S,"skills/skill");ol(f,s=>{const o=s.val();h.value=o??{}})};Fe(D),oe(()=>R.isDev,D);const M=Z(()=>{const S=[];if(!h.value)return S;for(const[f,s]of Object.entries(h.value))S.push({ID:f,...s});return S}),n=[{title:"ID",key:"ID"},{title:"Skill Name",key:"name"},{title:"Kana",key:"kana"},{title:"Edit",key:"edit",sortable:!1}],T=m(!1),k=m(!1),N=m({}),A=m(!1),C=m(""),y=m("success"),U=()=>{N.value={name:"",ID:"",kana:"",text:[""],detail:{attr:"",type:[]}},k.value=!0,T.value=!0},b=S=>{N.value=JSON.parse(JSON.stringify(S)),k.value=!1,T.value=!0},g=S=>{S.error?(C.value=S.error,y.value="error"):(C.value=`Saved to ${R.isDev?"Dev":"Prod"}`,y.value="success"),A.value=!0};return(S,f)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(j,{modelValue:$.value,"onUpdate:modelValue":f[0]||(f[0]=s=>$.value=s),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",class:"ma-2"},{append:l(()=>[e(I,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:U})]),_:1},8,["modelValue"]),e(yl,{headers:n,items:M.value,search:$.value,density:"compact","items-per-page":50,hover:""},{"item.edit":l(({item:s})=>[e(El,{icon:"mdi-pencil",size:"small",onClick:o=>b(s)},null,8,["onClick"])]),_:2},1032,["items","search"])]),_:1}),e(rt,{modelValue:T.value,"onUpdate:modelValue":f[1]||(f[1]=s=>T.value=s),"is-new":k.value,item:N.value,"existing-items":M.value,onSave:g},null,8,["modelValue","is-new","item","existing-items"]),e(je,{modelValue:A.value,"onUpdate:modelValue":f[2]||(f[2]=s=>A.value=s),timeout:3e3,color:y.value},{default:l(()=>[q(H(C.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),ct=Se({__name:"AddSkillDetail",setup(v){const R=Te(),h=fl(),$=m(""),D=Z(()=>Object.entries(ul).map(([f,s])=>({title:s,value:f}))),M=[{title:"ID",key:"id"},{title:"Skill Detail Name",key:"skillDetailName"},{title:"Color Code",key:"colorCode"},{title:"Skill Type",key:"skillTypeKey"},{title:"Description",key:"description"},{title:"Edit",key:"edit",sortable:!1}],n=Z(()=>{const f=Object.entries(h.skillDetails).map(([s,o])=>({id:s,...typeof o=="object"?o:{value:o}}));return $.value?f.filter(s=>s.skillTypeKey===$.value):f}),T=m(!1),k=m({id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"}),N=m(!1),A=m(!1),C=m(""),y=m("success"),U=()=>{k.value={id:"",skillDetailName:"",colorCode:"",description:"",skillTypeKey:"heartCaptcha"},N.value=!0,T.value=!0},b=f=>{k.value={...f},N.value=!1,T.value=!0},g=()=>{T.value=!1},S=async()=>{const f=R.isDev?we:me,s={};if(!k.value.id){C.value="ID is required",y.value="error",A.value=!0;return}if(N.value&&n.value.some(a=>a.id===k.value.id)){C.value="ID already exists",y.value="error",A.value=!0;return}const{id:o,...u}=k.value;s[`skills/skillDetail/${o}`]=u;try{await Be(be(f),s),C.value=`Saved to ${R.isDev?"Dev":"Prod"}`,y.value="success",A.value=!0,T.value=!1}catch(a){console.error(a),C.value="Error saving data",y.value="error",A.value=!0}};return(f,s)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[e(re,null,{default:l(()=>[e(Q,{modelValue:$.value,"onUpdate:modelValue":s[0]||(s[0]=o=>$.value=o),items:D.value,label:"Filter by Skill Type","prepend-inner-icon":"mdi-filter",variant:"outlined","hide-details":"",class:"ma-2",clearable:""},{append:l(()=>[e(I,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:U})]),_:1},8,["modelValue","items"]),e(yl,{headers:M,items:n.value,density:"compact","items-per-page":-1,hover:""},{"item.colorCode":l(({value:o})=>[o?(V(),L(ll,{key:0,color:o,size:"small",variant:"flat"},{default:l(()=>[q(H(o),1)]),_:2},1032,["color"])):ge("",!0)]),"item.skillTypeKey":l(({value:o})=>[q(H(K(ul)[o]||o),1)]),"item.edit":l(({item:o})=>[e(I,{icon:"mdi-pencil",size:"small",onClick:u=>b(o)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),e(Pe,{modelValue:T.value,"onUpdate:modelValue":s[6]||(s[6]=o=>T.value=o),"max-width":"600px"},{default:l(()=>[e(re,{class:"pa-2"},{default:l(()=>[e(fe,null,{default:l(()=>[...s[8]||(s[8]=[p("span",{class:"text-h5"},"Edit Skill Detail",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(_e,null,{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:k.value.id,"onUpdate:modelValue":s[1]||(s[1]=o=>k.value.id=o),label:"ID",readonly:!N.value,disabled:!N.value,variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","readonly","disabled"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:k.value.skillDetailName,"onUpdate:modelValue":s[2]||(s[2]=o=>k.value.skillDetailName=o),label:"Skill Detail Name",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:k.value.colorCode,"onUpdate:modelValue":s[3]||(s[3]=o=>k.value.colorCode=o),label:"Color Code",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(Q,{modelValue:k.value.skillTypeKey,"onUpdate:modelValue":s[4]||(s[4]=o=>k.value.skillTypeKey=o),items:D.value,"item-title":"title","item-value":"value",label:"Skill Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(Oe,{modelValue:k.value.description,"onUpdate:modelValue":s[5]||(s[5]=o=>k.value.description=o),label:"Description",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(qe,null,{default:l(()=>[e(Ve),e(I,{text:"Cancel",onClick:g}),e(I,{text:"Save",onClick:S})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(je,{modelValue:A.value,"onUpdate:modelValue":s[7]||(s[7]=o=>A.value=o),timeout:3e3,color:y.value},{default:l(()=>[q(H(C.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),mt={class:"text-h5"},vt={class:"d-flex justify-space-evenly mt-3"},pt=Se({__name:"EditEventDataDialog",props:{modelValue:{type:Boolean},eventData:{},isNew:{type:Boolean}},emits:["update:modelValue","save"],setup(v,{emit:R}){const h=v,$=R,D=m({}),M=m(null),n=m(null),T=m(null),k=["liveGP","live","movie","other"],N=o=>{if(!o||!Array.isArray(o)||o.length<5)return"";const[u,a,O,w,x]=o;return`${u}-${String(a).padStart(2,"0")}-${String(O).padStart(2,"0")}T${String(w).padStart(2,"0")}:${String(x).padStart(2,"0")}`},A=o=>{if(!o)return[];const u=new Date(o);return[u.getFullYear(),u.getMonth()+1,u.getDate(),u.getHours(),u.getMinutes()]};oe(()=>h.modelValue,o=>{o&&h.eventData&&(D.value=JSON.parse(JSON.stringify(h.eventData)),b())});const C=Z({get:()=>N(D.value.firstDay),set:o=>D.value.firstDay=A(o)}),y=Z({get:()=>N(D.value.lastDay),set:o=>D.value.lastDay=A(o)}),U=o=>{const u=Array.isArray(o)?o[0]:o;if(!u){b();return}T.value=u;const a=new FileReader;a.onload=O=>{M.value=O.target?.result},a.readAsDataURL(u)},b=()=>{T.value=null,M.value=null,n.value&&(n.value.value="")},g=()=>{n.value?.click()},S=o=>{const u=o.target;u.files&&u.files.length>0&&U(u.files[0])},f=()=>{$("update:modelValue",!1)},s=()=>{$("save",{event:D.value,file:T.value})};return(o,u)=>(V(),L(Pe,{"model-value":v.modelValue,"max-width":"1000px","onUpdate:modelValue":f},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[p("span",mt,H(`${v.isNew?"New":"Edit"} Event`),1)]),_:1}),e(ke,{class:"px-4 py-2"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"8"},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:D.value.id,"onUpdate:modelValue":u[0]||(u[0]=a=>D.value.id=a),label:"Event ID",readonly:!v.isNew,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue","readonly"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:D.value.title,"onUpdate:modelValue":u[1]||(u[1]=a=>D.value.title=a),label:"Event Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"8"},{default:l(()=>[e(j,{modelValue:D.value.text,"onUpdate:modelValue":u[2]||(u[2]=a=>D.value.text=a),label:"Sub Title",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Q,{modelValue:D.value.type,"onUpdate:modelValue":u[3]||(u[3]=a=>D.value.type=a),label:"Event Type",items:k,variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:C.value,"onUpdate:modelValue":u[4]||(u[4]=a=>C.value=a),label:"First Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(c,{cols:"6"},{default:l(()=>[e(j,{modelValue:y.value,"onUpdate:modelValue":u[5]||(u[5]=a=>y.value=a),label:"Last Day",type:"datetime-local",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"4"},{default:l(()=>[e(Ee,{src:M.value||D.value.imageUrl||K(Ml)},null,8,["src"]),p("div",vt,[e(I,{text:"Import Image","prepend-icon":"mdi-file-import",color:"primary",onClick:g}),e(I,{text:"Delete","prepend-icon":"mdi-close",color:"error",disabled:!T.value,onClick:b},null,8,["disabled"])]),p("input",{ref_key:"fileInputRef",ref:n,type:"file",accept:"image/webp",style:{display:"none"},onChange:S},null,544)]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(j,{modelValue:D.value.link,"onUpdate:modelValue":u[6]||(u[6]=a=>D.value.link=a),label:"URL",variant:"outlined",density:"compact","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(qe,{class:"py-0"},{default:l(()=>[e(Ve),e(I,{text:"Cancel",color:"red",variant:"text",onClick:f}),e(I,{text:"Save",color:"primary",variant:"text",onClick:s})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),ft={class:"text-right mb-3"},yt=Se({__name:"AddEvent",setup(v){const R=Te(),h=m(!1),$=m(""),D=m("success"),M=m(!1),n=m(!1),T=[{title:"ID",key:"id",sortable:!1},{title:"Title",key:"title",sortable:!1},{title:"SubTitle",key:"text",sortable:!1},{title:"First Day",key:"firstDay"},{title:"Last Day",key:"lastDay"},{title:"Edit",key:"edit",sortable:!1}],k=s=>{if(!s||!Array.isArray(s))return"";const[o,u,a,O,w]=s;return`${o}/${String(u).padStart(2,"0")}/${String(a).padStart(2,"0")} ${String(O).padStart(2,"0")}:${String(w).padStart(2,"0")}`},N=m({}),A=async()=>{const s=R.isDev?we:me,o=await Al(be(s,"eventInformation"));o.exists()?N.value=o.val():N.value={}};Fe(A),oe(()=>R.isDev,A);const C=Z(()=>Object.entries(N.value).map(([s,o])=>({id:s,...o}))),y=async()=>{const s=R.isDev?we:me,o=be(s,"cards");try{const u=await Al(o);if(u.exists()){const a=u.val(),O=(w,x)=>{for(const E in w)E===x?delete w[E]:typeof w[E]=="object"&&w[E]!==null&&O(w[E],x)};O(a,"fluctuationStatus"),await ga(o,a),$.value="Updated Card List (removed fluctuationStatus)",D.value="success",h.value=!0}}catch(u){console.error(u),$.value="Error updating card list",D.value="error",h.value=!0}},U=m(null),b=(s,o)=>{const u=JSON.parse(JSON.stringify(o));s==="copy"&&(u.id=""),U.value=u,n.value=s!=="edit",M.value=!0},g=()=>{U.value={id:"",title:"",text:"",type:"liveGP",firstDay:[],lastDay:[],link:"",imageUrl:""},n.value=!0,M.value=!0},S=async s=>{if(!confirm(`Are you sure you want to delete "${s.title}"?`))return;const o=R.isDev?we:me;try{await ka(be(o,`eventInformation/${s.id}`)),$.value="Deleted successfully",D.value="success",h.value=!0,await A()}catch(u){console.error(u),$.value="Error deleting event",D.value="error",h.value=!0}},f=async({event:s,file:o})=>{if(!s.id){$.value="ID is required",D.value="error",h.value=!0;return}const u=R.isDev?we:me,{id:a,...O}=s;try{if($.value="Uploading Now...",D.value="yellow",h.value=!0,o){const w=Le(me.app),x=Me(w,`event/${o.name}`),E=await We(x,o),F=await Re(E.ref);O.imageUrl=F}await Be(be(u,`eventInformation/${a}`),O),$.value="Saved successfully",D.value="success",M.value=!1,await A()}catch(w){console.error(w),$.value="Error saving event",D.value="error"}};return(s,o)=>(V(),L(_e,{fluid:"",class:"pa-0"},{default:l(()=>[p("div",ft,[e(Ve),e(I,{color:"primary","prepend-icon":"mdi-plus",text:"New",onClick:g})]),e(yl,{headers:T,items:C.value,class:"elevation-1","items-per-page":-1,"sort-by":[{key:"firstDay",order:"asc"}],hover:""},{"item.firstDay":l(({value:u})=>[q(H(k(u)),1)]),"item.lastDay":l(({value:u})=>[q(H(k(u)),1)]),"item.edit":l(({item:u})=>[e(I,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-pencil",onClick:a=>b("edit",u)},null,8,["onClick"]),e(I,{class:"mr-2",size:"small",variant:"tonal",icon:"mdi-content-copy",onClick:a=>b("copy",u)},null,8,["onClick"]),e(I,{size:"small",variant:"tonal",color:"error",icon:"mdi-delete",onClick:a=>S(u)},null,8,["onClick"])]),_:2},1032,["items"]),e(pt,{modelValue:M.value,"onUpdate:modelValue":o[0]||(o[0]=u=>M.value=u),"event-data":U.value,"is-new":n.value,onSave:f},null,8,["modelValue","event-data","is-new"]),e(le,{class:"mt-2"},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(I,{text:"Update Card List",color:"yellow",onClick:y})]),_:1})]),_:1}),e(je,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=u=>h.value=u),color:D.value,timeout:2e3},{default:l(()=>[q(H($.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),gt={key:0},kt={style:{"white-space":"pre-wrap"}},bt=Se({__name:"MngInfo",setup(v){const R=m([]),h=m([]),$=m(!1),D=m(""),M=m(""),n=m(!1),T=m(""),k=m("success"),N=Le(me.app),A=Me(N,"info"),C=async()=>{try{const S=await Rl(A);h.value=S.items.map(f=>({name:f.name,ref:f}))}catch(S){console.error(S),g("Failed to fetch file list","error")}},y=async()=>{if(!R.value||R.value.length===0)return;const S=R.value[0],f=Me(N,`info/${S.name}`);try{await We(f,S),g("Upload successful","success"),R.value=[],await C()}catch(s){console.error(s),g("Upload failed","error")}},U=async S=>{try{const f=await Re(S.ref),o=await(await fetch(f)).text();D.value=S.name,M.value=o,$.value=!0}catch(f){console.error(f),g("Failed to load file content","error")}},b=async S=>{if(confirm(`Are you sure you want to delete "${S.name}"?`))try{await Va(S.ref),g("Deleted successfully","success"),await C()}catch(f){console.error(f),g("Delete failed","error")}},g=(S,f)=>{T.value=S,k.value=f,n.value=!0};return Fe(()=>{C()}),(S,f)=>(V(),L(_e,{fluid:""},{default:l(()=>[e(le,null,{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[...f[4]||(f[4]=[p("h2",null,"Info Management (MD Files)",-1)])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(ba,{modelValue:R.value,"onUpdate:modelValue":f[0]||(f[0]=s=>R.value=s),label:"Select MD File",accept:".md","show-size":"","prepend-icon":"mdi-file-document-outline",variant:"outlined",density:"compact"},{"append-inner":l(()=>[e(I,{color:"primary",size:"small",class:"ml-2",disabled:!R.value||R.value.length===0,onClick:y},{default:l(()=>[...f[5]||(f[5]=[q(" Upload ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,null,{default:l(()=>[...f[6]||(f[6]=[q("File List (storage/info)",-1)])]),_:1}),e(il,{density:"compact"},{default:l(()=>[f[8]||(f[8]=p("thead",null,[p("tr",null,[p("th",null,"Name"),p("th",null,"Actions")])],-1)),p("tbody",null,[(V(!0),G(ee,null,ue(h.value,s=>(V(),G("tr",{key:s.name},[p("td",null,H(s.name),1),p("td",null,[e(I,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:o=>U(s)},null,8,["onClick"]),e(I,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:o=>b(s)},null,8,["onClick"])])]))),128)),h.value.length===0?(V(),G("tr",gt,[...f[7]||(f[7]=[p("td",{colspan:"2",class:"text-center"},"No files found.",-1)])])):ge("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,{modelValue:$.value,"onUpdate:modelValue":f[2]||(f[2]=s=>$.value=s),"max-width":"800px",scrollable:""},{default:l(()=>[e(re,null,{default:l(()=>[e(fe,{class:"d-flex justify-space-between align-center"},{default:l(()=>[p("span",null,H(D.value),1),e(I,{icon:"mdi-close",variant:"text",onClick:f[1]||(f[1]=s=>$.value=!1)})]),_:1}),e(ke,{style:{"max-height":"600px","overflow-y":"auto"}},{default:l(()=>[p("pre",kt,H(M.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(je,{modelValue:n.value,"onUpdate:modelValue":f[3]||(f[3]=s=>n.value=s),color:k.value,timeout:3e3},{default:l(()=>[q(H(T.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Vt={class:"d-flex align-center"},St=Se({__name:"AddData",setup(v){const R=m("pendingDataList"),h=Te(),$=Da(),D=m(0),M=async()=>{const k=Sa();try{await xa(k),$.push({name:"Home"})}catch(N){console.error("Logout failed",N)}},n=()=>{D.value++};oe(()=>h.isDev,()=>{n()});const T=k=>{R.value=`${k}${k==="card"?"List":""}`};return(k,N)=>(V(),L(_e,{fluid:"",class:"py-2 px-0"},{default:l(()=>[N[3]||(N[3]=p("h1",null,"DATA MANAGEMENT",-1)),p("div",Vt,[e(Xe,{modelValue:K(h).isDev,"onUpdate:modelValue":N[0]||(N[0]=A=>K(h).isDev=A),label:"isDev",color:"pink",density:"compact","hide-details":"","hide-input":"",class:"px-2"},null,8,["modelValue"]),e(I,{text:"Logout",color:"error","prepend-icon":"mdi-logout",size:"small",class:"mr-2",onClick:M}),e(I,{text:"Sync","prepend-icon":"mdi-refresh",size:"small",color:"primary",onClick:n})]),e(Ol,{modelValue:R.value,"onUpdate:modelValue":N[1]||(N[1]=A=>R.value=A),color:"pink"},{default:l(()=>[e($e,{value:"pendingDataList",text:"Pending Data"}),e($e,{value:"cardList",text:"Card"}),e($e,{value:"skillList",text:"Skill"}),e($e,{value:"skillDetail",text:"Skill Detail"}),e($e,{value:"music",text:"Music"}),e($e,{value:"item",text:"Item"}),e($e,{value:"event",text:"Event"}),e($e,{value:"info",text:"Info"})]),_:1},8,["modelValue"]),e(Qe,{class:"mb-2"}),e(Tl,{modelValue:R.value,"onUpdate:modelValue":N[2]||(N[2]=A=>R.value=A),class:"pt-3"},{default:l(()=>[e(Ne,{value:"pendingDataList"},{default:l(()=>[(V(),L(Ia,{key:D.value,onEdit:T}))]),_:1}),e(Ne,{value:"cardList"},{default:l(()=>[(V(),L(qa,{key:D.value}))]),_:1}),e(Ne,{value:"skillList"},{default:l(()=>[(V(),L(dt,{key:D.value}))]),_:1}),e(Ne,{value:"skillDetail"},{default:l(()=>[(V(),L(ct,{key:D.value}))]),_:1}),e(Ne,{value:"music"},{default:l(()=>[(V(),L(Ga,{key:D.value}))]),_:1}),e(Ne,{value:"item"},{default:l(()=>[(V(),L(ut,{key:D.value}))]),_:1}),e(Ne,{value:"event"},{default:l(()=>[(V(),L(yt,{key:D.value}))]),_:1}),e(Ne,{value:"info"},{default:l(()=>[(V(),L(bt,{key:D.value}))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{St as default};
